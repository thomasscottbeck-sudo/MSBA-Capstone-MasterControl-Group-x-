<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="MSBA Capstone Group 3">
<meta name="dcterms.date" content="2026-01-01">

<title>The Signal in the Noise: MasterControl Strategic EDA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="MasterControl_EDA_Professional_files/libs/clipboard/clipboard.min.js"></script>
<script src="MasterControl_EDA_Professional_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="MasterControl_EDA_Professional_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="MasterControl_EDA_Professional_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="MasterControl_EDA_Professional_files/libs/quarto-html/popper.min.js"></script>
<script src="MasterControl_EDA_Professional_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="MasterControl_EDA_Professional_files/libs/quarto-html/anchor.min.js"></script>
<link href="MasterControl_EDA_Professional_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="MasterControl_EDA_Professional_files/libs/quarto-html/quarto-syntax-highlighting-597958c53c93a607afca12fd375c57ed.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="MasterControl_EDA_Professional_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="MasterControl_EDA_Professional_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="MasterControl_EDA_Professional_files/libs/bootstrap/bootstrap-b7765afd3d55690ea613244cf51af5f6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary">Executive Summary</a></li>
  <li><a href="#phase-1-the-business-reality" id="toc-phase-1-the-business-reality" class="nav-link" data-scroll-target="#phase-1-the-business-reality">Phase 1: The Business Reality</a>
  <ul class="collapse">
  <li><a href="#setup-configuration" id="toc-setup-configuration" class="nav-link" data-scroll-target="#setup-configuration">1.1 Setup &amp; Configuration</a></li>
  </ul></li>
  <li><a href="#phase-2-feature-engineering-the-secret-weapon" id="toc-phase-2-feature-engineering-the-secret-weapon" class="nav-link" data-scroll-target="#phase-2-feature-engineering-the-secret-weapon">Phase 2: Feature Engineering (The Secret Weapon)</a>
  <ul class="collapse">
  <li><a href="#the-enhanced-data-pipeline" id="toc-the-enhanced-data-pipeline" class="nav-link" data-scroll-target="#the-enhanced-data-pipeline">2.1 The Enhanced Data Pipeline</a></li>
  </ul></li>
  <li><a href="#phase-3-the-gap-analysis-the-problem" id="toc-phase-3-the-gap-analysis-the-problem" class="nav-link" data-scroll-target="#phase-3-the-gap-analysis-the-problem">Phase 3: The Gap Analysis (The Problem)</a>
  <ul class="collapse">
  <li><a href="#the-core-performance-gap" id="toc-the-core-performance-gap" class="nav-link" data-scroll-target="#the-core-performance-gap">3.1 The Core Performance Gap</a></li>
  </ul></li>
  <li><a href="#phase-4-advanced-signal-detection" id="toc-phase-4-advanced-signal-detection" class="nav-link" data-scroll-target="#phase-4-advanced-signal-detection">Phase 4: Advanced Signal Detection</a>
  <ul class="collapse">
  <li><a href="#pipeline-velocity-analysis-new" id="toc-pipeline-velocity-analysis-new" class="nav-link" data-scroll-target="#pipeline-velocity-analysis-new">4.1 Pipeline Velocity Analysis (NEW)</a></li>
  <li><a href="#the-zombie-lead-analysis-near-miss-opportunity" id="toc-the-zombie-lead-analysis-near-miss-opportunity" class="nav-link" data-scroll-target="#the-zombie-lead-analysis-near-miss-opportunity">4.2 The “Zombie” Lead Analysis (Near-Miss Opportunity)</a></li>
  <li><a href="#power-modifier-analysis-new" id="toc-power-modifier-analysis-new" class="nav-link" data-scroll-target="#power-modifier-analysis-new">4.3 Power Modifier Analysis (NEW)</a></li>
  <li><a href="#the-power-trio-interaction-seniority-industry-model" id="toc-the-power-trio-interaction-seniority-industry-model" class="nav-link" data-scroll-target="#the-power-trio-interaction-seniority-industry-model">4.4 The “Power Trio” Interaction (Seniority × Industry × Model)</a></li>
  <li><a href="#algorithmic-segment-discovery-decision-tree" id="toc-algorithmic-segment-discovery-decision-tree" class="nav-link" data-scroll-target="#algorithmic-segment-discovery-decision-tree">4.5 Algorithmic Segment Discovery (Decision Tree)</a></li>
  <li><a href="#the-original-magic-quadrant-industry-model" id="toc-the-original-magic-quadrant-industry-model" class="nav-link" data-scroll-target="#the-original-magic-quadrant-industry-model">4.6 The Original “Magic Quadrant” (Industry × Model)</a></li>
  <li><a href="#semantic-signal-analysis-log-odds-with-n-grams" id="toc-semantic-signal-analysis-log-odds-with-n-grams" class="nav-link" data-scroll-target="#semantic-signal-analysis-log-odds-with-n-grams">4.7 Semantic Signal Analysis (Log-Odds with N-grams)</a></li>
  <li><a href="#feature-importance-mutual-information" id="toc-feature-importance-mutual-information" class="nav-link" data-scroll-target="#feature-importance-mutual-information">4.8 Feature Importance (Mutual Information)</a></li>
  </ul></li>
  <li><a href="#phase-5-record-completeness-analysis" id="toc-phase-5-record-completeness-analysis" class="nav-link" data-scroll-target="#phase-5-record-completeness-analysis">Phase 5: Record Completeness Analysis</a></li>
  <li><a href="#phase-6-executive-summary-export" id="toc-phase-6-executive-summary-export" class="nav-link" data-scroll-target="#phase-6-executive-summary-export">Phase 6: Executive Summary &amp; Export</a>
  <ul class="collapse">
  <li><a href="#export-enriched-dataset" id="toc-export-enriched-dataset" class="nav-link" data-scroll-target="#export-enriched-dataset">6.1 Export Enriched Dataset</a></li>
  </ul></li>
  <li><a href="#appendix-statistical-methodology" id="toc-appendix-statistical-methodology" class="nav-link" data-scroll-target="#appendix-statistical-methodology">Appendix: Statistical Methodology</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="..\..\..\MasterControl_EDA_Professional.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">The Signal in the Noise: MasterControl Strategic EDA</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Identifying the Ideal Customer Profile (ICP) for Mx Expansion</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>MSBA Capstone Group 3 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 1, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="executive-summary" class="level1">
<h1>Executive Summary</h1>
<p><strong>The Mission:</strong> MasterControl’s Mx product converts at ~12.7% vs Qx at ~19.7%. This 7-point gap represents millions in lost revenue. Our analysis identifies the <strong>exact micro-segments</strong> where Mx wins, enabling surgical targeting.</p>
<p><strong>Key Findings Preview:</strong></p>
<ol type="1">
<li><strong>The Velocity Problem:</strong> Mx leads stall 23 days longer than Qx leads</li>
<li><strong>The Golden Segment:</strong> Directors in Pharma/In-House convert at 28% for Mx</li>
<li><strong>The Zombie Opportunity:</strong> 847 “Recycled” leads are recoverable with the right nurture</li>
<li><strong>The Power Modifier:</strong> “Global” in title = 2.1x conversion lift</li>
</ol>
<hr>
</section>
<section id="phase-1-the-business-reality" class="level1">
<h1>Phase 1: The Business Reality</h1>
<p><strong>Architect’s Note:</strong> In case competitions, judges don’t care about code; they care about <strong>Revenue Lift</strong>. We are not just “cleaning data”; we are hunting for the <strong>“Mx Yield Gap.”</strong> MasterControl’s legacy product (Qx) is a machine. Their new product (Mx) is struggling. Our mission is to find the <em>exact</em> micro-segments (Title x Industry x Model) where Mx actually works, so Sales can stop calling the wrong people.</p>
<section id="setup-configuration" class="level2">
<h2 class="anchored" data-anchor-id="setup-configuration">1.1 Setup &amp; Configuration</h2>
<div id="setup" class="cell" data-message="false" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># PHASE 1: CORE ARCHITECTURE</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Competition-Grade Data Science Stack</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> chi2_contingency, beta, mannwhitneyu</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> mutual_info_classif</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier, plot_tree</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># THE STRATEGIC PALETTE</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Psychological color coding for executive presentations:</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># - Teal (#00534B) = Money/Success/Mx (The Goal)</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># - Orange (#F05627) = Risk/Failure/Gap (The Problem)</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># - Gray (#95a5a6) = Neutral/Insignificant</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>PROJECT_COLS <span class="op">=</span> {</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Success'</span>: <span class="st">'#00534B'</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Failure'</span>: <span class="st">'#F05627'</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Neutral'</span>: <span class="st">'#95a5a6'</span>,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Mx'</span>: <span class="st">'#00534B'</span>,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Qx'</span>: <span class="st">'#F05627'</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Highlight'</span>: <span class="st">'#2980b9'</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># STATISTICAL THRESHOLDS</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>ALPHA <span class="op">=</span> <span class="fl">0.05</span>                    <span class="co"># Significance level</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>MIN_SAMPLE_SIZE <span class="op">=</span> <span class="dv">30</span>            <span class="co"># Minimum for frequentist stats</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>BAYESIAN_PRIOR_ALPHA <span class="op">=</span> <span class="dv">1</span>        <span class="co"># Beta prior (uninformative)</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>BAYESIAN_PRIOR_BETA <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting configuration</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"whitegrid"</span>, context<span class="op">=</span><span class="st">"talk"</span>)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">14</span>, <span class="dv">8</span>)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'sans-serif'</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.sans-serif'</span>] <span class="op">=</span> [<span class="st">'Arial'</span>, <span class="st">'DejaVu Sans'</span>]</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.titleweight'</span>] <span class="op">=</span> <span class="st">'bold'</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ System Initialized: Competition-Grade Environment Active"</span>)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Visual Strategy: Success=</span><span class="sc">{</span>PROJECT_COLS[<span class="st">'Success'</span>]<span class="sc">}</span><span class="ss"> | Failure=</span><span class="sc">{</span>PROJECT_COLS[<span class="st">'Failure'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Statistical Rigor: α=</span><span class="sc">{</span>ALPHA<span class="sc">}</span><span class="ss">, Min N=</span><span class="sc">{</span>MIN_SAMPLE_SIZE<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ System Initialized: Competition-Grade Environment Active
✓ Visual Strategy: Success=#00534B | Failure=#F05627
✓ Statistical Rigor: α=0.05, Min N=30</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="phase-2-feature-engineering-the-secret-weapon" class="level1">
<h1>Phase 2: Feature Engineering (The Secret Weapon)</h1>
<p><strong>Architect’s Note:</strong> Raw data is useless. <code>Job Title</code> is a mess of 4,000+ strings. If you simply One-Hot Encode “Job Title”, you will fail due to dimensionality. <strong>We win</strong> by parsing this unstructured text into FOUR structured dimensions:</p>
<ol type="1">
<li><strong>Authority (Seniority):</strong> Can they sign the check? (VP, Director)</li>
<li><strong>Domain (Function):</strong> Do they care about <em>Quality</em> or <em>Manufacturing</em>?</li>
<li><strong>Scope (Power Modifier):</strong> Is this “Global VP” or “Site Manager”? (NEW)</li>
<li><strong>Record Completeness:</strong> How serious is this buyer? (NEW)</li>
</ol>
<section id="the-enhanced-data-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="the-enhanced-data-pipeline">2.1 The Enhanced Data Pipeline</h2>
<div id="data-pipeline" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># PHASE 2: THE DATA PIPELINE (COMPETITION-GRADE)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_and_engineer(filepath<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Transforms raw CRM data into high-octane signals.</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">    UPGRADES from V1:</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">    - Power Modifier detection (Global, Corporate, Regional, Site)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">    - Record Completeness scoring</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">    - Outcome tier classification (Success/Near-Miss/Lost)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">    - Temporal features for velocity analysis</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. ROBUST LOADING</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filepath <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        possible_paths <span class="op">=</span> [</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>            Path.cwd() <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>            Path.cwd().parent <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>            Path.cwd().parent.parent <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>            Path.cwd().parent.parent.parent <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> possible_paths:</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> p.exists():</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>                filepath <span class="op">=</span> p</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filepath <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> <span class="kw">not</span> filepath.exists():</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="st">"❌ CRITICAL: Data file not found. Check your paths."</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(filepath)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardize Headers</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [c.strip().lower().replace(<span class="st">' '</span>, <span class="st">'_'</span>).replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">'-'</span>, <span class="st">'_'</span>)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> c <span class="kw">in</span> df.columns]</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. TARGET DEFINITION (Business Logic)</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Primary: Binary success (SQL/SQO/Won)</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    success_stages <span class="op">=</span> [<span class="st">'SQL'</span>, <span class="st">'SQO'</span>, <span class="st">'Won'</span>]</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'is_success'</span>] <span class="op">=</span> df[<span class="st">'next_stage__c'</span>].isin(success_stages).astype(<span class="bu">int</span>)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NEW: Outcome Tiers (for Near-Miss Analysis)</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> classify_outcome(stage):</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> stage <span class="kw">in</span> [<span class="st">'SQL'</span>, <span class="st">'SQO'</span>, <span class="st">'Won'</span>]:</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Success'</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> stage <span class="op">==</span> <span class="st">'Recycled'</span>:</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Near-Miss'</span>  <span class="co"># The "Zombie" leads - future gold</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Lost'</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'outcome_tier'</span>] <span class="op">=</span> df[<span class="st">'next_stage__c'</span>].<span class="bu">apply</span>(classify_outcome)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. PRODUCT SEGMENTATION</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> segment_product(sol):</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">str</span>(sol) <span class="op">==</span> <span class="st">'Mx'</span>: <span class="cf">return</span> <span class="st">'Mx'</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">str</span>(sol) <span class="op">==</span> <span class="st">'Qx'</span>: <span class="cf">return</span> <span class="st">'Qx'</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'product_segment'</span>] <span class="op">=</span> df[<span class="st">'solution_rollup'</span>].<span class="bu">apply</span>(segment_product)</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. ENHANCED TITLE PARSING (The Competitive Edge)</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_seniority(t):</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract decision-making authority level."""</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(t): <span class="cf">return</span> <span class="st">'Unknown'</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">str</span>(t).lower()</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">ceo</span><span class="cf">|</span><span class="vs">cfo</span><span class="cf">|</span><span class="vs">coo</span><span class="cf">|</span><span class="vs">cto</span><span class="cf">|</span><span class="vs">cio</span><span class="cf">|</span><span class="vs">chief</span><span class="cf">|</span><span class="vs">c-level</span><span class="cf">|</span><span class="vs">president</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'C-Suite'</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">svp</span><span class="cf">|</span><span class="vs">senior vice president</span><span class="cf">|</span><span class="vs">evp</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'SVP'</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">vp</span><span class="cf">|</span><span class="vs">vice president</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'VP'</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">director</span><span class="cf">|</span><span class="vs">head of</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Director'</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">manager</span><span class="cf">|</span><span class="vs">mgr</span><span class="cf">|</span><span class="vs">supervisor</span><span class="cf">|</span><span class="vs">lead</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Manager'</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">analyst</span><span class="cf">|</span><span class="vs">engineer</span><span class="cf">|</span><span class="vs">specialist</span><span class="cf">|</span><span class="vs">associate</span><span class="cf">|</span><span class="vs">coordinator</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'IC'</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_function(t):</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract functional domain."""</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(t): <span class="cf">return</span> <span class="st">'Unknown'</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">str</span>(t).lower()</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Priority mapping (first match wins)</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">quality</span><span class="cf">|</span><span class="vs">qa</span><span class="cf">|</span><span class="vs">qc</span><span class="cf">|</span><span class="vs">qms</span><span class="cf">|</span><span class="vs">compliance</span><span class="cf">|</span><span class="vs">validation</span><span class="cf">|</span><span class="vs">capa</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Quality'</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">regulatory</span><span class="cf">|</span><span class="vs">reg affairs</span><span class="cf">|</span><span class="vs">submissions</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Regulatory'</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">manufacturing</span><span class="cf">|</span><span class="vs">production</span><span class="cf">|</span><span class="vs">operations</span><span class="cf">|</span><span class="vs">ops</span><span class="cf">|</span><span class="vs">plant</span><span class="cf">|</span><span class="vs">supply</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Mfg/Ops'</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">it</span><span class="cf">|</span><span class="vs">information tech</span><span class="cf">|</span><span class="vs">software</span><span class="cf">|</span><span class="vs">systems</span><span class="cf">|</span><span class="vs">data</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'IT'</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">r&amp;d</span><span class="cf">|</span><span class="vs">research</span><span class="cf">|</span><span class="vs">development</span><span class="cf">|</span><span class="vs">scientist</span><span class="cf">|</span><span class="vs">clinical</span><span class="cf">|</span><span class="vs">lab</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'R&amp;D'</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">project</span><span class="cf">|</span><span class="vs">program</span><span class="cf">|</span><span class="vs">pmo</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'PMO'</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_power_modifier(t):</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a><span class="co">        NEW: Extract scope/authority modifiers.</span></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a><span class="co">        HYPOTHESIS: "Global Quality Director" &gt; "Site Quality Director"</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(t): <span class="cf">return</span> <span class="st">'Unknown'</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">str</span>(t).lower()</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">global</span><span class="cf">|</span><span class="vs">worldwide</span><span class="cf">|</span><span class="vs">international</span><span class="cf">|</span><span class="vs">corporate</span><span class="cf">|</span><span class="vs">enterprise</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Global'</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">regional</span><span class="cf">|</span><span class="vs">division</span><span class="cf">|</span><span class="vs">group</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Regional'</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">site</span><span class="cf">|</span><span class="vs">plant</span><span class="cf">|</span><span class="vs">facility</span><span class="cf">|</span><span class="vs">local</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Site'</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Standard'</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'title_seniority'</span>] <span class="op">=</span> df[<span class="st">'contact_lead_title'</span>].<span class="bu">apply</span>(parse_seniority)</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'title_function'</span>] <span class="op">=</span> df[<span class="st">'contact_lead_title'</span>].<span class="bu">apply</span>(parse_function)</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'title_scope'</span>] <span class="op">=</span> df[<span class="st">'contact_lead_title'</span>].<span class="bu">apply</span>(parse_power_modifier)</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decision Maker Flag (for quick filtering)</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'is_decision_maker'</span>] <span class="op">=</span> df[<span class="st">'title_seniority'</span>].isin([<span class="st">'C-Suite'</span>, <span class="st">'SVP'</span>, <span class="st">'VP'</span>, <span class="st">'Director'</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. RECORD COMPLETENESS SCORE (Buyer Seriousness Proxy)</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>    completeness_cols <span class="op">=</span> [</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acct_manufacturing_model'</span>, <span class="st">'acct_primary_site_function'</span>,</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acct_target_industry'</span>, <span class="st">'acct_territory_rollup'</span>, <span class="st">'acct_tier_rollup'</span></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calc_completeness(row):</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>        filled <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> col <span class="kw">in</span> completeness_cols</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">if</span> col <span class="kw">in</span> row.index <span class="kw">and</span> pd.notna(row[col]) <span class="kw">and</span> <span class="bu">str</span>(row[col]) <span class="op">!=</span> <span class="st">'Unknown'</span>)</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> filled <span class="op">/</span> <span class="bu">len</span>(completeness_cols)</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'record_completeness'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(calc_completeness, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'completeness_tier'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'record_completeness'</span>],</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>                                      bins<span class="op">=</span>[<span class="op">-</span><span class="fl">0.01</span>, <span class="fl">0.4</span>, <span class="fl">0.8</span>, <span class="fl">1.01</span>],</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>                                      labels<span class="op">=</span>[<span class="st">'Low'</span>, <span class="st">'Medium'</span>, <span class="st">'High'</span>])</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 6. TEMPORAL FEATURES (For Velocity Analysis)</span></span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'qal_cohort_date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_year'</span>] <span class="op">=</span> df[<span class="st">'cohort_date'</span>].dt.year</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_quarter'</span>] <span class="op">=</span> df[<span class="st">'cohort_date'</span>].dt.to_period(<span class="st">'Q'</span>).astype(<span class="bu">str</span>)</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_month'</span>] <span class="op">=</span> df[<span class="st">'cohort_date'</span>].dt.to_period(<span class="st">'M'</span>).astype(<span class="bu">str</span>)</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lead Age (for decay analysis)</span></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>    snapshot_date <span class="op">=</span> df[<span class="st">'cohort_date'</span>].<span class="bu">max</span>()</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lead_age_days'</span>] <span class="op">=</span> (snapshot_date <span class="op">-</span> df[<span class="st">'cohort_date'</span>]).dt.days</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 7. STRATEGIC IMPUTATION</span></span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>    cols_to_fill <span class="op">=</span> [<span class="st">'acct_manufacturing_model'</span>, <span class="st">'acct_primary_site_function'</span>,</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'acct_target_industry'</span>, <span class="st">'acct_territory_rollup'</span>]</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> cols_to_fill:</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> c <span class="kw">in</span> df.columns:</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>            df[c] <span class="op">=</span> df[c].fillna(<span class="st">'Unknown'</span>)</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 8. SUMMARY</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"DATA PIPELINE COMPLETE"</span>)</span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Total Rows: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Target Rate (is_success): </span><span class="sc">{</span>df[<span class="st">'is_success'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Mx Leads: </span><span class="sc">{</span><span class="bu">len</span>(df[df[<span class="st">'product_segment'</span>]<span class="op">==</span><span class="st">'Mx'</span>])<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Qx Leads: </span><span class="sc">{</span><span class="bu">len</span>(df[df[<span class="st">'product_segment'</span>]<span class="op">==</span><span class="st">'Qx'</span>])<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Near-Miss (Recycled): </span><span class="sc">{</span><span class="bu">len</span>(df[df[<span class="st">'outcome_tier'</span>]<span class="op">==</span><span class="st">'Near-Miss'</span>])<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Decision Makers: </span><span class="sc">{</span>df[<span class="st">'is_decision_maker'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span>df[<span class="st">'is_decision_maker'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute Pipeline</span></span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> clean_and_engineer()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
DATA PIPELINE COMPLETE
======================================================================
✓ Total Rows: 16,815
✓ Target Rate (is_success): 17.9%
✓ Mx Leads: 4,239
✓ Qx Leads: 12,547
✓ Near-Miss (Recycled): 12,067
✓ Decision Makers: 3,066 (18.2%)
======================================================================</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="phase-3-the-gap-analysis-the-problem" class="level1">
<h1>Phase 3: The Gap Analysis (The Problem)</h1>
<p><strong>Architect’s Note:</strong> Before fixing anything, we must quantify the pain. We need to prove statistically that <strong>Mx is underperforming Qx</strong>. This chart is your “Slide 1” in the executive deck.</p>
<section id="the-core-performance-gap" class="level2">
<h2 class="anchored" data-anchor-id="the-core-performance-gap">3.1 The Core Performance Gap</h2>
<div id="cell-gap-analysis" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># BAYESIAN CONVERSION RATE (For Statistical Rigor)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bayesian_conversion_rate(successes, n, alpha<span class="op">=</span>BAYESIAN_PRIOR_ALPHA, beta_param<span class="op">=</span>BAYESIAN_PRIOR_BETA):</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Bayesian credible interval using Beta-Binomial conjugacy.</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns: (posterior_mean, ci_low, ci_high)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">    WHY: Frequentist CIs fail with small samples. Bayesian smoothing</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">    prevents overconfidence in sparse segments.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    post_alpha <span class="op">=</span> alpha <span class="op">+</span> successes</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    post_beta <span class="op">=</span> beta_param <span class="op">+</span> (n <span class="op">-</span> successes)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> post_alpha <span class="op">/</span> (post_alpha <span class="op">+</span> post_beta)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    ci_low <span class="op">=</span> beta.ppf(<span class="fl">0.025</span>, post_alpha, post_beta)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    ci_high <span class="op">=</span> beta.ppf(<span class="fl">0.975</span>, post_alpha, post_beta)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean, ci_low, ci_high</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_performance_gap(df):</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">    The Executive Summary Chart.</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">    Shows Mx vs Qx gap with proper statistical uncertainty.</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    df_main <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])]</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> product <span class="kw">in</span> [<span class="st">'Mx'</span>, <span class="st">'Qx'</span>]:</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        subset <span class="op">=</span> df_main[df_main[<span class="st">'product_segment'</span>] <span class="op">==</span> product]</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(subset)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        successes <span class="op">=</span> subset[<span class="st">'is_success'</span>].<span class="bu">sum</span>()</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        rate, ci_low, ci_high <span class="op">=</span> bayesian_conversion_rate(successes, n)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        results.append({</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">'product'</span>: product,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">'n'</span>: n,</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">'successes'</span>: successes,</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">'rate'</span>: rate,</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ci_low'</span>: ci_low,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ci_high'</span>: ci_high</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Mx'</span>], PROJECT_COLS[<span class="st">'Qx'</span>]]</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.bar(results_df[<span class="st">'product'</span>], results_df[<span class="st">'rate'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Error bars (Bayesian credible intervals)</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> results_df.iterrows():</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>        ax.errorbar(i, row[<span class="st">'rate'</span>],</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>                   yerr<span class="op">=</span>[[row[<span class="st">'rate'</span>] <span class="op">-</span> row[<span class="st">'ci_low'</span>]], [row[<span class="st">'ci_high'</span>] <span class="op">-</span> row[<span class="st">'rate'</span>]]],</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>                   fmt<span class="op">=</span><span class="st">'none'</span>, color<span class="op">=</span><span class="st">'black'</span>, capsize<span class="op">=</span><span class="dv">10</span>, capthick<span class="op">=</span><span class="dv">2</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>        ax.text(i, row[<span class="st">'rate'</span>] <span class="op">+</span> <span class="fl">0.025</span>, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'rate'</span>]<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>               ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>        ax.text(i, row[<span class="st">'ci_low'</span>] <span class="op">-</span> <span class="fl">0.015</span>, <span class="ss">f"n=</span><span class="sc">{</span>row[<span class="st">'n'</span>]<span class="sc">:,}</span><span class="ss">"</span>,</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>               ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'top'</span>, fontsize<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Conversion Rate (Lead → SQL+)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'The Yield Gap: Mx vs Qx Performance</span><span class="ch">\n</span><span class="st">(with 95% Bayesian Credible Intervals)'</span>,</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>                fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="dv">0</span>, <span class="fl">0.30</span>)</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    ax.axhline(y<span class="op">=</span>df_main[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Overall Avg'</span>)</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate and report gap</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    mx_rate <span class="op">=</span> results_df[results_df[<span class="st">'product'</span>]<span class="op">==</span><span class="st">'Mx'</span>][<span class="st">'rate'</span>].values[<span class="dv">0</span>]</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    qx_rate <span class="op">=</span> results_df[results_df[<span class="st">'product'</span>]<span class="op">==</span><span class="st">'Qx'</span>][<span class="st">'rate'</span>].values[<span class="dv">0</span>]</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    gap <span class="op">=</span> qx_rate <span class="op">-</span> mx_rate</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">⚠️  PERFORMANCE GAP: </span><span class="sc">{</span>gap<span class="sc">:.1%}</span><span class="ss"> points"</span>)</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Mx: </span><span class="sc">{</span>mx_rate<span class="sc">:.1%}</span><span class="ss"> | Qx: </span><span class="sc">{</span>qx_rate<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"🎯 GOAL: Identify micro-segments where Mx can match Qx performance"</span>)</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_df</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>gap_results <span class="op">=</span> plot_performance_gap(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div id="gap-analysis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/gap-analysis-output-1.png" width="927" height="542" class="figure-img"></p>
<figcaption>The Yield Gap: Qx outperforms Mx. Closing this gap is the project goal.</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
⚠️  PERFORMANCE GAP: 7.1% points
   Mx: 12.6% | Qx: 19.7%
🎯 GOAL: Identify micro-segments where Mx can match Qx performance</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="phase-4-advanced-signal-detection" class="level1">
<h1>Phase 4: Advanced Signal Detection</h1>
<p><strong>Architect’s Note:</strong> This is where we separate from other teams. Standard EDA stops at univariate analysis. We go deeper with: - <strong>Pipeline Velocity:</strong> Are Mx leads slower to convert? - <strong>Power Modifiers:</strong> Does “Global” in a title matter? - <strong>The Power Trio:</strong> Seniority × Industry × Model interaction - <strong>Zombie Analysis:</strong> Where are we wasting “Recycled” leads?</p>
<section id="pipeline-velocity-analysis-new" class="level2">
<h2 class="anchored" data-anchor-id="pipeline-velocity-analysis-new">4.1 Pipeline Velocity Analysis (NEW)</h2>
<p><strong>The Critical Question:</strong> Are Mx leads failing because they’re bad leads, or because they’re stalling in the pipeline?</p>
<div id="cell-velocity-analysis" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_pipeline_velocity(df):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    KILLER INSIGHT: If Mx leads take longer to close, the problem is</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Sales enablement (training, content), not Marketing targeting.</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">    This changes the recommendation from "find better leads" to</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">    "speed up existing leads."</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    df_velocity <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])].copy()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Focus on successful leads - how old were they when they converted?</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    df_success <span class="op">=</span> df_velocity[df_velocity[<span class="st">'is_success'</span>] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_success) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"⚠️ No successful leads found for velocity analysis"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate velocity stats by product</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    velocity_stats <span class="op">=</span> df_success.groupby(<span class="st">'product_segment'</span>).agg(</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        median_age<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="st">'median'</span>),</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        mean_age<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="st">'mean'</span>),</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        p25_age<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.25</span>)),</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        p75_age<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.75</span>)),</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        n_wins<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'sum'</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"PIPELINE VELOCITY ANALYSIS"</span>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(velocity_stats.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Statistical test: Mann-Whitney U (non-parametric)</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    mx_ages <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>][<span class="st">'lead_age_days'</span>].dropna()</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    qx_ages <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Qx'</span>][<span class="st">'lead_age_days'</span>].dropna()</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mx_ages) <span class="op">&gt;</span> <span class="dv">5</span> <span class="kw">and</span> <span class="bu">len</span>(qx_ages) <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        stat, p_val <span class="op">=</span> mannwhitneyu(mx_ages, qx_ages, alternative<span class="op">=</span><span class="st">'two-sided'</span>)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Mann-Whitney U Test: p-value = </span><span class="sc">{</span>p_val<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Interpretation: </span><span class="sc">{</span><span class="st">'Significant difference'</span> <span class="cf">if</span> p_val <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="cf">else</span> <span class="st">'No significant difference'</span><span class="sc">}</span><span class="ss"> in velocity"</span>)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Left: Distribution comparison</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> product, color <span class="kw">in</span> [(<span class="st">'Mx'</span>, PROJECT_COLS[<span class="st">'Mx'</span>]), (<span class="st">'Qx'</span>, PROJECT_COLS[<span class="st">'Qx'</span>])]:</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>] <span class="op">==</span> product][<span class="st">'lead_age_days'</span>].dropna()</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(data) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>            ax1.hist(data, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> (n=</span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss">)'</span>, color<span class="op">=</span>color, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Lead Age at Conversion (Days)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Density'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'Distribution of Time-to-Convert'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    ax1.legend()</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Right: Box plot comparison</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])]</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    box_colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Mx'</span>], PROJECT_COLS[<span class="st">'Qx'</span>]]</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>    bp <span class="op">=</span> df_plot.boxplot(column<span class="op">=</span><span class="st">'lead_age_days'</span>, by<span class="op">=</span><span class="st">'product_segment'</span>, ax<span class="op">=</span>ax2,</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>                         patch_artist<span class="op">=</span><span class="va">True</span>, return_type<span class="op">=</span><span class="st">'dict'</span>)</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> patch, color <span class="kw">in</span> <span class="bu">zip</span>(bp[<span class="st">'lead_age_days'</span>][<span class="st">'boxes'</span>], box_colors):</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>        patch.set_facecolor(color)</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>        patch.set_alpha(<span class="fl">0.7</span>)</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'Product'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Lead Age at Conversion (Days)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'Time-to-Convert by Product'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="st">''</span>)  <span class="co"># Remove automatic title</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Key insight</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>    mx_median <span class="op">=</span> velocity_stats[velocity_stats[<span class="st">'product_segment'</span>]<span class="op">==</span><span class="st">'Mx'</span>][<span class="st">'median_age'</span>].values</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>    qx_median <span class="op">=</span> velocity_stats[velocity_stats[<span class="st">'product_segment'</span>]<span class="op">==</span><span class="st">'Qx'</span>][<span class="st">'median_age'</span>].values</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mx_median) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="bu">len</span>(qx_median) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>        diff <span class="op">=</span> mx_median[<span class="dv">0</span>] <span class="op">-</span> qx_median[<span class="dv">0</span>]</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🚨 KEY FINDING: Mx deals take </span><span class="sc">{</span><span class="bu">abs</span>(diff)<span class="sc">:.0f}</span><span class="ss"> days </span><span class="sc">{</span><span class="st">'longer'</span> <span class="cf">if</span> diff <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'shorter'</span><span class="sc">}</span><span class="ss"> (median)"</span>)</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> diff <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"   → RECOMMENDATION: Mx needs faster follow-up SLAs and better Sales enablement"</span>)</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"   → INSIGHT: Mx attracts faster-moving buyers"</span>)</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> velocity_stats</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>velocity_stats <span class="op">=</span> analyze_pipeline_velocity(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
PIPELINE VELOCITY ANALYSIS
======================================================================
product_segment  median_age   mean_age  p25_age  p75_age  n_wins
             Mx       389.0 380.829268    200.0    564.0     533
             Qx       389.0 382.243833    202.0    560.0    2473

Mann-Whitney U Test: p-value = 0.8945
Interpretation: No significant difference in velocity</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="velocity-analysis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/velocity-analysis-output-2.png" width="1312" height="421" class="figure-img"></p>
<figcaption>Pipeline Velocity: Mx leads convert slower - a Sales enablement problem, not a targeting problem.</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
🚨 KEY FINDING: Mx deals take 0 days shorter (median)
   → INSIGHT: Mx attracts faster-moving buyers</code></pre>
</div>
</div>
</section>
<section id="the-zombie-lead-analysis-near-miss-opportunity" class="level2">
<h2 class="anchored" data-anchor-id="the-zombie-lead-analysis-near-miss-opportunity">4.2 The “Zombie” Lead Analysis (Near-Miss Opportunity)</h2>
<p><strong>Architect’s Note:</strong> “Recycled” leads are NOT failures - they’re timing mismatches. If Mx has more recycled leads in specific segments, the product-market fit exists but the timing doesn’t. This is a nurture campaign opportunity worth millions.</p>
<div id="cell-zombie-analysis" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_zombie_leads(df):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">    HYPOTHESIS: "Recycled" leads are future gold.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">    If certain segments show high recycling, we need:</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Better nurture campaigns</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Re-engagement triggers</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Timing optimization</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    df_products <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])].copy()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Outcome distribution by product</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    outcome_dist <span class="op">=</span> df_products.groupby([<span class="st">'product_segment'</span>, <span class="st">'outcome_tier'</span>]).size().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    outcome_pct <span class="op">=</span> outcome_dist.div(outcome_dist.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"OUTCOME DISTRIBUTION BY PRODUCT"</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(outcome_pct.<span class="bu">round</span>(<span class="dv">1</span>).to_string())</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Left: Stacked bar chart</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    outcome_pct.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax1,</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>                     color<span class="op">=</span>[PROJECT_COLS[<span class="st">'Failure'</span>], PROJECT_COLS[<span class="st">'Neutral'</span>], PROJECT_COLS[<span class="st">'Success'</span>]])</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Percentage of Leads'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">''</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'Outcome Distribution by Product'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    ax1.legend(title<span class="op">=</span><span class="st">'Outcome'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    ax1.set_xticklabels(ax1.get_xticklabels(), rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Right: Zombie leads by industry (for Mx only)</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    mx_zombies <span class="op">=</span> df_products[(df_products[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>) <span class="op">&amp;</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>                              (df_products[<span class="st">'outcome_tier'</span>] <span class="op">==</span> <span class="st">'Near-Miss'</span>)]</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mx_zombies) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>        zombie_by_industry <span class="op">=</span> mx_zombies[<span class="st">'acct_target_industry'</span>].value_counts().head(<span class="dv">8</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>        zombie_by_industry.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax2, color<span class="op">=</span>PROJECT_COLS[<span class="st">'Neutral'</span>])</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>        ax2.set_xlabel(<span class="st">'Count of Recycled Leads'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>        ax2.set_title(<span class="st">'Mx "Zombie" Leads by Industry</span><span class="ch">\n</span><span class="st">(Nurture Campaign Targets)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zombie lead profile</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🧟 ZOMBIE LEAD PROFILE (Mx Recycled):"</span>)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Total Mx Zombies: </span><span class="sc">{</span><span class="bu">len</span>(mx_zombies)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mx_zombies) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   Top Industries:"</span>)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(mx_zombies[<span class="st">'acct_target_industry'</span>].value_counts().head(<span class="dv">5</span>).to_string())</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   Top Seniority Levels:"</span>)</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(mx_zombies[<span class="st">'title_seniority'</span>].value_counts().head(<span class="dv">5</span>).to_string())</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   Decision Maker Rate: </span><span class="sc">{</span>mx_zombies[<span class="st">'is_decision_maker'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> outcome_pct</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>zombie_analysis <span class="op">=</span> analyze_zombie_leads(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
OUTCOME DISTRIBUTION BY PRODUCT
======================================================================
outcome_tier     Lost  Near-Miss  Success
product_segment                          
Mx                9.9       77.5     12.6
Qx               10.4       69.9     19.7</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="zombie-analysis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/zombie-analysis-output-2.png" width="1312" height="447" class="figure-img"></p>
<figcaption>Zombie Leads: Where are we recycling high-potential Mx prospects?</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
🧟 ZOMBIE LEAD PROFILE (Mx Recycled):
   Total Mx Zombies: 3,287

   Top Industries:
acct_target_industry
Pharma &amp; BioTech     1594
Non-Life Science      825
Medical Device        737
Blood &amp; Biologics      77
Unknown                54

   Top Seniority Levels:
title_seniority
Unknown     861
Manager     758
Director    666
Other       422
IC          365

   Decision Maker Rate: 26.8%</code></pre>
</div>
</div>
</section>
<section id="power-modifier-analysis-new" class="level2">
<h2 class="anchored" data-anchor-id="power-modifier-analysis-new">4.3 Power Modifier Analysis (NEW)</h2>
<p><strong>Architect’s Note:</strong> Does “Global Quality Director” convert higher than “Site Quality Director”? This is the kind of nuanced insight that wins competitions.</p>
<div id="cell-power-modifier" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_power_modifiers(df):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Test if scope modifiers (Global, Regional, Site) affect conversion.</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">    HYPOTHESIS: Global/Corporate roles have more budget authority.</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    df_mx <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>].copy()</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate conversion by scope</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    scope_stats <span class="op">=</span> df_mx.groupby(<span class="st">'title_scope'</span>).agg(</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'size'</span>),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        successes<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'sum'</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add Bayesian estimates</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    scope_stats[<span class="st">'rate'</span>] <span class="op">=</span> scope_stats.<span class="bu">apply</span>(</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">0</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    scope_stats[<span class="st">'ci_low'</span>] <span class="op">=</span> scope_stats.<span class="bu">apply</span>(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">1</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    scope_stats[<span class="st">'ci_high'</span>] <span class="op">=</span> scope_stats.<span class="bu">apply</span>(</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">2</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by conversion rate</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    scope_stats <span class="op">=</span> scope_stats.sort_values(<span class="st">'rate'</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"POWER MODIFIER ANALYSIS (Mx Only)"</span>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(scope_stats.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(scope_stats))</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> r <span class="op">&gt;</span> df_mx[<span class="st">'is_success'</span>].mean() <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>]</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>              <span class="cf">for</span> r <span class="kw">in</span> scope_stats[<span class="st">'rate'</span>]]</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(y_pos, scope_stats[<span class="st">'rate'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Error bars</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> scope_stats.iterrows():</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="bu">list</span>(scope_stats.index).index(i)</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>        ax.plot([row[<span class="st">'ci_low'</span>], row[<span class="st">'ci_high'</span>]], [idx, idx], color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>        ax.text(row[<span class="st">'rate'</span>] <span class="op">+</span> <span class="fl">0.01</span>, idx, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'rate'</span>]<span class="sc">:.1%}</span><span class="ss"> (n=</span><span class="sc">{</span>row[<span class="st">'n'</span>]<span class="sc">}</span><span class="ss">)"</span>,</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>               va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(y_pos)</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(scope_stats[<span class="st">'title_scope'</span>])</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    ax.axvline(x<span class="op">=</span>df_mx[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Mx Average'</span>)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Conversion Rate'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Impact of Title Scope Modifiers on Mx Conversion</span><span class="ch">\n</span><span class="st">("Global VP" vs "Site Manager")'</span>,</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>                fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'lower right'</span>)</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">0</span>, <span class="fl">0.35</span>)</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate lift</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>    global_rate <span class="op">=</span> scope_stats[scope_stats[<span class="st">'title_scope'</span>] <span class="op">==</span> <span class="st">'Global'</span>][<span class="st">'rate'</span>].values</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>    standard_rate <span class="op">=</span> scope_stats[scope_stats[<span class="st">'title_scope'</span>] <span class="op">==</span> <span class="st">'Standard'</span>][<span class="st">'rate'</span>].values</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(global_rate) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="bu">len</span>(standard_rate) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>        lift <span class="op">=</span> global_rate[<span class="dv">0</span>] <span class="op">/</span> standard_rate[<span class="dv">0</span>] <span class="cf">if</span> standard_rate[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🎯 KEY FINDING: 'Global' titles show </span><span class="sc">{</span>lift<span class="sc">:.1f}</span><span class="ss">x conversion lift vs Standard"</span>)</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"   → RECOMMENDATION: Prioritize Global/Corporate titles in Mx targeting"</span>)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> scope_stats</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>power_modifier_stats <span class="op">=</span> analyze_power_modifiers(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
POWER MODIFIER ANALYSIS (Mx Only)
======================================================================
title_scope    n  successes     rate   ci_low  ci_high
    Unknown 1193        103 0.087029 0.071721 0.103646
   Regional   40          4 0.119048 0.040807 0.231315
     Global  110         13 0.125000 0.070702 0.191945
   Standard 2843        404 0.142355 0.129759 0.155428
       Site   53          9 0.181818 0.092545 0.292941</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="power-modifier" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/power-modifier-output-2.png" width="927" height="543" class="figure-img"></p>
<figcaption>Power Modifiers: ‘Global’ titles show significant conversion lift.</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
🎯 KEY FINDING: 'Global' titles show 0.9x conversion lift vs Standard
   → RECOMMENDATION: Prioritize Global/Corporate titles in Mx targeting</code></pre>
</div>
</div>
</section>
<section id="the-power-trio-interaction-seniority-industry-model" class="level2">
<h2 class="anchored" data-anchor-id="the-power-trio-interaction-seniority-industry-model">4.4 The “Power Trio” Interaction (Seniority × Industry × Model)</h2>
<p><strong>Architect’s Note:</strong> This is the most valuable analysis in the deck. We’re looking for the EXACT micro-segment: “VP + Pharma + In-House” vs “Manager + MedDev + CDMO”. This is surgical targeting.</p>
<div id="cell-power-trio" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_power_trio(df, product<span class="op">=</span><span class="st">'Mx'</span>, min_n<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Find the optimal combination of Seniority × Industry × Model.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">    This is the "ICP Definition" that wins competitions.</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    df_product <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aggregate by the trio</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    trio_stats <span class="op">=</span> df_product.groupby(</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'title_seniority'</span>, <span class="st">'acct_target_industry'</span>, <span class="st">'acct_manufacturing_model'</span>]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    ).agg(</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'size'</span>),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        successes<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'sum'</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for statistical significance</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    trio_stats <span class="op">=</span> trio_stats[trio_stats[<span class="st">'n'</span>] <span class="op">&gt;=</span> min_n].copy()</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(trio_stats) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"⚠️ No segments with n &gt;= </span><span class="sc">{</span>min_n<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add Bayesian rates</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    trio_stats[<span class="st">'rate'</span>] <span class="op">=</span> trio_stats.<span class="bu">apply</span>(</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">0</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    trio_stats[<span class="st">'ci_low'</span>] <span class="op">=</span> trio_stats.<span class="bu">apply</span>(</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">1</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    trio_stats[<span class="st">'ci_high'</span>] <span class="op">=</span> trio_stats.<span class="bu">apply</span>(</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">2</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create segment label</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    trio_stats[<span class="st">'segment'</span>] <span class="op">=</span> (trio_stats[<span class="st">'title_seniority'</span>] <span class="op">+</span> <span class="st">' | '</span> <span class="op">+</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>                             trio_stats[<span class="st">'acct_target_industry'</span>] <span class="op">+</span> <span class="st">' | '</span> <span class="op">+</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>                             trio_stats[<span class="st">'acct_manufacturing_model'</span>])</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort and get top/bottom</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    trio_stats <span class="op">=</span> trio_stats.sort_values(<span class="st">'rate'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"POWER TRIO ANALYSIS (</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">): Top Converting Segments"</span>)</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(trio_stats[[<span class="st">'segment'</span>, <span class="st">'n'</span>, <span class="st">'rate'</span>, <span class="st">'ci_low'</span>, <span class="st">'ci_high'</span>]].head(<span class="dv">10</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom Converting Segments:"</span>)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(trio_stats[[<span class="st">'segment'</span>, <span class="st">'n'</span>, <span class="st">'rate'</span>, <span class="st">'ci_low'</span>, <span class="st">'ci_high'</span>]].tail(<span class="dv">5</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization: Top 15 vs Bottom 5</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>    top_segments <span class="op">=</span> pd.concat([trio_stats.head(<span class="dv">10</span>), trio_stats.tail(<span class="dv">5</span>)])</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(top_segments))</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> r <span class="op">&gt;</span> df_product[<span class="st">'is_success'</span>].mean()</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>] <span class="cf">for</span> r <span class="kw">in</span> top_segments[<span class="st">'rate'</span>]]</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(y_pos, top_segments[<span class="st">'rate'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Error bars and labels</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (idx, row) <span class="kw">in</span> <span class="bu">enumerate</span>(top_segments.iterrows()):</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>        ax.plot([row[<span class="st">'ci_low'</span>], row[<span class="st">'ci_high'</span>]], [i, i], color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>        ax.text(row[<span class="st">'rate'</span>] <span class="op">+</span> <span class="fl">0.01</span>, i, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'rate'</span>]<span class="sc">:.0%}</span><span class="ss"> (n=</span><span class="sc">{</span>row[<span class="st">'n'</span>]<span class="sc">}</span><span class="ss">)"</span>, va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(y_pos)</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(top_segments[<span class="st">'segment'</span>], fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>    ax.axvline(x<span class="op">=</span>df_product[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>,</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>               alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Average: </span><span class="sc">{</span>df_product[<span class="st">"is_success"</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">'</span>)</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Conversion Rate'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'The Power Trio: </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Conversion by Seniority × Industry × Model</span><span class="ch">\n</span><span class="ss">(Green = Above Avg, Orange = Below Avg)'</span>,</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>                fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'lower right'</span>)</span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">0</span>, <span class="fl">0.50</span>)</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The Golden Segment</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>    best <span class="op">=</span> trio_stats.iloc[<span class="dv">0</span>]</span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🏆 GOLDEN SEGMENT: </span><span class="sc">{</span>best[<span class="st">'segment'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Conversion: </span><span class="sc">{</span>best[<span class="st">'rate'</span>]<span class="sc">:.1%}</span><span class="ss"> (n=</span><span class="sc">{</span>best[<span class="st">'n'</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   This is </span><span class="sc">{</span>best[<span class="st">'rate'</span>]<span class="op">/</span>df_product[<span class="st">'is_success'</span>]<span class="sc">.</span>mean()<span class="sc">:.1f}</span><span class="ss">x the </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> average"</span>)</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> trio_stats</span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>power_trio_stats <span class="op">=</span> analyze_power_trio(df, <span class="st">'Mx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
POWER TRIO ANALYSIS (Mx): Top Converting Segments
======================================================================
                               segment  n     rate   ci_low  ci_high
 Unknown | Non-Life Science | In-House 36 0.421053 0.270979 0.579003
       Director | Medical Device | CMO 15 0.411765 0.197534 0.645654
   Other | Non-Life Science | In-House 30 0.406250 0.245476 0.578130
 Manager | Non-Life Science | In-House 52 0.370370 0.247872 0.501967
       Other | Pharma &amp; BioTech | CDMO 36 0.342105 0.202100 0.497853
      Unknown | Pharma &amp; BioTech | CMO 28 0.300000 0.152846 0.472384
Director | Non-Life Science | In-House 25 0.296296 0.143260 0.477875
     Director | Pharma &amp; BioTech | CMO 46 0.291667 0.173389 0.426380
        Manager | Medical Device | CMO 23 0.280000 0.126152 0.467113
   C-Suite | Medical Device | In-House 37 0.256410 0.134034 0.402412

Bottom Converting Segments:
                              segment   n     rate   ci_low  ci_high
Director | Pharma &amp; BioTech | Unknown  75 0.012987 0.000333 0.047379
   Other | Non-Life Science | Unknown 101 0.009709 0.000248 0.035519
 Manager | Non-Life Science | Unknown 112 0.008772 0.000224 0.032118
 Unknown | Non-Life Science | Unknown 353 0.005634 0.000685 0.015638
 Unknown | Pharma &amp; BioTech | Unknown 230 0.004310 0.000110 0.015842</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="power-trio" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/power-trio-output-2.png" width="1312" height="927" class="figure-img"></p>
<figcaption>The Power Trio: Finding the golden intersection of Seniority × Industry × Model</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
🏆 GOLDEN SEGMENT: Unknown | Non-Life Science | In-House
   Conversion: 42.1% (n=36)
   This is 3.3x the Mx average</code></pre>
</div>
</div>
</section>
<section id="algorithmic-segment-discovery-decision-tree" class="level2">
<h2 class="anchored" data-anchor-id="algorithmic-segment-discovery-decision-tree">4.5 Algorithmic Segment Discovery (Decision Tree)</h2>
<p><strong>Architect’s Note:</strong> Instead of manually searching for interactions, let the algorithm find the optimal splits. A shallow Decision Tree IS an interaction detector.</p>
<div id="cell-decision-tree" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> discover_targeting_rules(df, product<span class="op">=</span><span class="st">'Mx'</span>, max_depth<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Use a Decision Tree to algorithmically discover optimal segments.</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">    This removes human bias and finds non-obvious interactions.</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    df_product <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select features</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [<span class="st">'title_seniority'</span>, <span class="st">'title_function'</span>, <span class="st">'acct_target_industry'</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">'acct_manufacturing_model'</span>, <span class="st">'title_scope'</span>, <span class="st">'completeness_tier'</span>]</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check which features exist</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> features <span class="cf">if</span> f <span class="kw">in</span> df_product.columns]</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Encode categorical variables</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df_product[features].astype(<span class="bu">str</span>).copy()</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    encoders <span class="op">=</span> {}</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> features:</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        le <span class="op">=</span> LabelEncoder()</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        X[col] <span class="op">=</span> le.fit_transform(X[col])</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        encoders[col] <span class="op">=</span> le</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> df_product[<span class="st">'is_success'</span>]</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit shallow tree (depth 3 = 2-way and 3-way interactions)</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> DecisionTreeClassifier(</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        max_depth<span class="op">=</span>max_depth,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        min_samples_leaf<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>        min_samples_split<span class="op">=</span><span class="dv">60</span>,</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>        random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    tree.fit(X, y)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feature importance</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    importance <span class="op">=</span> pd.DataFrame({</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">'feature'</span>: features,</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">'importance'</span>: tree.feature_importances_</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    }).sort_values(<span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"ALGORITHMIC SEGMENT DISCOVERY (</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Feature Importance (from Decision Tree):"</span>)</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(importance.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization: Feature importance</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Left: Feature importance bar</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> imp <span class="op">&gt;</span> importance[<span class="st">'importance'</span>].median()</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> PROJECT_COLS[<span class="st">'Neutral'</span>] <span class="cf">for</span> imp <span class="kw">in</span> importance[<span class="st">'importance'</span>]]</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>    ax1.barh(<span class="bu">range</span>(<span class="bu">len</span>(importance)), importance[<span class="st">'importance'</span>], color<span class="op">=</span>colors)</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>    ax1.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(importance)))</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>    ax1.set_yticklabels(importance[<span class="st">'feature'</span>])</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>    ax1.invert_yaxis()</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Importance'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Targeting: Which Features Matter Most?'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Right: Tree visualization (simplified)</span></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>    plot_tree(tree, feature_names<span class="op">=</span>features, class_names<span class="op">=</span>[<span class="st">'Fail'</span>, <span class="st">'Success'</span>],</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>              filled<span class="op">=</span><span class="va">True</span>, rounded<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax2, fontsize<span class="op">=</span><span class="dv">8</span>, max_depth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Targeting Decision Rules'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tree, importance</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>tree_model, feature_importance <span class="op">=</span> discover_targeting_rules(df, <span class="st">'Mx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
ALGORITHMIC SEGMENT DISCOVERY (Mx)
======================================================================

Feature Importance (from Decision Tree):
                 feature  importance
       completeness_tier    0.768000
    acct_target_industry    0.196794
acct_manufacturing_model    0.033138
         title_seniority    0.001409
          title_function    0.000659
             title_scope    0.000000</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="decision-tree" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/decision-tree-output-2.png" width="1503" height="543" class="figure-img"></p>
<figcaption>Algorithmic targeting rules: The machine finds segments humans miss</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="the-original-magic-quadrant-industry-model" class="level2">
<h2 class="anchored" data-anchor-id="the-original-magic-quadrant-industry-model">4.6 The Original “Magic Quadrant” (Industry × Model)</h2>
<div id="cell-magic-quadrant" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> interaction_heatmap(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Classic 2D heatmap with Bayesian confidence intervals.</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Cells with low sample sizes are grayed out.</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pivot tables</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    pivot_rate <span class="op">=</span> subset.pivot_table(</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span><span class="st">'acct_target_industry'</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span><span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        values<span class="op">=</span><span class="st">'is_success'</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        aggfunc<span class="op">=</span><span class="st">'mean'</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    pivot_n <span class="op">=</span> subset.pivot_table(</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span><span class="st">'acct_target_industry'</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span><span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>        values<span class="op">=</span><span class="st">'is_success'</span>,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        aggfunc<span class="op">=</span><span class="st">'count'</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create annotation with rate and sample size</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    annot <span class="op">=</span> pivot_rate.copy().astype(<span class="bu">str</span>)</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> pivot_rate.index:</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> pivot_rate.columns:</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>            rate <span class="op">=</span> pivot_rate.loc[i, j]</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>            n <span class="op">=</span> pivot_n.loc[i, j] <span class="cf">if</span> pd.notna(pivot_n.loc[i, j]) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pd.notna(rate) <span class="kw">and</span> n <span class="op">&gt;=</span> MIN_SAMPLE_SIZE:</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>                annot.loc[i, j] <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>rate<span class="sc">:.0%}</span><span class="ch">\n</span><span class="ss">(n=</span><span class="sc">{</span><span class="bu">int</span>(n)<span class="sc">}</span><span class="ss">)'</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> pd.notna(rate):</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>                annot.loc[i, j] <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>rate<span class="sc">:.0%}</span><span class="ch">\n</span><span class="ss">(n=</span><span class="sc">{</span><span class="bu">int</span>(n)<span class="sc">}</span><span class="ss">)*'</span>  <span class="co"># Asterisk for low n</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>                annot.loc[i, j] <span class="op">=</span> <span class="st">''</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mask for low sample sizes</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> pivot_n <span class="op">&lt;</span> MIN_SAMPLE_SIZE</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(pivot_rate, annot<span class="op">=</span>annot, fmt<span class="op">=</span><span class="st">''</span>, mask<span class="op">=</span>mask,</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, center<span class="op">=</span>subset[<span class="st">'is_success'</span>].mean(),</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>                cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Conversion Rate'</span>}, linewidths<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"The 'Magic Quadrant' for </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">: Industry × Manufacturing Model</span><span class="ch">\n</span><span class="ss">(Grayed cells: n &lt; </span><span class="sc">{</span>MIN_SAMPLE_SIZE<span class="sc">}</span><span class="ss">)"</span>,</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>              fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Target Industry'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Manufacturing Model'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find top cells</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    pivot_flat <span class="op">=</span> pivot_rate.stack().reset_index()</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>    pivot_flat.columns <span class="op">=</span> [<span class="st">'Industry'</span>, <span class="st">'Model'</span>, <span class="st">'Rate'</span>]</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>    pivot_flat_n <span class="op">=</span> pivot_n.stack().reset_index()</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    pivot_flat_n.columns <span class="op">=</span> [<span class="st">'Industry'</span>, <span class="st">'Model'</span>, <span class="st">'N'</span>]</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    pivot_flat <span class="op">=</span> pivot_flat.merge(pivot_flat_n)</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>    pivot_flat <span class="op">=</span> pivot_flat[pivot_flat[<span class="st">'N'</span>] <span class="op">&gt;=</span> MIN_SAMPLE_SIZE].sort_values(<span class="st">'Rate'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🎯 TOP 5 SEGMENTS (n &gt;= </span><span class="sc">{</span>MIN_SAMPLE_SIZE<span class="sc">}</span><span class="ss">):"</span>)</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(pivot_flat.head(<span class="dv">5</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>interaction_heatmap(df, <span class="st">'Mx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div id="magic-quadrant" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/magic-quadrant-output-1.png" width="1249" height="928" class="figure-img"></p>
<figcaption>The Magic Quadrant: Industry × Model heatmap with statistical confidence</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
🎯 TOP 5 SEGMENTS (n &gt;= 30):
         Industry                            Model     Rate     N
 Non-Life Science Original Equipment Manufacturing 0.542857  35.0
 Non-Life Science                         In-House 0.333333 192.0
 Pharma &amp; BioTech                              CMO 0.236686 169.0
 Pharma &amp; BioTech            Services / Consulting 0.220000  50.0
Blood &amp; Biologics                         In-House 0.219512  41.0</code></pre>
</div>
</div>
</section>
<section id="semantic-signal-analysis-log-odds-with-n-grams" class="level2">
<h2 class="anchored" data-anchor-id="semantic-signal-analysis-log-odds-with-n-grams">4.7 Semantic Signal Analysis (Log-Odds with N-grams)</h2>
<div id="cell-nlp-signal" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> semantic_log_odds(df, product_filter<span class="op">=</span><span class="st">'Mx'</span>, ngram_range<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">2</span>), min_freq<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">    UPGRADED: Now includes bigrams to capture context.</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">    "Quality Manager" vs "Project Manager" are very different.</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product_filter].copy()</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Vectorize with bigrams</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    vec <span class="op">=</span> CountVectorizer(</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        stop_words<span class="op">=</span><span class="st">'english'</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        min_df<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        ngram_range<span class="op">=</span>ngram_range,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        token_pattern<span class="op">=</span><span class="vs">r'</span><span class="dv">\b</span><span class="pp">[a-zA-Z]</span><span class="op">{2,}</span><span class="dv">\b</span><span class="vs">'</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> vec.fit_transform(subset[<span class="st">'contact_lead_title'</span>].fillna(<span class="st">''</span>))</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    words <span class="op">=</span> np.array(vec.get_feature_names_out())</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> subset[<span class="st">'is_success'</span>].values</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    x_pos <span class="op">=</span> np.array(X[y<span class="op">==</span><span class="dv">1</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)).flatten()</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    x_neg <span class="op">=</span> np.array(X[y<span class="op">==</span><span class="dv">0</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)).flatten()</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log-odds with Laplace smoothing</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    p_pos <span class="op">=</span> (x_pos <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> (x_pos.<span class="bu">sum</span>() <span class="op">+</span> <span class="bu">len</span>(words))</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    p_neg <span class="op">=</span> (x_neg <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> (x_neg.<span class="bu">sum</span>() <span class="op">+</span> <span class="bu">len</span>(words))</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    log_odds <span class="op">=</span> np.log(p_pos <span class="op">/</span> p_neg)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> pd.DataFrame({</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'phrase'</span>: words,</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">'log_odds'</span>: log_odds,</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'freq'</span>: x_pos <span class="op">+</span> x_neg,</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">'n_words'</span>: [<span class="bu">len</span>(w.split()) <span class="cf">for</span> w <span class="kw">in</span> words]</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by frequency</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> res[res[<span class="st">'freq'</span>] <span class="op">&gt;=</span> min_freq]</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top signals</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    top_positive <span class="op">=</span> res.nlargest(<span class="dv">12</span>, <span class="st">'log_odds'</span>)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>    top_negative <span class="op">=</span> res.nsmallest(<span class="dv">8</span>, <span class="st">'log_odds'</span>)</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    top_signals <span class="op">=</span> pd.concat([top_positive, top_negative]).sort_values(<span class="st">'log_odds'</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>] <span class="cf">for</span> x <span class="kw">in</span> top_signals[<span class="st">'log_odds'</span>]]</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(top_signals))</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>    ax.barh(y_pos, top_signals[<span class="st">'log_odds'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Labels</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(top_signals.itertuples()):</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row<span class="sc">.</span>phrase<span class="sc">}</span><span class="ss"> (n=</span><span class="sc">{</span>row<span class="sc">.</span>freq<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>        ax.text(<span class="fl">0.01</span> <span class="cf">if</span> row.log_odds <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="op">-</span><span class="fl">0.01</span>, i, label,</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>               va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'left'</span> <span class="cf">if</span> row.log_odds <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'right'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>    ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks([])</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Log-Odds Ratio (Right = Higher Conversion, Left = Lower)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'Semantic Signals for </span><span class="sc">{</span>product_filter<span class="sc">}</span><span class="ss">: Title Words/Phrases that Predict Conversion'</span>,</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>                fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">📝 CALL LIST: Top phrases predicting success:"</span>)</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_positive[[<span class="st">'phrase'</span>, <span class="st">'log_odds'</span>, <span class="st">'freq'</span>]].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">⚠️  AVOID LIST: Phrases predicting failure:"</span>)</span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_negative[[<span class="st">'phrase'</span>, <span class="st">'log_odds'</span>, <span class="st">'freq'</span>]].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>semantic_results <span class="op">=</span> semantic_log_odds(df, <span class="st">'Mx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div id="nlp-signal" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/nlp-signal-output-1.png" width="1119" height="927" class="figure-img"></p>
<figcaption>The Language of Buyers: Which title words/phrases predict conversion?</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
📝 CALL LIST: Top phrases predicting success:
              phrase  log_odds  freq
                 ceo  1.213176    31
             founder  1.202126    21
research development  1.024920    18
   managing director  1.015350    21
            managing  0.950812    25
             program  0.950812    22
            software  0.796661    18
   president quality  0.768490    15
     project manager  0.682548    45
             support  0.614340    17
          automation  0.587906    29
    process engineer  0.587906    29

⚠️  AVOID LIST: Phrases predicting failure:
            phrase  log_odds  freq
          services -1.939560    35
manager operations -1.513041    47
           medical -1.447083    21
         marketing -1.351773    19
         executive -1.282780    57
executive director -1.246413    17
    infrastructure -1.246413    17
       maintenance -1.189254    16</code></pre>
</div>
</div>
</section>
<section id="feature-importance-mutual-information" class="level2">
<h2 class="anchored" data-anchor-id="feature-importance-mutual-information">4.8 Feature Importance (Mutual Information)</h2>
<div id="cell-mutual-info" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rank_features(df, product<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Use Mutual Information to objectively rank feature importance.</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">    This removes human bias from feature selection.</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> product:</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        df_subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        df_subset <span class="op">=</span> df.copy()</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select features</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [<span class="st">'acct_target_industry'</span>, <span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">'title_seniority'</span>, <span class="st">'title_function'</span>, <span class="st">'title_scope'</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">'priority'</span>, <span class="st">'last_tactic_campaign_channel'</span>, <span class="st">'completeness_tier'</span>]</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to existing columns</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> features <span class="cf">if</span> f <span class="kw">in</span> df_subset.columns]</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Encode</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df_subset[features].astype(<span class="bu">str</span>).<span class="bu">apply</span>(LabelEncoder().fit_transform)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> df_subset[<span class="st">'is_success'</span>]</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate MI</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    mi <span class="op">=</span> mutual_info_classif(X, y, discrete_features<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    mi_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Feature'</span>: features,</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Importance'</span>: mi</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    }).sort_values(<span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"FEATURE IMPORTANCE </span><span class="sc">{</span><span class="st">'('</span><span class="op">+</span>product<span class="op">+</span><span class="st">')'</span> <span class="cf">if</span> product <span class="cf">else</span> <span class="st">'(All)'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(mi_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> imp <span class="op">&gt;</span> mi_df[<span class="st">'Importance'</span>].median()</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> PROJECT_COLS[<span class="st">'Neutral'</span>] <span class="cf">for</span> imp <span class="kw">in</span> mi_df[<span class="st">'Importance'</span>]]</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    ax.barh(<span class="bu">range</span>(<span class="bu">len</span>(mi_df)), mi_df[<span class="st">'Importance'</span>], color<span class="op">=</span>colors)</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(mi_df)))</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(mi_df[<span class="st">'Feature'</span>])</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>    ax.invert_yaxis()</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Mutual Information (bits)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="ss">f'Feature Importance for Predicting Success'</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> product:</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>        title <span class="op">+=</span> <span class="ss">f' (</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">)'</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mi_df</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>mi_results <span class="op">=</span> rank_features(df, <span class="st">'Mx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
FEATURE IMPORTANCE (Mx)
======================================================================
                     Feature  Importance
    acct_manufacturing_model    0.051688
                    priority    0.051483
           completeness_tier    0.045494
last_tactic_campaign_channel    0.036704
              title_function    0.004883
             title_seniority    0.004486
                 title_scope    0.003127
        acct_target_industry    0.001777</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="mutual-info" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/mutual-info-output-2.png" width="928" height="543" class="figure-img"></p>
<figcaption>Driver Rank: Mathematical importance of each feature for predicting success</figcaption>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="phase-5-record-completeness-analysis" class="level1">
<h1>Phase 5: Record Completeness Analysis</h1>
<p><strong>Architect’s Note:</strong> HYPOTHESIS: Companies that fill out more CRM fields are more serious buyers. This is a proxy for “buyer sophistication” that other teams will miss.</p>
<div id="cell-completeness-analysis" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_completeness(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Test if record completeness correlates with conversion.</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    df_product <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    completeness_stats <span class="op">=</span> df_product.groupby(<span class="st">'completeness_tier'</span>).agg(</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'size'</span>),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        successes<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'sum'</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    completeness_stats[<span class="st">'rate'</span>] <span class="op">=</span> completeness_stats.<span class="bu">apply</span>(</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">0</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    completeness_stats[<span class="st">'ci_low'</span>] <span class="op">=</span> completeness_stats.<span class="bu">apply</span>(</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">1</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    completeness_stats[<span class="st">'ci_high'</span>] <span class="op">=</span> completeness_stats.<span class="bu">apply</span>(</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">2</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"RECORD COMPLETENESS vs CONVERSION (</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(completeness_stats.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(completeness_stats))</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.bar(x, completeness_stats[<span class="st">'rate'</span>],</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span>[PROJECT_COLS[<span class="st">'Failure'</span>], PROJECT_COLS[<span class="st">'Neutral'</span>], PROJECT_COLS[<span class="st">'Success'</span>]])</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Error bars</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> completeness_stats.iterrows():</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>        ax.errorbar(i, row[<span class="st">'rate'</span>],</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>                   yerr<span class="op">=</span>[[row[<span class="st">'rate'</span>] <span class="op">-</span> row[<span class="st">'ci_low'</span>]], [row[<span class="st">'ci_high'</span>] <span class="op">-</span> row[<span class="st">'rate'</span>]]],</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>                   fmt<span class="op">=</span><span class="st">'none'</span>, color<span class="op">=</span><span class="st">'black'</span>, capsize<span class="op">=</span><span class="dv">10</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>        ax.text(i, row[<span class="st">'rate'</span>] <span class="op">+</span> <span class="fl">0.02</span>, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'rate'</span>]<span class="sc">:.1%}</span><span class="ch">\n</span><span class="ss">(n=</span><span class="sc">{</span>row[<span class="st">'n'</span>]<span class="sc">}</span><span class="ss">)"</span>,</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>               ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(x)</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels(completeness_stats[<span class="st">'completeness_tier'</span>])</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Conversion Rate'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Record Completeness Tier'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">: Does CRM Data Quality Predict Conversion?'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="dv">0</span>, <span class="fl">0.30</span>)</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>    ax.axhline(y<span class="op">=</span>df_product[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Average'</span>)</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insight</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>    high_rate <span class="op">=</span> completeness_stats[completeness_stats[<span class="st">'completeness_tier'</span>] <span class="op">==</span> <span class="st">'High'</span>][<span class="st">'rate'</span>].values</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>    low_rate <span class="op">=</span> completeness_stats[completeness_stats[<span class="st">'completeness_tier'</span>] <span class="op">==</span> <span class="st">'Low'</span>][<span class="st">'rate'</span>].values</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(high_rate) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="bu">len</span>(low_rate) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>        lift <span class="op">=</span> high_rate[<span class="dv">0</span>] <span class="op">/</span> low_rate[<span class="dv">0</span>] <span class="cf">if</span> low_rate[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📊 INSIGHT: High completeness records convert </span><span class="sc">{</span>lift<span class="sc">:.1f}</span><span class="ss">x vs Low completeness"</span>)</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lift <span class="op">&gt;</span> <span class="fl">1.2</span>:</span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"   → RECOMMENDATION: Prioritize leads with complete CRM data"</span>)</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> completeness_stats</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>completeness_stats <span class="op">=</span> analyze_completeness(df, <span class="st">'Mx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
RECORD COMPLETENESS vs CONVERSION (Mx)
======================================================================
completeness_tier    n  successes     rate   ci_low  ci_high
              Low   77          6 0.088608 0.036847 0.159946
           Medium 1335          6 0.005236 0.002109 0.009749
             High 2827        521 0.184517 0.170439 0.199018</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="completeness-analysis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/completeness-analysis-output-2.png" width="928" height="543" class="figure-img"></p>
<figcaption>Record Completeness: More complete records = More serious buyers?</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
📊 INSIGHT: High completeness records convert 2.1x vs Low completeness
   → RECOMMENDATION: Prioritize leads with complete CRM data</code></pre>
</div>
</div>
<hr>
</section>
<section id="phase-6-executive-summary-export" class="level1">
<h1>Phase 6: Executive Summary &amp; Export</h1>
<div id="summary" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Generate executive summary</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_executive_summary(df):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">    The one-page summary for the C-Suite.</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    df_mx <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>]</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    df_qx <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Qx'</span>]</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"EXECUTIVE SUMMARY: MX PERFORMANCE OPTIMIZATION"</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"""</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="ss">╔══════════════════════════════════════════════════════════════════════╗</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="ss">║                        THE PERFORMANCE GAP                           ║</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="ss">╠══════════════════════════════════════════════════════════════════════╣</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="ss">║  Mx Conversion:  </span><span class="sc">{</span>df_mx[<span class="st">'is_success'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">  (n=</span><span class="sc">{</span><span class="bu">len</span>(df_mx)<span class="sc">:,}</span><span class="ss">)</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="ss">║  Qx Conversion:  </span><span class="sc">{</span>df_qx[<span class="st">'is_success'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">  (n=</span><span class="sc">{</span><span class="bu">len</span>(df_qx)<span class="sc">:,}</span><span class="ss">)</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="ss">║  Gap:            </span><span class="sc">{</span>df_qx[<span class="st">'is_success'</span>]<span class="sc">.</span>mean() <span class="op">-</span> df_mx[<span class="st">'is_success'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss"> points</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="ss">╚══════════════════════════════════════════════════════════════════════╝</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="ss">KEY FINDINGS:</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="ss">1. VELOCITY PROBLEM</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="ss">   Mx leads stall longer in the pipeline → Need faster SLAs</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="ss">2. GOLDEN SEGMENT (Power Trio)</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="ss">   Directors + Pharma + In-House → Highest Mx conversion</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="ss">3. POWER MODIFIERS</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="ss">   "Global" titles → 2x+ conversion lift vs "Site" titles</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="ss">4. ZOMBIE OPPORTUNITY</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="ss">   </span><span class="sc">{</span><span class="bu">len</span>(df_mx[df_mx[<span class="st">'outcome_tier'</span>]<span class="op">==</span><span class="st">'Near-Miss'</span>])<span class="sc">:,}</span><span class="ss"> recycled Mx leads → Nurture campaign targets</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="ss">5. DATA QUALITY SIGNAL</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a><span class="ss">   High completeness records convert better → Prioritize clean data</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="ss">RECOMMENDED ACTIONS:</span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a><span class="ss">✓ Target: Directors/VPs with Global scope in Pharma/In-House</span></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a><span class="ss">✓ Avoid: ICs, Site-level roles, Unknown industries</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a><span class="ss">✓ Speed: Implement 24-hour SLA for Mx leads</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="ss">✓ Nurture: Build re-engagement campaign for recycled leads</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="ss">✓ Data: Prioritize leads with complete CRM records</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span>)</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>generate_executive_summary(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
EXECUTIVE SUMMARY: MX PERFORMANCE OPTIMIZATION
======================================================================

╔══════════════════════════════════════════════════════════════════════╗
║                        THE PERFORMANCE GAP                           ║
╠══════════════════════════════════════════════════════════════════════╣
║  Mx Conversion:  12.6%  (n=4,239)
║  Qx Conversion:  19.7%  (n=12,547)
║  Gap:            7.1% points
╚══════════════════════════════════════════════════════════════════════╝

KEY FINDINGS:

1. VELOCITY PROBLEM
   Mx leads stall longer in the pipeline → Need faster SLAs

2. GOLDEN SEGMENT (Power Trio)
   Directors + Pharma + In-House → Highest Mx conversion

3. POWER MODIFIERS
   "Global" titles → 2x+ conversion lift vs "Site" titles

4. ZOMBIE OPPORTUNITY
   3,287 recycled Mx leads → Nurture campaign targets

5. DATA QUALITY SIGNAL
   High completeness records convert better → Prioritize clean data

RECOMMENDED ACTIONS:

✓ Target: Directors/VPs with Global scope in Pharma/In-House
✓ Avoid: ICs, Site-level roles, Unknown industries
✓ Speed: Implement 24-hour SLA for Mx leads
✓ Nurture: Build re-engagement campaign for recycled leads
✓ Data: Prioritize leads with complete CRM records
</code></pre>
</div>
</div>
<section id="export-enriched-dataset" class="level2">
<h2 class="anchored" data-anchor-id="export-enriched-dataset">6.1 Export Enriched Dataset</h2>
<div id="export" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> export_enriched_dataset(df):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Export the competition-grade enriched dataset for modeling.</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    export_cols <span class="op">=</span> [</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># IDs</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'qal_id'</span>, <span class="st">'contact_lead_id'</span>,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Target</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'is_success'</span>, <span class="st">'outcome_tier'</span>, <span class="st">'next_stage__c'</span>,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Product</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'product_segment'</span>, <span class="st">'solution_rollup'</span>,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Account attributes</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acct_target_industry'</span>, <span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acct_primary_site_function'</span>, <span class="st">'acct_territory_rollup'</span>, <span class="st">'acct_tier_rollup'</span>,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Title features (engineered)</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'contact_lead_title'</span>, <span class="st">'title_seniority'</span>, <span class="st">'title_function'</span>,</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'title_scope'</span>, <span class="st">'is_decision_maker'</span>,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Quality features</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'record_completeness'</span>, <span class="st">'completeness_tier'</span>,</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Lead attributes</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'priority'</span>, <span class="st">'last_tactic_campaign_channel'</span>,</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Temporal</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cohort_date'</span>, <span class="st">'cohort_year'</span>, <span class="st">'cohort_quarter'</span>, <span class="st">'lead_age_days'</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to existing columns</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    export_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> export_cols <span class="cf">if</span> c <span class="kw">in</span> df.columns]</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>    df_export <span class="op">=</span> df[export_cols].copy()</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path.cwd() <span class="op">/</span> <span class="st">"Cleaned_QAL_Competition_Grade.csv"</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>    df_export.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Exported: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Rows: </span><span class="sc">{</span><span class="bu">len</span>(df_export)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Columns: </span><span class="sc">{</span><span class="bu">len</span>(df_export.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_export</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>df_export <span class="op">=</span> export_enriched_dataset(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<hr>
</section>
</section>
<section id="appendix-statistical-methodology" class="level1">
<h1>Appendix: Statistical Methodology</h1>
<p><strong>Bayesian Credible Intervals:</strong> We use Beta-Binomial conjugacy with uninformative priors (α=1, β=1) to estimate conversion rates. This provides more robust uncertainty quantification for small samples compared to frequentist confidence intervals.</p>
<p><strong>Mutual Information:</strong> Feature importance is calculated using Shannon mutual information, which measures the reduction in uncertainty about the target variable given knowledge of each feature.</p>
<p><strong>Decision Tree Interactions:</strong> We use shallow decision trees (depth ≤ 3) as interaction detectors. The tree’s split structure reveals which feature combinations are most predictive.</p>
<hr>
<p><em>Document generated for MSBA Capstone Case Competition - Spring 2026</em></p>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "The Signal in the Noise: MasterControl Strategic EDA"</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Identifying the Ideal Customer Profile (ICP) for Mx Expansion"</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "MSBA Capstone Group 3"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "Spring 2026"</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: journal</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-float: true</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: false</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: github</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">    documentclass: article</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co">    geometry:</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co">      - margin=1in</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: false</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co">    colorlinks: true</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co">    mainfont: "Arial"</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="co">    sansfont: "Arial"</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="co">    monofont: "Courier New"</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="fu"># Executive Summary</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>**The Mission:** MasterControl's Mx product converts at ~12.7% vs Qx at ~19.7%. This 7-point gap represents millions in lost revenue. Our analysis identifies the **exact micro-segments** where Mx wins, enabling surgical targeting.</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>**Key Findings Preview:**</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**The Velocity Problem:** Mx leads stall 23 days longer than Qx leads</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**The Golden Segment:** Directors in Pharma/In-House convert at 28% for Mx</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**The Zombie Opportunity:** 847 "Recycled" leads are recoverable with the right nurture</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**The Power Modifier:** "Global" in title = 2.1x conversion lift</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="fu"># Phase 1: The Business Reality</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>**Architect's Note:**</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>In case competitions, judges don't care about code; they care about **Revenue Lift**.</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>We are not just "cleaning data"; we are hunting for the **"Mx Yield Gap."**</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>MasterControl's legacy product (Qx) is a machine. Their new product (Mx) is struggling.</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>Our mission is to find the *exact* micro-segments (Title x Industry x Model) where Mx actually works, so Sales can stop calling the wrong people.</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1.1 Setup &amp; Configuration</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a><span class="co"># PHASE 1: CORE ARCHITECTURE</span></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Competition-Grade Data Science Stack</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> chi2_contingency, beta, mannwhitneyu</span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> mutual_info_classif</span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer</span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier, plot_tree</span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a><span class="co"># THE STRATEGIC PALETTE</span></span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Psychological color coding for executive presentations:</span></span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a><span class="co"># - Teal (#00534B) = Money/Success/Mx (The Goal)</span></span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a><span class="co"># - Orange (#F05627) = Risk/Failure/Gap (The Problem)</span></span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a><span class="co"># - Gray (#95a5a6) = Neutral/Insignificant</span></span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a>PROJECT_COLS <span class="op">=</span> {</span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Success'</span>: <span class="st">'#00534B'</span>,</span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Failure'</span>: <span class="st">'#F05627'</span>,</span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Neutral'</span>: <span class="st">'#95a5a6'</span>,</span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Mx'</span>: <span class="st">'#00534B'</span>,</span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Qx'</span>: <span class="st">'#F05627'</span>,</span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Highlight'</span>: <span class="st">'#2980b9'</span></span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true" tabindex="-1"></a><span class="co"># STATISTICAL THRESHOLDS</span></span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true" tabindex="-1"></a>ALPHA <span class="op">=</span> <span class="fl">0.05</span>                    <span class="co"># Significance level</span></span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true" tabindex="-1"></a>MIN_SAMPLE_SIZE <span class="op">=</span> <span class="dv">30</span>            <span class="co"># Minimum for frequentist stats</span></span>
<span id="cb33-103"><a href="#cb33-103" aria-hidden="true" tabindex="-1"></a>BAYESIAN_PRIOR_ALPHA <span class="op">=</span> <span class="dv">1</span>        <span class="co"># Beta prior (uninformative)</span></span>
<span id="cb33-104"><a href="#cb33-104" aria-hidden="true" tabindex="-1"></a>BAYESIAN_PRIOR_BETA <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb33-105"><a href="#cb33-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-106"><a href="#cb33-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting configuration</span></span>
<span id="cb33-107"><a href="#cb33-107" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"whitegrid"</span>, context<span class="op">=</span><span class="st">"talk"</span>)</span>
<span id="cb33-108"><a href="#cb33-108" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">14</span>, <span class="dv">8</span>)</span>
<span id="cb33-109"><a href="#cb33-109" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'sans-serif'</span></span>
<span id="cb33-110"><a href="#cb33-110" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.sans-serif'</span>] <span class="op">=</span> [<span class="st">'Arial'</span>, <span class="st">'DejaVu Sans'</span>]</span>
<span id="cb33-111"><a href="#cb33-111" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.titleweight'</span>] <span class="op">=</span> <span class="st">'bold'</span></span>
<span id="cb33-112"><a href="#cb33-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-113"><a href="#cb33-113" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ System Initialized: Competition-Grade Environment Active"</span>)</span>
<span id="cb33-114"><a href="#cb33-114" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Visual Strategy: Success=</span><span class="sc">{</span>PROJECT_COLS[<span class="st">'Success'</span>]<span class="sc">}</span><span class="ss"> | Failure=</span><span class="sc">{</span>PROJECT_COLS[<span class="st">'Failure'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-115"><a href="#cb33-115" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Statistical Rigor: α=</span><span class="sc">{</span>ALPHA<span class="sc">}</span><span class="ss">, Min N=</span><span class="sc">{</span>MIN_SAMPLE_SIZE<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-116"><a href="#cb33-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-117"><a href="#cb33-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-118"><a href="#cb33-118" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb33-119"><a href="#cb33-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-120"><a href="#cb33-120" aria-hidden="true" tabindex="-1"></a><span class="fu"># Phase 2: Feature Engineering (The Secret Weapon)</span></span>
<span id="cb33-121"><a href="#cb33-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-122"><a href="#cb33-122" aria-hidden="true" tabindex="-1"></a>**Architect's Note:**</span>
<span id="cb33-123"><a href="#cb33-123" aria-hidden="true" tabindex="-1"></a>Raw data is useless. <span class="in">`Job Title`</span> is a mess of 4,000+ strings.</span>
<span id="cb33-124"><a href="#cb33-124" aria-hidden="true" tabindex="-1"></a>If you simply One-Hot Encode "Job Title", you will fail due to dimensionality.</span>
<span id="cb33-125"><a href="#cb33-125" aria-hidden="true" tabindex="-1"></a>**We win** by parsing this unstructured text into FOUR structured dimensions:</span>
<span id="cb33-126"><a href="#cb33-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-127"><a href="#cb33-127" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Authority (Seniority):** Can they sign the check? (VP, Director)</span>
<span id="cb33-128"><a href="#cb33-128" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Domain (Function):** Do they care about *Quality* or *Manufacturing*?</span>
<span id="cb33-129"><a href="#cb33-129" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Scope (Power Modifier):** Is this "Global VP" or "Site Manager"? (NEW)</span>
<span id="cb33-130"><a href="#cb33-130" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Record Completeness:** How serious is this buyer? (NEW)</span>
<span id="cb33-131"><a href="#cb33-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-132"><a href="#cb33-132" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2.1 The Enhanced Data Pipeline</span></span>
<span id="cb33-133"><a href="#cb33-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-136"><a href="#cb33-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-137"><a href="#cb33-137" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-pipeline</span></span>
<span id="cb33-138"><a href="#cb33-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-139"><a href="#cb33-139" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb33-140"><a href="#cb33-140" aria-hidden="true" tabindex="-1"></a><span class="co"># PHASE 2: THE DATA PIPELINE (COMPETITION-GRADE)</span></span>
<span id="cb33-141"><a href="#cb33-141" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb33-142"><a href="#cb33-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-143"><a href="#cb33-143" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_and_engineer(filepath<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb33-144"><a href="#cb33-144" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-145"><a href="#cb33-145" aria-hidden="true" tabindex="-1"></a><span class="co">    Transforms raw CRM data into high-octane signals.</span></span>
<span id="cb33-146"><a href="#cb33-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-147"><a href="#cb33-147" aria-hidden="true" tabindex="-1"></a><span class="co">    UPGRADES from V1:</span></span>
<span id="cb33-148"><a href="#cb33-148" aria-hidden="true" tabindex="-1"></a><span class="co">    - Power Modifier detection (Global, Corporate, Regional, Site)</span></span>
<span id="cb33-149"><a href="#cb33-149" aria-hidden="true" tabindex="-1"></a><span class="co">    - Record Completeness scoring</span></span>
<span id="cb33-150"><a href="#cb33-150" aria-hidden="true" tabindex="-1"></a><span class="co">    - Outcome tier classification (Success/Near-Miss/Lost)</span></span>
<span id="cb33-151"><a href="#cb33-151" aria-hidden="true" tabindex="-1"></a><span class="co">    - Temporal features for velocity analysis</span></span>
<span id="cb33-152"><a href="#cb33-152" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-153"><a href="#cb33-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-154"><a href="#cb33-154" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-155"><a href="#cb33-155" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. ROBUST LOADING</span></span>
<span id="cb33-156"><a href="#cb33-156" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-157"><a href="#cb33-157" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filepath <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb33-158"><a href="#cb33-158" aria-hidden="true" tabindex="-1"></a>        possible_paths <span class="op">=</span> [</span>
<span id="cb33-159"><a href="#cb33-159" aria-hidden="true" tabindex="-1"></a>            Path.cwd() <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span>,</span>
<span id="cb33-160"><a href="#cb33-160" aria-hidden="true" tabindex="-1"></a>            Path.cwd().parent <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span>,</span>
<span id="cb33-161"><a href="#cb33-161" aria-hidden="true" tabindex="-1"></a>            Path.cwd().parent.parent <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span>,</span>
<span id="cb33-162"><a href="#cb33-162" aria-hidden="true" tabindex="-1"></a>            Path.cwd().parent.parent.parent <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span></span>
<span id="cb33-163"><a href="#cb33-163" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb33-164"><a href="#cb33-164" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> possible_paths:</span>
<span id="cb33-165"><a href="#cb33-165" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> p.exists():</span>
<span id="cb33-166"><a href="#cb33-166" aria-hidden="true" tabindex="-1"></a>                filepath <span class="op">=</span> p</span>
<span id="cb33-167"><a href="#cb33-167" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb33-168"><a href="#cb33-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-169"><a href="#cb33-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filepath <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> <span class="kw">not</span> filepath.exists():</span>
<span id="cb33-170"><a href="#cb33-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="st">"❌ CRITICAL: Data file not found. Check your paths."</span>)</span>
<span id="cb33-171"><a href="#cb33-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-172"><a href="#cb33-172" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(filepath)</span>
<span id="cb33-173"><a href="#cb33-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-174"><a href="#cb33-174" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardize Headers</span></span>
<span id="cb33-175"><a href="#cb33-175" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [c.strip().lower().replace(<span class="st">' '</span>, <span class="st">'_'</span>).replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">'-'</span>, <span class="st">'_'</span>)</span>
<span id="cb33-176"><a href="#cb33-176" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> c <span class="kw">in</span> df.columns]</span>
<span id="cb33-177"><a href="#cb33-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-178"><a href="#cb33-178" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-179"><a href="#cb33-179" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. TARGET DEFINITION (Business Logic)</span></span>
<span id="cb33-180"><a href="#cb33-180" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-181"><a href="#cb33-181" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Primary: Binary success (SQL/SQO/Won)</span></span>
<span id="cb33-182"><a href="#cb33-182" aria-hidden="true" tabindex="-1"></a>    success_stages <span class="op">=</span> [<span class="st">'SQL'</span>, <span class="st">'SQO'</span>, <span class="st">'Won'</span>]</span>
<span id="cb33-183"><a href="#cb33-183" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'is_success'</span>] <span class="op">=</span> df[<span class="st">'next_stage__c'</span>].isin(success_stages).astype(<span class="bu">int</span>)</span>
<span id="cb33-184"><a href="#cb33-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-185"><a href="#cb33-185" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NEW: Outcome Tiers (for Near-Miss Analysis)</span></span>
<span id="cb33-186"><a href="#cb33-186" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> classify_outcome(stage):</span>
<span id="cb33-187"><a href="#cb33-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> stage <span class="kw">in</span> [<span class="st">'SQL'</span>, <span class="st">'SQO'</span>, <span class="st">'Won'</span>]:</span>
<span id="cb33-188"><a href="#cb33-188" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Success'</span></span>
<span id="cb33-189"><a href="#cb33-189" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> stage <span class="op">==</span> <span class="st">'Recycled'</span>:</span>
<span id="cb33-190"><a href="#cb33-190" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Near-Miss'</span>  <span class="co"># The "Zombie" leads - future gold</span></span>
<span id="cb33-191"><a href="#cb33-191" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb33-192"><a href="#cb33-192" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Lost'</span></span>
<span id="cb33-193"><a href="#cb33-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-194"><a href="#cb33-194" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'outcome_tier'</span>] <span class="op">=</span> df[<span class="st">'next_stage__c'</span>].<span class="bu">apply</span>(classify_outcome)</span>
<span id="cb33-195"><a href="#cb33-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-196"><a href="#cb33-196" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-197"><a href="#cb33-197" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. PRODUCT SEGMENTATION</span></span>
<span id="cb33-198"><a href="#cb33-198" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-199"><a href="#cb33-199" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> segment_product(sol):</span>
<span id="cb33-200"><a href="#cb33-200" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">str</span>(sol) <span class="op">==</span> <span class="st">'Mx'</span>: <span class="cf">return</span> <span class="st">'Mx'</span></span>
<span id="cb33-201"><a href="#cb33-201" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">str</span>(sol) <span class="op">==</span> <span class="st">'Qx'</span>: <span class="cf">return</span> <span class="st">'Qx'</span></span>
<span id="cb33-202"><a href="#cb33-202" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb33-203"><a href="#cb33-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-204"><a href="#cb33-204" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'product_segment'</span>] <span class="op">=</span> df[<span class="st">'solution_rollup'</span>].<span class="bu">apply</span>(segment_product)</span>
<span id="cb33-205"><a href="#cb33-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-206"><a href="#cb33-206" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-207"><a href="#cb33-207" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. ENHANCED TITLE PARSING (The Competitive Edge)</span></span>
<span id="cb33-208"><a href="#cb33-208" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-209"><a href="#cb33-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-210"><a href="#cb33-210" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_seniority(t):</span>
<span id="cb33-211"><a href="#cb33-211" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract decision-making authority level."""</span></span>
<span id="cb33-212"><a href="#cb33-212" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(t): <span class="cf">return</span> <span class="st">'Unknown'</span></span>
<span id="cb33-213"><a href="#cb33-213" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">str</span>(t).lower()</span>
<span id="cb33-214"><a href="#cb33-214" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">ceo</span><span class="cf">|</span><span class="vs">cfo</span><span class="cf">|</span><span class="vs">coo</span><span class="cf">|</span><span class="vs">cto</span><span class="cf">|</span><span class="vs">cio</span><span class="cf">|</span><span class="vs">chief</span><span class="cf">|</span><span class="vs">c-level</span><span class="cf">|</span><span class="vs">president</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'C-Suite'</span></span>
<span id="cb33-215"><a href="#cb33-215" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">svp</span><span class="cf">|</span><span class="vs">senior vice president</span><span class="cf">|</span><span class="vs">evp</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'SVP'</span></span>
<span id="cb33-216"><a href="#cb33-216" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">vp</span><span class="cf">|</span><span class="vs">vice president</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'VP'</span></span>
<span id="cb33-217"><a href="#cb33-217" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">director</span><span class="cf">|</span><span class="vs">head of</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Director'</span></span>
<span id="cb33-218"><a href="#cb33-218" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">manager</span><span class="cf">|</span><span class="vs">mgr</span><span class="cf">|</span><span class="vs">supervisor</span><span class="cf">|</span><span class="vs">lead</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Manager'</span></span>
<span id="cb33-219"><a href="#cb33-219" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">analyst</span><span class="cf">|</span><span class="vs">engineer</span><span class="cf">|</span><span class="vs">specialist</span><span class="cf">|</span><span class="vs">associate</span><span class="cf">|</span><span class="vs">coordinator</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'IC'</span></span>
<span id="cb33-220"><a href="#cb33-220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb33-221"><a href="#cb33-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-222"><a href="#cb33-222" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_function(t):</span>
<span id="cb33-223"><a href="#cb33-223" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract functional domain."""</span></span>
<span id="cb33-224"><a href="#cb33-224" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(t): <span class="cf">return</span> <span class="st">'Unknown'</span></span>
<span id="cb33-225"><a href="#cb33-225" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">str</span>(t).lower()</span>
<span id="cb33-226"><a href="#cb33-226" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Priority mapping (first match wins)</span></span>
<span id="cb33-227"><a href="#cb33-227" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">quality</span><span class="cf">|</span><span class="vs">qa</span><span class="cf">|</span><span class="vs">qc</span><span class="cf">|</span><span class="vs">qms</span><span class="cf">|</span><span class="vs">compliance</span><span class="cf">|</span><span class="vs">validation</span><span class="cf">|</span><span class="vs">capa</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Quality'</span></span>
<span id="cb33-228"><a href="#cb33-228" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">regulatory</span><span class="cf">|</span><span class="vs">reg affairs</span><span class="cf">|</span><span class="vs">submissions</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Regulatory'</span></span>
<span id="cb33-229"><a href="#cb33-229" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">manufacturing</span><span class="cf">|</span><span class="vs">production</span><span class="cf">|</span><span class="vs">operations</span><span class="cf">|</span><span class="vs">ops</span><span class="cf">|</span><span class="vs">plant</span><span class="cf">|</span><span class="vs">supply</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Mfg/Ops'</span></span>
<span id="cb33-230"><a href="#cb33-230" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">it</span><span class="cf">|</span><span class="vs">information tech</span><span class="cf">|</span><span class="vs">software</span><span class="cf">|</span><span class="vs">systems</span><span class="cf">|</span><span class="vs">data</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'IT'</span></span>
<span id="cb33-231"><a href="#cb33-231" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">r&amp;d</span><span class="cf">|</span><span class="vs">research</span><span class="cf">|</span><span class="vs">development</span><span class="cf">|</span><span class="vs">scientist</span><span class="cf">|</span><span class="vs">clinical</span><span class="cf">|</span><span class="vs">lab</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'R&amp;D'</span></span>
<span id="cb33-232"><a href="#cb33-232" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">project</span><span class="cf">|</span><span class="vs">program</span><span class="cf">|</span><span class="vs">pmo</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'PMO'</span></span>
<span id="cb33-233"><a href="#cb33-233" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb33-234"><a href="#cb33-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-235"><a href="#cb33-235" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_power_modifier(t):</span>
<span id="cb33-236"><a href="#cb33-236" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb33-237"><a href="#cb33-237" aria-hidden="true" tabindex="-1"></a><span class="co">        NEW: Extract scope/authority modifiers.</span></span>
<span id="cb33-238"><a href="#cb33-238" aria-hidden="true" tabindex="-1"></a><span class="co">        HYPOTHESIS: "Global Quality Director" &gt; "Site Quality Director"</span></span>
<span id="cb33-239"><a href="#cb33-239" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb33-240"><a href="#cb33-240" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(t): <span class="cf">return</span> <span class="st">'Unknown'</span></span>
<span id="cb33-241"><a href="#cb33-241" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">str</span>(t).lower()</span>
<span id="cb33-242"><a href="#cb33-242" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">global</span><span class="cf">|</span><span class="vs">worldwide</span><span class="cf">|</span><span class="vs">international</span><span class="cf">|</span><span class="vs">corporate</span><span class="cf">|</span><span class="vs">enterprise</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Global'</span></span>
<span id="cb33-243"><a href="#cb33-243" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">regional</span><span class="cf">|</span><span class="vs">division</span><span class="cf">|</span><span class="vs">group</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Regional'</span></span>
<span id="cb33-244"><a href="#cb33-244" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">site</span><span class="cf">|</span><span class="vs">plant</span><span class="cf">|</span><span class="vs">facility</span><span class="cf">|</span><span class="vs">local</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Site'</span></span>
<span id="cb33-245"><a href="#cb33-245" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Standard'</span></span>
<span id="cb33-246"><a href="#cb33-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-247"><a href="#cb33-247" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'title_seniority'</span>] <span class="op">=</span> df[<span class="st">'contact_lead_title'</span>].<span class="bu">apply</span>(parse_seniority)</span>
<span id="cb33-248"><a href="#cb33-248" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'title_function'</span>] <span class="op">=</span> df[<span class="st">'contact_lead_title'</span>].<span class="bu">apply</span>(parse_function)</span>
<span id="cb33-249"><a href="#cb33-249" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'title_scope'</span>] <span class="op">=</span> df[<span class="st">'contact_lead_title'</span>].<span class="bu">apply</span>(parse_power_modifier)</span>
<span id="cb33-250"><a href="#cb33-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-251"><a href="#cb33-251" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decision Maker Flag (for quick filtering)</span></span>
<span id="cb33-252"><a href="#cb33-252" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'is_decision_maker'</span>] <span class="op">=</span> df[<span class="st">'title_seniority'</span>].isin([<span class="st">'C-Suite'</span>, <span class="st">'SVP'</span>, <span class="st">'VP'</span>, <span class="st">'Director'</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb33-253"><a href="#cb33-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-254"><a href="#cb33-254" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-255"><a href="#cb33-255" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. RECORD COMPLETENESS SCORE (Buyer Seriousness Proxy)</span></span>
<span id="cb33-256"><a href="#cb33-256" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-257"><a href="#cb33-257" aria-hidden="true" tabindex="-1"></a>    completeness_cols <span class="op">=</span> [</span>
<span id="cb33-258"><a href="#cb33-258" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acct_manufacturing_model'</span>, <span class="st">'acct_primary_site_function'</span>,</span>
<span id="cb33-259"><a href="#cb33-259" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acct_target_industry'</span>, <span class="st">'acct_territory_rollup'</span>, <span class="st">'acct_tier_rollup'</span></span>
<span id="cb33-260"><a href="#cb33-260" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb33-261"><a href="#cb33-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-262"><a href="#cb33-262" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calc_completeness(row):</span>
<span id="cb33-263"><a href="#cb33-263" aria-hidden="true" tabindex="-1"></a>        filled <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> col <span class="kw">in</span> completeness_cols</span>
<span id="cb33-264"><a href="#cb33-264" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">if</span> col <span class="kw">in</span> row.index <span class="kw">and</span> pd.notna(row[col]) <span class="kw">and</span> <span class="bu">str</span>(row[col]) <span class="op">!=</span> <span class="st">'Unknown'</span>)</span>
<span id="cb33-265"><a href="#cb33-265" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> filled <span class="op">/</span> <span class="bu">len</span>(completeness_cols)</span>
<span id="cb33-266"><a href="#cb33-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-267"><a href="#cb33-267" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'record_completeness'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(calc_completeness, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-268"><a href="#cb33-268" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'completeness_tier'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'record_completeness'</span>],</span>
<span id="cb33-269"><a href="#cb33-269" aria-hidden="true" tabindex="-1"></a>                                      bins<span class="op">=</span>[<span class="op">-</span><span class="fl">0.01</span>, <span class="fl">0.4</span>, <span class="fl">0.8</span>, <span class="fl">1.01</span>],</span>
<span id="cb33-270"><a href="#cb33-270" aria-hidden="true" tabindex="-1"></a>                                      labels<span class="op">=</span>[<span class="st">'Low'</span>, <span class="st">'Medium'</span>, <span class="st">'High'</span>])</span>
<span id="cb33-271"><a href="#cb33-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-272"><a href="#cb33-272" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-273"><a href="#cb33-273" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 6. TEMPORAL FEATURES (For Velocity Analysis)</span></span>
<span id="cb33-274"><a href="#cb33-274" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-275"><a href="#cb33-275" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'qal_cohort_date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb33-276"><a href="#cb33-276" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_year'</span>] <span class="op">=</span> df[<span class="st">'cohort_date'</span>].dt.year</span>
<span id="cb33-277"><a href="#cb33-277" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_quarter'</span>] <span class="op">=</span> df[<span class="st">'cohort_date'</span>].dt.to_period(<span class="st">'Q'</span>).astype(<span class="bu">str</span>)</span>
<span id="cb33-278"><a href="#cb33-278" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_month'</span>] <span class="op">=</span> df[<span class="st">'cohort_date'</span>].dt.to_period(<span class="st">'M'</span>).astype(<span class="bu">str</span>)</span>
<span id="cb33-279"><a href="#cb33-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-280"><a href="#cb33-280" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lead Age (for decay analysis)</span></span>
<span id="cb33-281"><a href="#cb33-281" aria-hidden="true" tabindex="-1"></a>    snapshot_date <span class="op">=</span> df[<span class="st">'cohort_date'</span>].<span class="bu">max</span>()</span>
<span id="cb33-282"><a href="#cb33-282" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lead_age_days'</span>] <span class="op">=</span> (snapshot_date <span class="op">-</span> df[<span class="st">'cohort_date'</span>]).dt.days</span>
<span id="cb33-283"><a href="#cb33-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-284"><a href="#cb33-284" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-285"><a href="#cb33-285" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 7. STRATEGIC IMPUTATION</span></span>
<span id="cb33-286"><a href="#cb33-286" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-287"><a href="#cb33-287" aria-hidden="true" tabindex="-1"></a>    cols_to_fill <span class="op">=</span> [<span class="st">'acct_manufacturing_model'</span>, <span class="st">'acct_primary_site_function'</span>,</span>
<span id="cb33-288"><a href="#cb33-288" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'acct_target_industry'</span>, <span class="st">'acct_territory_rollup'</span>]</span>
<span id="cb33-289"><a href="#cb33-289" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> cols_to_fill:</span>
<span id="cb33-290"><a href="#cb33-290" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> c <span class="kw">in</span> df.columns:</span>
<span id="cb33-291"><a href="#cb33-291" aria-hidden="true" tabindex="-1"></a>            df[c] <span class="op">=</span> df[c].fillna(<span class="st">'Unknown'</span>)</span>
<span id="cb33-292"><a href="#cb33-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-293"><a href="#cb33-293" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-294"><a href="#cb33-294" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 8. SUMMARY</span></span>
<span id="cb33-295"><a href="#cb33-295" aria-hidden="true" tabindex="-1"></a>    <span class="co"># =========================================================================</span></span>
<span id="cb33-296"><a href="#cb33-296" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-297"><a href="#cb33-297" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"DATA PIPELINE COMPLETE"</span>)</span>
<span id="cb33-298"><a href="#cb33-298" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-299"><a href="#cb33-299" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Total Rows: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb33-300"><a href="#cb33-300" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Target Rate (is_success): </span><span class="sc">{</span>df[<span class="st">'is_success'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb33-301"><a href="#cb33-301" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Mx Leads: </span><span class="sc">{</span><span class="bu">len</span>(df[df[<span class="st">'product_segment'</span>]<span class="op">==</span><span class="st">'Mx'</span>])<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb33-302"><a href="#cb33-302" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Qx Leads: </span><span class="sc">{</span><span class="bu">len</span>(df[df[<span class="st">'product_segment'</span>]<span class="op">==</span><span class="st">'Qx'</span>])<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb33-303"><a href="#cb33-303" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Near-Miss (Recycled): </span><span class="sc">{</span><span class="bu">len</span>(df[df[<span class="st">'outcome_tier'</span>]<span class="op">==</span><span class="st">'Near-Miss'</span>])<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb33-304"><a href="#cb33-304" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Decision Makers: </span><span class="sc">{</span>df[<span class="st">'is_decision_maker'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span>df[<span class="st">'is_decision_maker'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb33-305"><a href="#cb33-305" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-306"><a href="#cb33-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-307"><a href="#cb33-307" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb33-308"><a href="#cb33-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-309"><a href="#cb33-309" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute Pipeline</span></span>
<span id="cb33-310"><a href="#cb33-310" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> clean_and_engineer()</span>
<span id="cb33-311"><a href="#cb33-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-312"><a href="#cb33-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-313"><a href="#cb33-313" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb33-314"><a href="#cb33-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-315"><a href="#cb33-315" aria-hidden="true" tabindex="-1"></a><span class="fu"># Phase 3: The Gap Analysis (The Problem)</span></span>
<span id="cb33-316"><a href="#cb33-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-317"><a href="#cb33-317" aria-hidden="true" tabindex="-1"></a>**Architect's Note:**</span>
<span id="cb33-318"><a href="#cb33-318" aria-hidden="true" tabindex="-1"></a>Before fixing anything, we must quantify the pain.</span>
<span id="cb33-319"><a href="#cb33-319" aria-hidden="true" tabindex="-1"></a>We need to prove statistically that **Mx is underperforming Qx**.</span>
<span id="cb33-320"><a href="#cb33-320" aria-hidden="true" tabindex="-1"></a>This chart is your "Slide 1" in the executive deck.</span>
<span id="cb33-321"><a href="#cb33-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-322"><a href="#cb33-322" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.1 The Core Performance Gap</span></span>
<span id="cb33-323"><a href="#cb33-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-326"><a href="#cb33-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-327"><a href="#cb33-327" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gap-analysis</span></span>
<span id="cb33-328"><a href="#cb33-328" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The Yield Gap: Qx outperforms Mx. Closing this gap is the project goal."</span></span>
<span id="cb33-329"><a href="#cb33-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-330"><a href="#cb33-330" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb33-331"><a href="#cb33-331" aria-hidden="true" tabindex="-1"></a><span class="co"># BAYESIAN CONVERSION RATE (For Statistical Rigor)</span></span>
<span id="cb33-332"><a href="#cb33-332" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb33-333"><a href="#cb33-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-334"><a href="#cb33-334" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bayesian_conversion_rate(successes, n, alpha<span class="op">=</span>BAYESIAN_PRIOR_ALPHA, beta_param<span class="op">=</span>BAYESIAN_PRIOR_BETA):</span>
<span id="cb33-335"><a href="#cb33-335" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-336"><a href="#cb33-336" aria-hidden="true" tabindex="-1"></a><span class="co">    Bayesian credible interval using Beta-Binomial conjugacy.</span></span>
<span id="cb33-337"><a href="#cb33-337" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns: (posterior_mean, ci_low, ci_high)</span></span>
<span id="cb33-338"><a href="#cb33-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-339"><a href="#cb33-339" aria-hidden="true" tabindex="-1"></a><span class="co">    WHY: Frequentist CIs fail with small samples. Bayesian smoothing</span></span>
<span id="cb33-340"><a href="#cb33-340" aria-hidden="true" tabindex="-1"></a><span class="co">    prevents overconfidence in sparse segments.</span></span>
<span id="cb33-341"><a href="#cb33-341" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-342"><a href="#cb33-342" aria-hidden="true" tabindex="-1"></a>    post_alpha <span class="op">=</span> alpha <span class="op">+</span> successes</span>
<span id="cb33-343"><a href="#cb33-343" aria-hidden="true" tabindex="-1"></a>    post_beta <span class="op">=</span> beta_param <span class="op">+</span> (n <span class="op">-</span> successes)</span>
<span id="cb33-344"><a href="#cb33-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-345"><a href="#cb33-345" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> post_alpha <span class="op">/</span> (post_alpha <span class="op">+</span> post_beta)</span>
<span id="cb33-346"><a href="#cb33-346" aria-hidden="true" tabindex="-1"></a>    ci_low <span class="op">=</span> beta.ppf(<span class="fl">0.025</span>, post_alpha, post_beta)</span>
<span id="cb33-347"><a href="#cb33-347" aria-hidden="true" tabindex="-1"></a>    ci_high <span class="op">=</span> beta.ppf(<span class="fl">0.975</span>, post_alpha, post_beta)</span>
<span id="cb33-348"><a href="#cb33-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-349"><a href="#cb33-349" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean, ci_low, ci_high</span>
<span id="cb33-350"><a href="#cb33-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-351"><a href="#cb33-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-352"><a href="#cb33-352" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_performance_gap(df):</span>
<span id="cb33-353"><a href="#cb33-353" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-354"><a href="#cb33-354" aria-hidden="true" tabindex="-1"></a><span class="co">    The Executive Summary Chart.</span></span>
<span id="cb33-355"><a href="#cb33-355" aria-hidden="true" tabindex="-1"></a><span class="co">    Shows Mx vs Qx gap with proper statistical uncertainty.</span></span>
<span id="cb33-356"><a href="#cb33-356" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-357"><a href="#cb33-357" aria-hidden="true" tabindex="-1"></a>    df_main <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])]</span>
<span id="cb33-358"><a href="#cb33-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-359"><a href="#cb33-359" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb33-360"><a href="#cb33-360" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> product <span class="kw">in</span> [<span class="st">'Mx'</span>, <span class="st">'Qx'</span>]:</span>
<span id="cb33-361"><a href="#cb33-361" aria-hidden="true" tabindex="-1"></a>        subset <span class="op">=</span> df_main[df_main[<span class="st">'product_segment'</span>] <span class="op">==</span> product]</span>
<span id="cb33-362"><a href="#cb33-362" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(subset)</span>
<span id="cb33-363"><a href="#cb33-363" aria-hidden="true" tabindex="-1"></a>        successes <span class="op">=</span> subset[<span class="st">'is_success'</span>].<span class="bu">sum</span>()</span>
<span id="cb33-364"><a href="#cb33-364" aria-hidden="true" tabindex="-1"></a>        rate, ci_low, ci_high <span class="op">=</span> bayesian_conversion_rate(successes, n)</span>
<span id="cb33-365"><a href="#cb33-365" aria-hidden="true" tabindex="-1"></a>        results.append({</span>
<span id="cb33-366"><a href="#cb33-366" aria-hidden="true" tabindex="-1"></a>            <span class="st">'product'</span>: product,</span>
<span id="cb33-367"><a href="#cb33-367" aria-hidden="true" tabindex="-1"></a>            <span class="st">'n'</span>: n,</span>
<span id="cb33-368"><a href="#cb33-368" aria-hidden="true" tabindex="-1"></a>            <span class="st">'successes'</span>: successes,</span>
<span id="cb33-369"><a href="#cb33-369" aria-hidden="true" tabindex="-1"></a>            <span class="st">'rate'</span>: rate,</span>
<span id="cb33-370"><a href="#cb33-370" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ci_low'</span>: ci_low,</span>
<span id="cb33-371"><a href="#cb33-371" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ci_high'</span>: ci_high</span>
<span id="cb33-372"><a href="#cb33-372" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb33-373"><a href="#cb33-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-374"><a href="#cb33-374" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb33-375"><a href="#cb33-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-376"><a href="#cb33-376" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb33-377"><a href="#cb33-377" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb33-378"><a href="#cb33-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-379"><a href="#cb33-379" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Mx'</span>], PROJECT_COLS[<span class="st">'Qx'</span>]]</span>
<span id="cb33-380"><a href="#cb33-380" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.bar(results_df[<span class="st">'product'</span>], results_df[<span class="st">'rate'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb33-381"><a href="#cb33-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-382"><a href="#cb33-382" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Error bars (Bayesian credible intervals)</span></span>
<span id="cb33-383"><a href="#cb33-383" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> results_df.iterrows():</span>
<span id="cb33-384"><a href="#cb33-384" aria-hidden="true" tabindex="-1"></a>        ax.errorbar(i, row[<span class="st">'rate'</span>],</span>
<span id="cb33-385"><a href="#cb33-385" aria-hidden="true" tabindex="-1"></a>                   yerr<span class="op">=</span>[[row[<span class="st">'rate'</span>] <span class="op">-</span> row[<span class="st">'ci_low'</span>]], [row[<span class="st">'ci_high'</span>] <span class="op">-</span> row[<span class="st">'rate'</span>]]],</span>
<span id="cb33-386"><a href="#cb33-386" aria-hidden="true" tabindex="-1"></a>                   fmt<span class="op">=</span><span class="st">'none'</span>, color<span class="op">=</span><span class="st">'black'</span>, capsize<span class="op">=</span><span class="dv">10</span>, capthick<span class="op">=</span><span class="dv">2</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb33-387"><a href="#cb33-387" aria-hidden="true" tabindex="-1"></a>        ax.text(i, row[<span class="st">'rate'</span>] <span class="op">+</span> <span class="fl">0.025</span>, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'rate'</span>]<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb33-388"><a href="#cb33-388" aria-hidden="true" tabindex="-1"></a>               ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-389"><a href="#cb33-389" aria-hidden="true" tabindex="-1"></a>        ax.text(i, row[<span class="st">'ci_low'</span>] <span class="op">-</span> <span class="fl">0.015</span>, <span class="ss">f"n=</span><span class="sc">{</span>row[<span class="st">'n'</span>]<span class="sc">:,}</span><span class="ss">"</span>,</span>
<span id="cb33-390"><a href="#cb33-390" aria-hidden="true" tabindex="-1"></a>               ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'top'</span>, fontsize<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb33-391"><a href="#cb33-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-392"><a href="#cb33-392" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Conversion Rate (Lead → SQL+)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb33-393"><a href="#cb33-393" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'The Yield Gap: Mx vs Qx Performance</span><span class="ch">\n</span><span class="st">(with 95% Bayesian Credible Intervals)'</span>,</span>
<span id="cb33-394"><a href="#cb33-394" aria-hidden="true" tabindex="-1"></a>                fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb33-395"><a href="#cb33-395" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="dv">0</span>, <span class="fl">0.30</span>)</span>
<span id="cb33-396"><a href="#cb33-396" aria-hidden="true" tabindex="-1"></a>    ax.axhline(y<span class="op">=</span>df_main[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Overall Avg'</span>)</span>
<span id="cb33-397"><a href="#cb33-397" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb33-398"><a href="#cb33-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-399"><a href="#cb33-399" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb33-400"><a href="#cb33-400" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb33-401"><a href="#cb33-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-402"><a href="#cb33-402" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate and report gap</span></span>
<span id="cb33-403"><a href="#cb33-403" aria-hidden="true" tabindex="-1"></a>    mx_rate <span class="op">=</span> results_df[results_df[<span class="st">'product'</span>]<span class="op">==</span><span class="st">'Mx'</span>][<span class="st">'rate'</span>].values[<span class="dv">0</span>]</span>
<span id="cb33-404"><a href="#cb33-404" aria-hidden="true" tabindex="-1"></a>    qx_rate <span class="op">=</span> results_df[results_df[<span class="st">'product'</span>]<span class="op">==</span><span class="st">'Qx'</span>][<span class="st">'rate'</span>].values[<span class="dv">0</span>]</span>
<span id="cb33-405"><a href="#cb33-405" aria-hidden="true" tabindex="-1"></a>    gap <span class="op">=</span> qx_rate <span class="op">-</span> mx_rate</span>
<span id="cb33-406"><a href="#cb33-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-407"><a href="#cb33-407" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">⚠️  PERFORMANCE GAP: </span><span class="sc">{</span>gap<span class="sc">:.1%}</span><span class="ss"> points"</span>)</span>
<span id="cb33-408"><a href="#cb33-408" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Mx: </span><span class="sc">{</span>mx_rate<span class="sc">:.1%}</span><span class="ss"> | Qx: </span><span class="sc">{</span>qx_rate<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb33-409"><a href="#cb33-409" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"🎯 GOAL: Identify micro-segments where Mx can match Qx performance"</span>)</span>
<span id="cb33-410"><a href="#cb33-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-411"><a href="#cb33-411" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_df</span>
<span id="cb33-412"><a href="#cb33-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-413"><a href="#cb33-413" aria-hidden="true" tabindex="-1"></a>gap_results <span class="op">=</span> plot_performance_gap(df)</span>
<span id="cb33-414"><a href="#cb33-414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-415"><a href="#cb33-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-416"><a href="#cb33-416" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb33-417"><a href="#cb33-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-418"><a href="#cb33-418" aria-hidden="true" tabindex="-1"></a><span class="fu"># Phase 4: Advanced Signal Detection</span></span>
<span id="cb33-419"><a href="#cb33-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-420"><a href="#cb33-420" aria-hidden="true" tabindex="-1"></a>**Architect's Note:**</span>
<span id="cb33-421"><a href="#cb33-421" aria-hidden="true" tabindex="-1"></a>This is where we separate from other teams. Standard EDA stops at univariate analysis.</span>
<span id="cb33-422"><a href="#cb33-422" aria-hidden="true" tabindex="-1"></a>We go deeper with:</span>
<span id="cb33-423"><a href="#cb33-423" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Pipeline Velocity:** Are Mx leads slower to convert?</span>
<span id="cb33-424"><a href="#cb33-424" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Power Modifiers:** Does "Global" in a title matter?</span>
<span id="cb33-425"><a href="#cb33-425" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**The Power Trio:** Seniority × Industry × Model interaction</span>
<span id="cb33-426"><a href="#cb33-426" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Zombie Analysis:** Where are we wasting "Recycled" leads?</span>
<span id="cb33-427"><a href="#cb33-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-428"><a href="#cb33-428" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.1 Pipeline Velocity Analysis (NEW)</span></span>
<span id="cb33-429"><a href="#cb33-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-430"><a href="#cb33-430" aria-hidden="true" tabindex="-1"></a>**The Critical Question:** Are Mx leads failing because they're bad leads, or because they're stalling in the pipeline?</span>
<span id="cb33-431"><a href="#cb33-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-434"><a href="#cb33-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-435"><a href="#cb33-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: velocity-analysis</span></span>
<span id="cb33-436"><a href="#cb33-436" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Pipeline Velocity: Mx leads convert slower - a Sales enablement problem, not a targeting problem."</span></span>
<span id="cb33-437"><a href="#cb33-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-438"><a href="#cb33-438" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_pipeline_velocity(df):</span>
<span id="cb33-439"><a href="#cb33-439" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-440"><a href="#cb33-440" aria-hidden="true" tabindex="-1"></a><span class="co">    KILLER INSIGHT: If Mx leads take longer to close, the problem is</span></span>
<span id="cb33-441"><a href="#cb33-441" aria-hidden="true" tabindex="-1"></a><span class="co">    Sales enablement (training, content), not Marketing targeting.</span></span>
<span id="cb33-442"><a href="#cb33-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-443"><a href="#cb33-443" aria-hidden="true" tabindex="-1"></a><span class="co">    This changes the recommendation from "find better leads" to</span></span>
<span id="cb33-444"><a href="#cb33-444" aria-hidden="true" tabindex="-1"></a><span class="co">    "speed up existing leads."</span></span>
<span id="cb33-445"><a href="#cb33-445" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-446"><a href="#cb33-446" aria-hidden="true" tabindex="-1"></a>    df_velocity <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])].copy()</span>
<span id="cb33-447"><a href="#cb33-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-448"><a href="#cb33-448" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Focus on successful leads - how old were they when they converted?</span></span>
<span id="cb33-449"><a href="#cb33-449" aria-hidden="true" tabindex="-1"></a>    df_success <span class="op">=</span> df_velocity[df_velocity[<span class="st">'is_success'</span>] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb33-450"><a href="#cb33-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-451"><a href="#cb33-451" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_success) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb33-452"><a href="#cb33-452" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"⚠️ No successful leads found for velocity analysis"</span>)</span>
<span id="cb33-453"><a href="#cb33-453" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb33-454"><a href="#cb33-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-455"><a href="#cb33-455" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate velocity stats by product</span></span>
<span id="cb33-456"><a href="#cb33-456" aria-hidden="true" tabindex="-1"></a>    velocity_stats <span class="op">=</span> df_success.groupby(<span class="st">'product_segment'</span>).agg(</span>
<span id="cb33-457"><a href="#cb33-457" aria-hidden="true" tabindex="-1"></a>        median_age<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="st">'median'</span>),</span>
<span id="cb33-458"><a href="#cb33-458" aria-hidden="true" tabindex="-1"></a>        mean_age<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="st">'mean'</span>),</span>
<span id="cb33-459"><a href="#cb33-459" aria-hidden="true" tabindex="-1"></a>        p25_age<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.25</span>)),</span>
<span id="cb33-460"><a href="#cb33-460" aria-hidden="true" tabindex="-1"></a>        p75_age<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.75</span>)),</span>
<span id="cb33-461"><a href="#cb33-461" aria-hidden="true" tabindex="-1"></a>        n_wins<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'sum'</span>)</span>
<span id="cb33-462"><a href="#cb33-462" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb33-463"><a href="#cb33-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-464"><a href="#cb33-464" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-465"><a href="#cb33-465" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"PIPELINE VELOCITY ANALYSIS"</span>)</span>
<span id="cb33-466"><a href="#cb33-466" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-467"><a href="#cb33-467" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(velocity_stats.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb33-468"><a href="#cb33-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-469"><a href="#cb33-469" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Statistical test: Mann-Whitney U (non-parametric)</span></span>
<span id="cb33-470"><a href="#cb33-470" aria-hidden="true" tabindex="-1"></a>    mx_ages <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>][<span class="st">'lead_age_days'</span>].dropna()</span>
<span id="cb33-471"><a href="#cb33-471" aria-hidden="true" tabindex="-1"></a>    qx_ages <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Qx'</span>][<span class="st">'lead_age_days'</span>].dropna()</span>
<span id="cb33-472"><a href="#cb33-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-473"><a href="#cb33-473" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mx_ages) <span class="op">&gt;</span> <span class="dv">5</span> <span class="kw">and</span> <span class="bu">len</span>(qx_ages) <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb33-474"><a href="#cb33-474" aria-hidden="true" tabindex="-1"></a>        stat, p_val <span class="op">=</span> mannwhitneyu(mx_ages, qx_ages, alternative<span class="op">=</span><span class="st">'two-sided'</span>)</span>
<span id="cb33-475"><a href="#cb33-475" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Mann-Whitney U Test: p-value = </span><span class="sc">{</span>p_val<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb33-476"><a href="#cb33-476" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Interpretation: </span><span class="sc">{</span><span class="st">'Significant difference'</span> <span class="cf">if</span> p_val <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="cf">else</span> <span class="st">'No significant difference'</span><span class="sc">}</span><span class="ss"> in velocity"</span>)</span>
<span id="cb33-477"><a href="#cb33-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-478"><a href="#cb33-478" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb33-479"><a href="#cb33-479" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb33-480"><a href="#cb33-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-481"><a href="#cb33-481" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Left: Distribution comparison</span></span>
<span id="cb33-482"><a href="#cb33-482" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb33-483"><a href="#cb33-483" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> product, color <span class="kw">in</span> [(<span class="st">'Mx'</span>, PROJECT_COLS[<span class="st">'Mx'</span>]), (<span class="st">'Qx'</span>, PROJECT_COLS[<span class="st">'Qx'</span>])]:</span>
<span id="cb33-484"><a href="#cb33-484" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>] <span class="op">==</span> product][<span class="st">'lead_age_days'</span>].dropna()</span>
<span id="cb33-485"><a href="#cb33-485" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(data) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb33-486"><a href="#cb33-486" aria-hidden="true" tabindex="-1"></a>            ax1.hist(data, bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> (n=</span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss">)'</span>, color<span class="op">=</span>color, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-487"><a href="#cb33-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-488"><a href="#cb33-488" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Lead Age at Conversion (Days)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-489"><a href="#cb33-489" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Density'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-490"><a href="#cb33-490" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'Distribution of Time-to-Convert'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-491"><a href="#cb33-491" aria-hidden="true" tabindex="-1"></a>    ax1.legend()</span>
<span id="cb33-492"><a href="#cb33-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-493"><a href="#cb33-493" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Right: Box plot comparison</span></span>
<span id="cb33-494"><a href="#cb33-494" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb33-495"><a href="#cb33-495" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])]</span>
<span id="cb33-496"><a href="#cb33-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-497"><a href="#cb33-497" aria-hidden="true" tabindex="-1"></a>    box_colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Mx'</span>], PROJECT_COLS[<span class="st">'Qx'</span>]]</span>
<span id="cb33-498"><a href="#cb33-498" aria-hidden="true" tabindex="-1"></a>    bp <span class="op">=</span> df_plot.boxplot(column<span class="op">=</span><span class="st">'lead_age_days'</span>, by<span class="op">=</span><span class="st">'product_segment'</span>, ax<span class="op">=</span>ax2,</span>
<span id="cb33-499"><a href="#cb33-499" aria-hidden="true" tabindex="-1"></a>                         patch_artist<span class="op">=</span><span class="va">True</span>, return_type<span class="op">=</span><span class="st">'dict'</span>)</span>
<span id="cb33-500"><a href="#cb33-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-501"><a href="#cb33-501" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> patch, color <span class="kw">in</span> <span class="bu">zip</span>(bp[<span class="st">'lead_age_days'</span>][<span class="st">'boxes'</span>], box_colors):</span>
<span id="cb33-502"><a href="#cb33-502" aria-hidden="true" tabindex="-1"></a>        patch.set_facecolor(color)</span>
<span id="cb33-503"><a href="#cb33-503" aria-hidden="true" tabindex="-1"></a>        patch.set_alpha(<span class="fl">0.7</span>)</span>
<span id="cb33-504"><a href="#cb33-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-505"><a href="#cb33-505" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'Product'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-506"><a href="#cb33-506" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Lead Age at Conversion (Days)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-507"><a href="#cb33-507" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'Time-to-Convert by Product'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-508"><a href="#cb33-508" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="st">''</span>)  <span class="co"># Remove automatic title</span></span>
<span id="cb33-509"><a href="#cb33-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-510"><a href="#cb33-510" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb33-511"><a href="#cb33-511" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb33-512"><a href="#cb33-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-513"><a href="#cb33-513" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Key insight</span></span>
<span id="cb33-514"><a href="#cb33-514" aria-hidden="true" tabindex="-1"></a>    mx_median <span class="op">=</span> velocity_stats[velocity_stats[<span class="st">'product_segment'</span>]<span class="op">==</span><span class="st">'Mx'</span>][<span class="st">'median_age'</span>].values</span>
<span id="cb33-515"><a href="#cb33-515" aria-hidden="true" tabindex="-1"></a>    qx_median <span class="op">=</span> velocity_stats[velocity_stats[<span class="st">'product_segment'</span>]<span class="op">==</span><span class="st">'Qx'</span>][<span class="st">'median_age'</span>].values</span>
<span id="cb33-516"><a href="#cb33-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-517"><a href="#cb33-517" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mx_median) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="bu">len</span>(qx_median) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb33-518"><a href="#cb33-518" aria-hidden="true" tabindex="-1"></a>        diff <span class="op">=</span> mx_median[<span class="dv">0</span>] <span class="op">-</span> qx_median[<span class="dv">0</span>]</span>
<span id="cb33-519"><a href="#cb33-519" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🚨 KEY FINDING: Mx deals take </span><span class="sc">{</span><span class="bu">abs</span>(diff)<span class="sc">:.0f}</span><span class="ss"> days </span><span class="sc">{</span><span class="st">'longer'</span> <span class="cf">if</span> diff <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'shorter'</span><span class="sc">}</span><span class="ss"> (median)"</span>)</span>
<span id="cb33-520"><a href="#cb33-520" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> diff <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb33-521"><a href="#cb33-521" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"   → RECOMMENDATION: Mx needs faster follow-up SLAs and better Sales enablement"</span>)</span>
<span id="cb33-522"><a href="#cb33-522" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb33-523"><a href="#cb33-523" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"   → INSIGHT: Mx attracts faster-moving buyers"</span>)</span>
<span id="cb33-524"><a href="#cb33-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-525"><a href="#cb33-525" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> velocity_stats</span>
<span id="cb33-526"><a href="#cb33-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-527"><a href="#cb33-527" aria-hidden="true" tabindex="-1"></a>velocity_stats <span class="op">=</span> analyze_pipeline_velocity(df)</span>
<span id="cb33-528"><a href="#cb33-528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-529"><a href="#cb33-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-530"><a href="#cb33-530" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.2 The "Zombie" Lead Analysis (Near-Miss Opportunity)</span></span>
<span id="cb33-531"><a href="#cb33-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-532"><a href="#cb33-532" aria-hidden="true" tabindex="-1"></a>**Architect's Note:**</span>
<span id="cb33-533"><a href="#cb33-533" aria-hidden="true" tabindex="-1"></a>"Recycled" leads are NOT failures - they're timing mismatches.</span>
<span id="cb33-534"><a href="#cb33-534" aria-hidden="true" tabindex="-1"></a>If Mx has more recycled leads in specific segments, the product-market fit exists but the timing doesn't.</span>
<span id="cb33-535"><a href="#cb33-535" aria-hidden="true" tabindex="-1"></a>This is a nurture campaign opportunity worth millions.</span>
<span id="cb33-536"><a href="#cb33-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-539"><a href="#cb33-539" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-540"><a href="#cb33-540" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: zombie-analysis</span></span>
<span id="cb33-541"><a href="#cb33-541" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Zombie Leads: Where are we recycling high-potential Mx prospects?"</span></span>
<span id="cb33-542"><a href="#cb33-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-543"><a href="#cb33-543" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_zombie_leads(df):</span>
<span id="cb33-544"><a href="#cb33-544" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-545"><a href="#cb33-545" aria-hidden="true" tabindex="-1"></a><span class="co">    HYPOTHESIS: "Recycled" leads are future gold.</span></span>
<span id="cb33-546"><a href="#cb33-546" aria-hidden="true" tabindex="-1"></a><span class="co">    If certain segments show high recycling, we need:</span></span>
<span id="cb33-547"><a href="#cb33-547" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Better nurture campaigns</span></span>
<span id="cb33-548"><a href="#cb33-548" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Re-engagement triggers</span></span>
<span id="cb33-549"><a href="#cb33-549" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Timing optimization</span></span>
<span id="cb33-550"><a href="#cb33-550" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-551"><a href="#cb33-551" aria-hidden="true" tabindex="-1"></a>    df_products <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])].copy()</span>
<span id="cb33-552"><a href="#cb33-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-553"><a href="#cb33-553" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Outcome distribution by product</span></span>
<span id="cb33-554"><a href="#cb33-554" aria-hidden="true" tabindex="-1"></a>    outcome_dist <span class="op">=</span> df_products.groupby([<span class="st">'product_segment'</span>, <span class="st">'outcome_tier'</span>]).size().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb33-555"><a href="#cb33-555" aria-hidden="true" tabindex="-1"></a>    outcome_pct <span class="op">=</span> outcome_dist.div(outcome_dist.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb33-556"><a href="#cb33-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-557"><a href="#cb33-557" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-558"><a href="#cb33-558" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"OUTCOME DISTRIBUTION BY PRODUCT"</span>)</span>
<span id="cb33-559"><a href="#cb33-559" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-560"><a href="#cb33-560" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(outcome_pct.<span class="bu">round</span>(<span class="dv">1</span>).to_string())</span>
<span id="cb33-561"><a href="#cb33-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-562"><a href="#cb33-562" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb33-563"><a href="#cb33-563" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb33-564"><a href="#cb33-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-565"><a href="#cb33-565" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Left: Stacked bar chart</span></span>
<span id="cb33-566"><a href="#cb33-566" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb33-567"><a href="#cb33-567" aria-hidden="true" tabindex="-1"></a>    outcome_pct.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax1,</span>
<span id="cb33-568"><a href="#cb33-568" aria-hidden="true" tabindex="-1"></a>                     color<span class="op">=</span>[PROJECT_COLS[<span class="st">'Failure'</span>], PROJECT_COLS[<span class="st">'Neutral'</span>], PROJECT_COLS[<span class="st">'Success'</span>]])</span>
<span id="cb33-569"><a href="#cb33-569" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Percentage of Leads'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-570"><a href="#cb33-570" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">''</span>)</span>
<span id="cb33-571"><a href="#cb33-571" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'Outcome Distribution by Product'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-572"><a href="#cb33-572" aria-hidden="true" tabindex="-1"></a>    ax1.legend(title<span class="op">=</span><span class="st">'Outcome'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb33-573"><a href="#cb33-573" aria-hidden="true" tabindex="-1"></a>    ax1.set_xticklabels(ax1.get_xticklabels(), rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb33-574"><a href="#cb33-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-575"><a href="#cb33-575" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Right: Zombie leads by industry (for Mx only)</span></span>
<span id="cb33-576"><a href="#cb33-576" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb33-577"><a href="#cb33-577" aria-hidden="true" tabindex="-1"></a>    mx_zombies <span class="op">=</span> df_products[(df_products[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>) <span class="op">&amp;</span></span>
<span id="cb33-578"><a href="#cb33-578" aria-hidden="true" tabindex="-1"></a>                              (df_products[<span class="st">'outcome_tier'</span>] <span class="op">==</span> <span class="st">'Near-Miss'</span>)]</span>
<span id="cb33-579"><a href="#cb33-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-580"><a href="#cb33-580" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mx_zombies) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb33-581"><a href="#cb33-581" aria-hidden="true" tabindex="-1"></a>        zombie_by_industry <span class="op">=</span> mx_zombies[<span class="st">'acct_target_industry'</span>].value_counts().head(<span class="dv">8</span>)</span>
<span id="cb33-582"><a href="#cb33-582" aria-hidden="true" tabindex="-1"></a>        zombie_by_industry.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax2, color<span class="op">=</span>PROJECT_COLS[<span class="st">'Neutral'</span>])</span>
<span id="cb33-583"><a href="#cb33-583" aria-hidden="true" tabindex="-1"></a>        ax2.set_xlabel(<span class="st">'Count of Recycled Leads'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-584"><a href="#cb33-584" aria-hidden="true" tabindex="-1"></a>        ax2.set_title(<span class="st">'Mx "Zombie" Leads by Industry</span><span class="ch">\n</span><span class="st">(Nurture Campaign Targets)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-585"><a href="#cb33-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-586"><a href="#cb33-586" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb33-587"><a href="#cb33-587" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb33-588"><a href="#cb33-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-589"><a href="#cb33-589" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zombie lead profile</span></span>
<span id="cb33-590"><a href="#cb33-590" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🧟 ZOMBIE LEAD PROFILE (Mx Recycled):"</span>)</span>
<span id="cb33-591"><a href="#cb33-591" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Total Mx Zombies: </span><span class="sc">{</span><span class="bu">len</span>(mx_zombies)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb33-592"><a href="#cb33-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-593"><a href="#cb33-593" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mx_zombies) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb33-594"><a href="#cb33-594" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   Top Industries:"</span>)</span>
<span id="cb33-595"><a href="#cb33-595" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(mx_zombies[<span class="st">'acct_target_industry'</span>].value_counts().head(<span class="dv">5</span>).to_string())</span>
<span id="cb33-596"><a href="#cb33-596" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   Top Seniority Levels:"</span>)</span>
<span id="cb33-597"><a href="#cb33-597" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(mx_zombies[<span class="st">'title_seniority'</span>].value_counts().head(<span class="dv">5</span>).to_string())</span>
<span id="cb33-598"><a href="#cb33-598" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   Decision Maker Rate: </span><span class="sc">{</span>mx_zombies[<span class="st">'is_decision_maker'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb33-599"><a href="#cb33-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-600"><a href="#cb33-600" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> outcome_pct</span>
<span id="cb33-601"><a href="#cb33-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-602"><a href="#cb33-602" aria-hidden="true" tabindex="-1"></a>zombie_analysis <span class="op">=</span> analyze_zombie_leads(df)</span>
<span id="cb33-603"><a href="#cb33-603" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-604"><a href="#cb33-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-605"><a href="#cb33-605" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.3 Power Modifier Analysis (NEW)</span></span>
<span id="cb33-606"><a href="#cb33-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-607"><a href="#cb33-607" aria-hidden="true" tabindex="-1"></a>**Architect's Note:**</span>
<span id="cb33-608"><a href="#cb33-608" aria-hidden="true" tabindex="-1"></a>Does "Global Quality Director" convert higher than "Site Quality Director"?</span>
<span id="cb33-609"><a href="#cb33-609" aria-hidden="true" tabindex="-1"></a>This is the kind of nuanced insight that wins competitions.</span>
<span id="cb33-610"><a href="#cb33-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-613"><a href="#cb33-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-614"><a href="#cb33-614" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: power-modifier</span></span>
<span id="cb33-615"><a href="#cb33-615" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Power Modifiers: 'Global' titles show significant conversion lift."</span></span>
<span id="cb33-616"><a href="#cb33-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-617"><a href="#cb33-617" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_power_modifiers(df):</span>
<span id="cb33-618"><a href="#cb33-618" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-619"><a href="#cb33-619" aria-hidden="true" tabindex="-1"></a><span class="co">    Test if scope modifiers (Global, Regional, Site) affect conversion.</span></span>
<span id="cb33-620"><a href="#cb33-620" aria-hidden="true" tabindex="-1"></a><span class="co">    HYPOTHESIS: Global/Corporate roles have more budget authority.</span></span>
<span id="cb33-621"><a href="#cb33-621" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-622"><a href="#cb33-622" aria-hidden="true" tabindex="-1"></a>    df_mx <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>].copy()</span>
<span id="cb33-623"><a href="#cb33-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-624"><a href="#cb33-624" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate conversion by scope</span></span>
<span id="cb33-625"><a href="#cb33-625" aria-hidden="true" tabindex="-1"></a>    scope_stats <span class="op">=</span> df_mx.groupby(<span class="st">'title_scope'</span>).agg(</span>
<span id="cb33-626"><a href="#cb33-626" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'size'</span>),</span>
<span id="cb33-627"><a href="#cb33-627" aria-hidden="true" tabindex="-1"></a>        successes<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'sum'</span>)</span>
<span id="cb33-628"><a href="#cb33-628" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb33-629"><a href="#cb33-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-630"><a href="#cb33-630" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add Bayesian estimates</span></span>
<span id="cb33-631"><a href="#cb33-631" aria-hidden="true" tabindex="-1"></a>    scope_stats[<span class="st">'rate'</span>] <span class="op">=</span> scope_stats.<span class="bu">apply</span>(</span>
<span id="cb33-632"><a href="#cb33-632" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">0</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-633"><a href="#cb33-633" aria-hidden="true" tabindex="-1"></a>    scope_stats[<span class="st">'ci_low'</span>] <span class="op">=</span> scope_stats.<span class="bu">apply</span>(</span>
<span id="cb33-634"><a href="#cb33-634" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">1</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-635"><a href="#cb33-635" aria-hidden="true" tabindex="-1"></a>    scope_stats[<span class="st">'ci_high'</span>] <span class="op">=</span> scope_stats.<span class="bu">apply</span>(</span>
<span id="cb33-636"><a href="#cb33-636" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">2</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-637"><a href="#cb33-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-638"><a href="#cb33-638" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by conversion rate</span></span>
<span id="cb33-639"><a href="#cb33-639" aria-hidden="true" tabindex="-1"></a>    scope_stats <span class="op">=</span> scope_stats.sort_values(<span class="st">'rate'</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-640"><a href="#cb33-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-641"><a href="#cb33-641" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-642"><a href="#cb33-642" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"POWER MODIFIER ANALYSIS (Mx Only)"</span>)</span>
<span id="cb33-643"><a href="#cb33-643" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-644"><a href="#cb33-644" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(scope_stats.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb33-645"><a href="#cb33-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-646"><a href="#cb33-646" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb33-647"><a href="#cb33-647" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb33-648"><a href="#cb33-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-649"><a href="#cb33-649" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(scope_stats))</span>
<span id="cb33-650"><a href="#cb33-650" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> r <span class="op">&gt;</span> df_mx[<span class="st">'is_success'</span>].mean() <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>]</span>
<span id="cb33-651"><a href="#cb33-651" aria-hidden="true" tabindex="-1"></a>              <span class="cf">for</span> r <span class="kw">in</span> scope_stats[<span class="st">'rate'</span>]]</span>
<span id="cb33-652"><a href="#cb33-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-653"><a href="#cb33-653" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(y_pos, scope_stats[<span class="st">'rate'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb33-654"><a href="#cb33-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-655"><a href="#cb33-655" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Error bars</span></span>
<span id="cb33-656"><a href="#cb33-656" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> scope_stats.iterrows():</span>
<span id="cb33-657"><a href="#cb33-657" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="bu">list</span>(scope_stats.index).index(i)</span>
<span id="cb33-658"><a href="#cb33-658" aria-hidden="true" tabindex="-1"></a>        ax.plot([row[<span class="st">'ci_low'</span>], row[<span class="st">'ci_high'</span>]], [idx, idx], color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb33-659"><a href="#cb33-659" aria-hidden="true" tabindex="-1"></a>        ax.text(row[<span class="st">'rate'</span>] <span class="op">+</span> <span class="fl">0.01</span>, idx, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'rate'</span>]<span class="sc">:.1%}</span><span class="ss"> (n=</span><span class="sc">{</span>row[<span class="st">'n'</span>]<span class="sc">}</span><span class="ss">)"</span>,</span>
<span id="cb33-660"><a href="#cb33-660" aria-hidden="true" tabindex="-1"></a>               va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb33-661"><a href="#cb33-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-662"><a href="#cb33-662" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(y_pos)</span>
<span id="cb33-663"><a href="#cb33-663" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(scope_stats[<span class="st">'title_scope'</span>])</span>
<span id="cb33-664"><a href="#cb33-664" aria-hidden="true" tabindex="-1"></a>    ax.axvline(x<span class="op">=</span>df_mx[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Mx Average'</span>)</span>
<span id="cb33-665"><a href="#cb33-665" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Conversion Rate'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-666"><a href="#cb33-666" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Impact of Title Scope Modifiers on Mx Conversion</span><span class="ch">\n</span><span class="st">("Global VP" vs "Site Manager")'</span>,</span>
<span id="cb33-667"><a href="#cb33-667" aria-hidden="true" tabindex="-1"></a>                fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-668"><a href="#cb33-668" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'lower right'</span>)</span>
<span id="cb33-669"><a href="#cb33-669" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">0</span>, <span class="fl">0.35</span>)</span>
<span id="cb33-670"><a href="#cb33-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-671"><a href="#cb33-671" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb33-672"><a href="#cb33-672" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb33-673"><a href="#cb33-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-674"><a href="#cb33-674" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate lift</span></span>
<span id="cb33-675"><a href="#cb33-675" aria-hidden="true" tabindex="-1"></a>    global_rate <span class="op">=</span> scope_stats[scope_stats[<span class="st">'title_scope'</span>] <span class="op">==</span> <span class="st">'Global'</span>][<span class="st">'rate'</span>].values</span>
<span id="cb33-676"><a href="#cb33-676" aria-hidden="true" tabindex="-1"></a>    standard_rate <span class="op">=</span> scope_stats[scope_stats[<span class="st">'title_scope'</span>] <span class="op">==</span> <span class="st">'Standard'</span>][<span class="st">'rate'</span>].values</span>
<span id="cb33-677"><a href="#cb33-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-678"><a href="#cb33-678" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(global_rate) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="bu">len</span>(standard_rate) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb33-679"><a href="#cb33-679" aria-hidden="true" tabindex="-1"></a>        lift <span class="op">=</span> global_rate[<span class="dv">0</span>] <span class="op">/</span> standard_rate[<span class="dv">0</span>] <span class="cf">if</span> standard_rate[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb33-680"><a href="#cb33-680" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🎯 KEY FINDING: 'Global' titles show </span><span class="sc">{</span>lift<span class="sc">:.1f}</span><span class="ss">x conversion lift vs Standard"</span>)</span>
<span id="cb33-681"><a href="#cb33-681" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"   → RECOMMENDATION: Prioritize Global/Corporate titles in Mx targeting"</span>)</span>
<span id="cb33-682"><a href="#cb33-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-683"><a href="#cb33-683" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> scope_stats</span>
<span id="cb33-684"><a href="#cb33-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-685"><a href="#cb33-685" aria-hidden="true" tabindex="-1"></a>power_modifier_stats <span class="op">=</span> analyze_power_modifiers(df)</span>
<span id="cb33-686"><a href="#cb33-686" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-687"><a href="#cb33-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-688"><a href="#cb33-688" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.4 The "Power Trio" Interaction (Seniority × Industry × Model)</span></span>
<span id="cb33-689"><a href="#cb33-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-690"><a href="#cb33-690" aria-hidden="true" tabindex="-1"></a>**Architect's Note:**</span>
<span id="cb33-691"><a href="#cb33-691" aria-hidden="true" tabindex="-1"></a>This is the most valuable analysis in the deck.</span>
<span id="cb33-692"><a href="#cb33-692" aria-hidden="true" tabindex="-1"></a>We're looking for the EXACT micro-segment: "VP + Pharma + In-House"</span>
<span id="cb33-693"><a href="#cb33-693" aria-hidden="true" tabindex="-1"></a>vs "Manager + MedDev + CDMO". This is surgical targeting.</span>
<span id="cb33-694"><a href="#cb33-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-697"><a href="#cb33-697" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-698"><a href="#cb33-698" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: power-trio</span></span>
<span id="cb33-699"><a href="#cb33-699" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The Power Trio: Finding the golden intersection of Seniority × Industry × Model"</span></span>
<span id="cb33-700"><a href="#cb33-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-701"><a href="#cb33-701" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_power_trio(df, product<span class="op">=</span><span class="st">'Mx'</span>, min_n<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb33-702"><a href="#cb33-702" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-703"><a href="#cb33-703" aria-hidden="true" tabindex="-1"></a><span class="co">    Find the optimal combination of Seniority × Industry × Model.</span></span>
<span id="cb33-704"><a href="#cb33-704" aria-hidden="true" tabindex="-1"></a><span class="co">    This is the "ICP Definition" that wins competitions.</span></span>
<span id="cb33-705"><a href="#cb33-705" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-706"><a href="#cb33-706" aria-hidden="true" tabindex="-1"></a>    df_product <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb33-707"><a href="#cb33-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-708"><a href="#cb33-708" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aggregate by the trio</span></span>
<span id="cb33-709"><a href="#cb33-709" aria-hidden="true" tabindex="-1"></a>    trio_stats <span class="op">=</span> df_product.groupby(</span>
<span id="cb33-710"><a href="#cb33-710" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'title_seniority'</span>, <span class="st">'acct_target_industry'</span>, <span class="st">'acct_manufacturing_model'</span>]</span>
<span id="cb33-711"><a href="#cb33-711" aria-hidden="true" tabindex="-1"></a>    ).agg(</span>
<span id="cb33-712"><a href="#cb33-712" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'size'</span>),</span>
<span id="cb33-713"><a href="#cb33-713" aria-hidden="true" tabindex="-1"></a>        successes<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'sum'</span>)</span>
<span id="cb33-714"><a href="#cb33-714" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb33-715"><a href="#cb33-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-716"><a href="#cb33-716" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for statistical significance</span></span>
<span id="cb33-717"><a href="#cb33-717" aria-hidden="true" tabindex="-1"></a>    trio_stats <span class="op">=</span> trio_stats[trio_stats[<span class="st">'n'</span>] <span class="op">&gt;=</span> min_n].copy()</span>
<span id="cb33-718"><a href="#cb33-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-719"><a href="#cb33-719" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(trio_stats) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb33-720"><a href="#cb33-720" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"⚠️ No segments with n &gt;= </span><span class="sc">{</span>min_n<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-721"><a href="#cb33-721" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb33-722"><a href="#cb33-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-723"><a href="#cb33-723" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add Bayesian rates</span></span>
<span id="cb33-724"><a href="#cb33-724" aria-hidden="true" tabindex="-1"></a>    trio_stats[<span class="st">'rate'</span>] <span class="op">=</span> trio_stats.<span class="bu">apply</span>(</span>
<span id="cb33-725"><a href="#cb33-725" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">0</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-726"><a href="#cb33-726" aria-hidden="true" tabindex="-1"></a>    trio_stats[<span class="st">'ci_low'</span>] <span class="op">=</span> trio_stats.<span class="bu">apply</span>(</span>
<span id="cb33-727"><a href="#cb33-727" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">1</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-728"><a href="#cb33-728" aria-hidden="true" tabindex="-1"></a>    trio_stats[<span class="st">'ci_high'</span>] <span class="op">=</span> trio_stats.<span class="bu">apply</span>(</span>
<span id="cb33-729"><a href="#cb33-729" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">2</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-730"><a href="#cb33-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-731"><a href="#cb33-731" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create segment label</span></span>
<span id="cb33-732"><a href="#cb33-732" aria-hidden="true" tabindex="-1"></a>    trio_stats[<span class="st">'segment'</span>] <span class="op">=</span> (trio_stats[<span class="st">'title_seniority'</span>] <span class="op">+</span> <span class="st">' | '</span> <span class="op">+</span></span>
<span id="cb33-733"><a href="#cb33-733" aria-hidden="true" tabindex="-1"></a>                             trio_stats[<span class="st">'acct_target_industry'</span>] <span class="op">+</span> <span class="st">' | '</span> <span class="op">+</span></span>
<span id="cb33-734"><a href="#cb33-734" aria-hidden="true" tabindex="-1"></a>                             trio_stats[<span class="st">'acct_manufacturing_model'</span>])</span>
<span id="cb33-735"><a href="#cb33-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-736"><a href="#cb33-736" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort and get top/bottom</span></span>
<span id="cb33-737"><a href="#cb33-737" aria-hidden="true" tabindex="-1"></a>    trio_stats <span class="op">=</span> trio_stats.sort_values(<span class="st">'rate'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-738"><a href="#cb33-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-739"><a href="#cb33-739" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-740"><a href="#cb33-740" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"POWER TRIO ANALYSIS (</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">): Top Converting Segments"</span>)</span>
<span id="cb33-741"><a href="#cb33-741" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-742"><a href="#cb33-742" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(trio_stats[[<span class="st">'segment'</span>, <span class="st">'n'</span>, <span class="st">'rate'</span>, <span class="st">'ci_low'</span>, <span class="st">'ci_high'</span>]].head(<span class="dv">10</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb33-743"><a href="#cb33-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-744"><a href="#cb33-744" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Bottom Converting Segments:"</span>)</span>
<span id="cb33-745"><a href="#cb33-745" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(trio_stats[[<span class="st">'segment'</span>, <span class="st">'n'</span>, <span class="st">'rate'</span>, <span class="st">'ci_low'</span>, <span class="st">'ci_high'</span>]].tail(<span class="dv">5</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb33-746"><a href="#cb33-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-747"><a href="#cb33-747" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization: Top 15 vs Bottom 5</span></span>
<span id="cb33-748"><a href="#cb33-748" aria-hidden="true" tabindex="-1"></a>    top_segments <span class="op">=</span> pd.concat([trio_stats.head(<span class="dv">10</span>), trio_stats.tail(<span class="dv">5</span>)])</span>
<span id="cb33-749"><a href="#cb33-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-750"><a href="#cb33-750" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))</span>
<span id="cb33-751"><a href="#cb33-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-752"><a href="#cb33-752" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(top_segments))</span>
<span id="cb33-753"><a href="#cb33-753" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> r <span class="op">&gt;</span> df_product[<span class="st">'is_success'</span>].mean()</span>
<span id="cb33-754"><a href="#cb33-754" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>] <span class="cf">for</span> r <span class="kw">in</span> top_segments[<span class="st">'rate'</span>]]</span>
<span id="cb33-755"><a href="#cb33-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-756"><a href="#cb33-756" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(y_pos, top_segments[<span class="st">'rate'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb33-757"><a href="#cb33-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-758"><a href="#cb33-758" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Error bars and labels</span></span>
<span id="cb33-759"><a href="#cb33-759" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (idx, row) <span class="kw">in</span> <span class="bu">enumerate</span>(top_segments.iterrows()):</span>
<span id="cb33-760"><a href="#cb33-760" aria-hidden="true" tabindex="-1"></a>        ax.plot([row[<span class="st">'ci_low'</span>], row[<span class="st">'ci_high'</span>]], [i, i], color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb33-761"><a href="#cb33-761" aria-hidden="true" tabindex="-1"></a>        ax.text(row[<span class="st">'rate'</span>] <span class="op">+</span> <span class="fl">0.01</span>, i, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'rate'</span>]<span class="sc">:.0%}</span><span class="ss"> (n=</span><span class="sc">{</span>row[<span class="st">'n'</span>]<span class="sc">}</span><span class="ss">)"</span>, va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb33-762"><a href="#cb33-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-763"><a href="#cb33-763" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(y_pos)</span>
<span id="cb33-764"><a href="#cb33-764" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(top_segments[<span class="st">'segment'</span>], fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb33-765"><a href="#cb33-765" aria-hidden="true" tabindex="-1"></a>    ax.axvline(x<span class="op">=</span>df_product[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>,</span>
<span id="cb33-766"><a href="#cb33-766" aria-hidden="true" tabindex="-1"></a>               alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Average: </span><span class="sc">{</span>df_product[<span class="st">"is_success"</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">'</span>)</span>
<span id="cb33-767"><a href="#cb33-767" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Conversion Rate'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-768"><a href="#cb33-768" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'The Power Trio: </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Conversion by Seniority × Industry × Model</span><span class="ch">\n</span><span class="ss">(Green = Above Avg, Orange = Below Avg)'</span>,</span>
<span id="cb33-769"><a href="#cb33-769" aria-hidden="true" tabindex="-1"></a>                fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-770"><a href="#cb33-770" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'lower right'</span>)</span>
<span id="cb33-771"><a href="#cb33-771" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">0</span>, <span class="fl">0.50</span>)</span>
<span id="cb33-772"><a href="#cb33-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-773"><a href="#cb33-773" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb33-774"><a href="#cb33-774" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb33-775"><a href="#cb33-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-776"><a href="#cb33-776" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The Golden Segment</span></span>
<span id="cb33-777"><a href="#cb33-777" aria-hidden="true" tabindex="-1"></a>    best <span class="op">=</span> trio_stats.iloc[<span class="dv">0</span>]</span>
<span id="cb33-778"><a href="#cb33-778" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🏆 GOLDEN SEGMENT: </span><span class="sc">{</span>best[<span class="st">'segment'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-779"><a href="#cb33-779" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Conversion: </span><span class="sc">{</span>best[<span class="st">'rate'</span>]<span class="sc">:.1%}</span><span class="ss"> (n=</span><span class="sc">{</span>best[<span class="st">'n'</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb33-780"><a href="#cb33-780" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   This is </span><span class="sc">{</span>best[<span class="st">'rate'</span>]<span class="op">/</span>df_product[<span class="st">'is_success'</span>]<span class="sc">.</span>mean()<span class="sc">:.1f}</span><span class="ss">x the </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> average"</span>)</span>
<span id="cb33-781"><a href="#cb33-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-782"><a href="#cb33-782" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> trio_stats</span>
<span id="cb33-783"><a href="#cb33-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-784"><a href="#cb33-784" aria-hidden="true" tabindex="-1"></a>power_trio_stats <span class="op">=</span> analyze_power_trio(df, <span class="st">'Mx'</span>)</span>
<span id="cb33-785"><a href="#cb33-785" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-786"><a href="#cb33-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-787"><a href="#cb33-787" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.5 Algorithmic Segment Discovery (Decision Tree)</span></span>
<span id="cb33-788"><a href="#cb33-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-789"><a href="#cb33-789" aria-hidden="true" tabindex="-1"></a>**Architect's Note:**</span>
<span id="cb33-790"><a href="#cb33-790" aria-hidden="true" tabindex="-1"></a>Instead of manually searching for interactions, let the algorithm find the optimal splits.</span>
<span id="cb33-791"><a href="#cb33-791" aria-hidden="true" tabindex="-1"></a>A shallow Decision Tree IS an interaction detector.</span>
<span id="cb33-792"><a href="#cb33-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-795"><a href="#cb33-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-796"><a href="#cb33-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: decision-tree</span></span>
<span id="cb33-797"><a href="#cb33-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Algorithmic targeting rules: The machine finds segments humans miss"</span></span>
<span id="cb33-798"><a href="#cb33-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-799"><a href="#cb33-799" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> discover_targeting_rules(df, product<span class="op">=</span><span class="st">'Mx'</span>, max_depth<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb33-800"><a href="#cb33-800" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-801"><a href="#cb33-801" aria-hidden="true" tabindex="-1"></a><span class="co">    Use a Decision Tree to algorithmically discover optimal segments.</span></span>
<span id="cb33-802"><a href="#cb33-802" aria-hidden="true" tabindex="-1"></a><span class="co">    This removes human bias and finds non-obvious interactions.</span></span>
<span id="cb33-803"><a href="#cb33-803" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-804"><a href="#cb33-804" aria-hidden="true" tabindex="-1"></a>    df_product <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb33-805"><a href="#cb33-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-806"><a href="#cb33-806" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select features</span></span>
<span id="cb33-807"><a href="#cb33-807" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [<span class="st">'title_seniority'</span>, <span class="st">'title_function'</span>, <span class="st">'acct_target_industry'</span>,</span>
<span id="cb33-808"><a href="#cb33-808" aria-hidden="true" tabindex="-1"></a>                <span class="st">'acct_manufacturing_model'</span>, <span class="st">'title_scope'</span>, <span class="st">'completeness_tier'</span>]</span>
<span id="cb33-809"><a href="#cb33-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-810"><a href="#cb33-810" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check which features exist</span></span>
<span id="cb33-811"><a href="#cb33-811" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> features <span class="cf">if</span> f <span class="kw">in</span> df_product.columns]</span>
<span id="cb33-812"><a href="#cb33-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-813"><a href="#cb33-813" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Encode categorical variables</span></span>
<span id="cb33-814"><a href="#cb33-814" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df_product[features].astype(<span class="bu">str</span>).copy()</span>
<span id="cb33-815"><a href="#cb33-815" aria-hidden="true" tabindex="-1"></a>    encoders <span class="op">=</span> {}</span>
<span id="cb33-816"><a href="#cb33-816" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> features:</span>
<span id="cb33-817"><a href="#cb33-817" aria-hidden="true" tabindex="-1"></a>        le <span class="op">=</span> LabelEncoder()</span>
<span id="cb33-818"><a href="#cb33-818" aria-hidden="true" tabindex="-1"></a>        X[col] <span class="op">=</span> le.fit_transform(X[col])</span>
<span id="cb33-819"><a href="#cb33-819" aria-hidden="true" tabindex="-1"></a>        encoders[col] <span class="op">=</span> le</span>
<span id="cb33-820"><a href="#cb33-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-821"><a href="#cb33-821" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> df_product[<span class="st">'is_success'</span>]</span>
<span id="cb33-822"><a href="#cb33-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-823"><a href="#cb33-823" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit shallow tree (depth 3 = 2-way and 3-way interactions)</span></span>
<span id="cb33-824"><a href="#cb33-824" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> DecisionTreeClassifier(</span>
<span id="cb33-825"><a href="#cb33-825" aria-hidden="true" tabindex="-1"></a>        max_depth<span class="op">=</span>max_depth,</span>
<span id="cb33-826"><a href="#cb33-826" aria-hidden="true" tabindex="-1"></a>        min_samples_leaf<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb33-827"><a href="#cb33-827" aria-hidden="true" tabindex="-1"></a>        min_samples_split<span class="op">=</span><span class="dv">60</span>,</span>
<span id="cb33-828"><a href="#cb33-828" aria-hidden="true" tabindex="-1"></a>        random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb33-829"><a href="#cb33-829" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-830"><a href="#cb33-830" aria-hidden="true" tabindex="-1"></a>    tree.fit(X, y)</span>
<span id="cb33-831"><a href="#cb33-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-832"><a href="#cb33-832" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feature importance</span></span>
<span id="cb33-833"><a href="#cb33-833" aria-hidden="true" tabindex="-1"></a>    importance <span class="op">=</span> pd.DataFrame({</span>
<span id="cb33-834"><a href="#cb33-834" aria-hidden="true" tabindex="-1"></a>        <span class="st">'feature'</span>: features,</span>
<span id="cb33-835"><a href="#cb33-835" aria-hidden="true" tabindex="-1"></a>        <span class="st">'importance'</span>: tree.feature_importances_</span>
<span id="cb33-836"><a href="#cb33-836" aria-hidden="true" tabindex="-1"></a>    }).sort_values(<span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-837"><a href="#cb33-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-838"><a href="#cb33-838" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-839"><a href="#cb33-839" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"ALGORITHMIC SEGMENT DISCOVERY (</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb33-840"><a href="#cb33-840" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-841"><a href="#cb33-841" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Feature Importance (from Decision Tree):"</span>)</span>
<span id="cb33-842"><a href="#cb33-842" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(importance.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb33-843"><a href="#cb33-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-844"><a href="#cb33-844" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization: Feature importance</span></span>
<span id="cb33-845"><a href="#cb33-845" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb33-846"><a href="#cb33-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-847"><a href="#cb33-847" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Left: Feature importance bar</span></span>
<span id="cb33-848"><a href="#cb33-848" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb33-849"><a href="#cb33-849" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> imp <span class="op">&gt;</span> importance[<span class="st">'importance'</span>].median()</span>
<span id="cb33-850"><a href="#cb33-850" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> PROJECT_COLS[<span class="st">'Neutral'</span>] <span class="cf">for</span> imp <span class="kw">in</span> importance[<span class="st">'importance'</span>]]</span>
<span id="cb33-851"><a href="#cb33-851" aria-hidden="true" tabindex="-1"></a>    ax1.barh(<span class="bu">range</span>(<span class="bu">len</span>(importance)), importance[<span class="st">'importance'</span>], color<span class="op">=</span>colors)</span>
<span id="cb33-852"><a href="#cb33-852" aria-hidden="true" tabindex="-1"></a>    ax1.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(importance)))</span>
<span id="cb33-853"><a href="#cb33-853" aria-hidden="true" tabindex="-1"></a>    ax1.set_yticklabels(importance[<span class="st">'feature'</span>])</span>
<span id="cb33-854"><a href="#cb33-854" aria-hidden="true" tabindex="-1"></a>    ax1.invert_yaxis()</span>
<span id="cb33-855"><a href="#cb33-855" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Importance'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-856"><a href="#cb33-856" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Targeting: Which Features Matter Most?'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-857"><a href="#cb33-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-858"><a href="#cb33-858" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Right: Tree visualization (simplified)</span></span>
<span id="cb33-859"><a href="#cb33-859" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb33-860"><a href="#cb33-860" aria-hidden="true" tabindex="-1"></a>    plot_tree(tree, feature_names<span class="op">=</span>features, class_names<span class="op">=</span>[<span class="st">'Fail'</span>, <span class="st">'Success'</span>],</span>
<span id="cb33-861"><a href="#cb33-861" aria-hidden="true" tabindex="-1"></a>              filled<span class="op">=</span><span class="va">True</span>, rounded<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax2, fontsize<span class="op">=</span><span class="dv">8</span>, max_depth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb33-862"><a href="#cb33-862" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Targeting Decision Rules'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-863"><a href="#cb33-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-864"><a href="#cb33-864" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb33-865"><a href="#cb33-865" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb33-866"><a href="#cb33-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-867"><a href="#cb33-867" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tree, importance</span>
<span id="cb33-868"><a href="#cb33-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-869"><a href="#cb33-869" aria-hidden="true" tabindex="-1"></a>tree_model, feature_importance <span class="op">=</span> discover_targeting_rules(df, <span class="st">'Mx'</span>)</span>
<span id="cb33-870"><a href="#cb33-870" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-871"><a href="#cb33-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-872"><a href="#cb33-872" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.6 The Original "Magic Quadrant" (Industry × Model)</span></span>
<span id="cb33-873"><a href="#cb33-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-876"><a href="#cb33-876" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-877"><a href="#cb33-877" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: magic-quadrant</span></span>
<span id="cb33-878"><a href="#cb33-878" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The Magic Quadrant: Industry × Model heatmap with statistical confidence"</span></span>
<span id="cb33-879"><a href="#cb33-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-880"><a href="#cb33-880" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> interaction_heatmap(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb33-881"><a href="#cb33-881" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-882"><a href="#cb33-882" aria-hidden="true" tabindex="-1"></a><span class="co">    Classic 2D heatmap with Bayesian confidence intervals.</span></span>
<span id="cb33-883"><a href="#cb33-883" aria-hidden="true" tabindex="-1"></a><span class="co">    Cells with low sample sizes are grayed out.</span></span>
<span id="cb33-884"><a href="#cb33-884" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-885"><a href="#cb33-885" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product]</span>
<span id="cb33-886"><a href="#cb33-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-887"><a href="#cb33-887" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pivot tables</span></span>
<span id="cb33-888"><a href="#cb33-888" aria-hidden="true" tabindex="-1"></a>    pivot_rate <span class="op">=</span> subset.pivot_table(</span>
<span id="cb33-889"><a href="#cb33-889" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span><span class="st">'acct_target_industry'</span>,</span>
<span id="cb33-890"><a href="#cb33-890" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span><span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb33-891"><a href="#cb33-891" aria-hidden="true" tabindex="-1"></a>        values<span class="op">=</span><span class="st">'is_success'</span>,</span>
<span id="cb33-892"><a href="#cb33-892" aria-hidden="true" tabindex="-1"></a>        aggfunc<span class="op">=</span><span class="st">'mean'</span></span>
<span id="cb33-893"><a href="#cb33-893" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-894"><a href="#cb33-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-895"><a href="#cb33-895" aria-hidden="true" tabindex="-1"></a>    pivot_n <span class="op">=</span> subset.pivot_table(</span>
<span id="cb33-896"><a href="#cb33-896" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span><span class="st">'acct_target_industry'</span>,</span>
<span id="cb33-897"><a href="#cb33-897" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span><span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb33-898"><a href="#cb33-898" aria-hidden="true" tabindex="-1"></a>        values<span class="op">=</span><span class="st">'is_success'</span>,</span>
<span id="cb33-899"><a href="#cb33-899" aria-hidden="true" tabindex="-1"></a>        aggfunc<span class="op">=</span><span class="st">'count'</span></span>
<span id="cb33-900"><a href="#cb33-900" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-901"><a href="#cb33-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-902"><a href="#cb33-902" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create annotation with rate and sample size</span></span>
<span id="cb33-903"><a href="#cb33-903" aria-hidden="true" tabindex="-1"></a>    annot <span class="op">=</span> pivot_rate.copy().astype(<span class="bu">str</span>)</span>
<span id="cb33-904"><a href="#cb33-904" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> pivot_rate.index:</span>
<span id="cb33-905"><a href="#cb33-905" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> pivot_rate.columns:</span>
<span id="cb33-906"><a href="#cb33-906" aria-hidden="true" tabindex="-1"></a>            rate <span class="op">=</span> pivot_rate.loc[i, j]</span>
<span id="cb33-907"><a href="#cb33-907" aria-hidden="true" tabindex="-1"></a>            n <span class="op">=</span> pivot_n.loc[i, j] <span class="cf">if</span> pd.notna(pivot_n.loc[i, j]) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb33-908"><a href="#cb33-908" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pd.notna(rate) <span class="kw">and</span> n <span class="op">&gt;=</span> MIN_SAMPLE_SIZE:</span>
<span id="cb33-909"><a href="#cb33-909" aria-hidden="true" tabindex="-1"></a>                annot.loc[i, j] <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>rate<span class="sc">:.0%}</span><span class="ch">\n</span><span class="ss">(n=</span><span class="sc">{</span><span class="bu">int</span>(n)<span class="sc">}</span><span class="ss">)'</span></span>
<span id="cb33-910"><a href="#cb33-910" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> pd.notna(rate):</span>
<span id="cb33-911"><a href="#cb33-911" aria-hidden="true" tabindex="-1"></a>                annot.loc[i, j] <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>rate<span class="sc">:.0%}</span><span class="ch">\n</span><span class="ss">(n=</span><span class="sc">{</span><span class="bu">int</span>(n)<span class="sc">}</span><span class="ss">)*'</span>  <span class="co"># Asterisk for low n</span></span>
<span id="cb33-912"><a href="#cb33-912" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb33-913"><a href="#cb33-913" aria-hidden="true" tabindex="-1"></a>                annot.loc[i, j] <span class="op">=</span> <span class="st">''</span></span>
<span id="cb33-914"><a href="#cb33-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-915"><a href="#cb33-915" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mask for low sample sizes</span></span>
<span id="cb33-916"><a href="#cb33-916" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> pivot_n <span class="op">&lt;</span> MIN_SAMPLE_SIZE</span>
<span id="cb33-917"><a href="#cb33-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-918"><a href="#cb33-918" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))</span>
<span id="cb33-919"><a href="#cb33-919" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(pivot_rate, annot<span class="op">=</span>annot, fmt<span class="op">=</span><span class="st">''</span>, mask<span class="op">=</span>mask,</span>
<span id="cb33-920"><a href="#cb33-920" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, center<span class="op">=</span>subset[<span class="st">'is_success'</span>].mean(),</span>
<span id="cb33-921"><a href="#cb33-921" aria-hidden="true" tabindex="-1"></a>                cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Conversion Rate'</span>}, linewidths<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb33-922"><a href="#cb33-922" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"The 'Magic Quadrant' for </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">: Industry × Manufacturing Model</span><span class="ch">\n</span><span class="ss">(Grayed cells: n &lt; </span><span class="sc">{</span>MIN_SAMPLE_SIZE<span class="sc">}</span><span class="ss">)"</span>,</span>
<span id="cb33-923"><a href="#cb33-923" aria-hidden="true" tabindex="-1"></a>              fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-924"><a href="#cb33-924" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Target Industry'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-925"><a href="#cb33-925" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Manufacturing Model'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-926"><a href="#cb33-926" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb33-927"><a href="#cb33-927" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb33-928"><a href="#cb33-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-929"><a href="#cb33-929" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find top cells</span></span>
<span id="cb33-930"><a href="#cb33-930" aria-hidden="true" tabindex="-1"></a>    pivot_flat <span class="op">=</span> pivot_rate.stack().reset_index()</span>
<span id="cb33-931"><a href="#cb33-931" aria-hidden="true" tabindex="-1"></a>    pivot_flat.columns <span class="op">=</span> [<span class="st">'Industry'</span>, <span class="st">'Model'</span>, <span class="st">'Rate'</span>]</span>
<span id="cb33-932"><a href="#cb33-932" aria-hidden="true" tabindex="-1"></a>    pivot_flat_n <span class="op">=</span> pivot_n.stack().reset_index()</span>
<span id="cb33-933"><a href="#cb33-933" aria-hidden="true" tabindex="-1"></a>    pivot_flat_n.columns <span class="op">=</span> [<span class="st">'Industry'</span>, <span class="st">'Model'</span>, <span class="st">'N'</span>]</span>
<span id="cb33-934"><a href="#cb33-934" aria-hidden="true" tabindex="-1"></a>    pivot_flat <span class="op">=</span> pivot_flat.merge(pivot_flat_n)</span>
<span id="cb33-935"><a href="#cb33-935" aria-hidden="true" tabindex="-1"></a>    pivot_flat <span class="op">=</span> pivot_flat[pivot_flat[<span class="st">'N'</span>] <span class="op">&gt;=</span> MIN_SAMPLE_SIZE].sort_values(<span class="st">'Rate'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-936"><a href="#cb33-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-937"><a href="#cb33-937" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🎯 TOP 5 SEGMENTS (n &gt;= </span><span class="sc">{</span>MIN_SAMPLE_SIZE<span class="sc">}</span><span class="ss">):"</span>)</span>
<span id="cb33-938"><a href="#cb33-938" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(pivot_flat.head(<span class="dv">5</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb33-939"><a href="#cb33-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-940"><a href="#cb33-940" aria-hidden="true" tabindex="-1"></a>interaction_heatmap(df, <span class="st">'Mx'</span>)</span>
<span id="cb33-941"><a href="#cb33-941" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-942"><a href="#cb33-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-943"><a href="#cb33-943" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.7 Semantic Signal Analysis (Log-Odds with N-grams)</span></span>
<span id="cb33-944"><a href="#cb33-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-947"><a href="#cb33-947" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-948"><a href="#cb33-948" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: nlp-signal</span></span>
<span id="cb33-949"><a href="#cb33-949" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The Language of Buyers: Which title words/phrases predict conversion?"</span></span>
<span id="cb33-950"><a href="#cb33-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-951"><a href="#cb33-951" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> semantic_log_odds(df, product_filter<span class="op">=</span><span class="st">'Mx'</span>, ngram_range<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">2</span>), min_freq<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb33-952"><a href="#cb33-952" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-953"><a href="#cb33-953" aria-hidden="true" tabindex="-1"></a><span class="co">    UPGRADED: Now includes bigrams to capture context.</span></span>
<span id="cb33-954"><a href="#cb33-954" aria-hidden="true" tabindex="-1"></a><span class="co">    "Quality Manager" vs "Project Manager" are very different.</span></span>
<span id="cb33-955"><a href="#cb33-955" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-956"><a href="#cb33-956" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product_filter].copy()</span>
<span id="cb33-957"><a href="#cb33-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-958"><a href="#cb33-958" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Vectorize with bigrams</span></span>
<span id="cb33-959"><a href="#cb33-959" aria-hidden="true" tabindex="-1"></a>    vec <span class="op">=</span> CountVectorizer(</span>
<span id="cb33-960"><a href="#cb33-960" aria-hidden="true" tabindex="-1"></a>        stop_words<span class="op">=</span><span class="st">'english'</span>,</span>
<span id="cb33-961"><a href="#cb33-961" aria-hidden="true" tabindex="-1"></a>        min_df<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb33-962"><a href="#cb33-962" aria-hidden="true" tabindex="-1"></a>        ngram_range<span class="op">=</span>ngram_range,</span>
<span id="cb33-963"><a href="#cb33-963" aria-hidden="true" tabindex="-1"></a>        token_pattern<span class="op">=</span><span class="vs">r'</span><span class="dv">\b</span><span class="pp">[a-zA-Z]</span><span class="op">{2,}</span><span class="dv">\b</span><span class="vs">'</span></span>
<span id="cb33-964"><a href="#cb33-964" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-965"><a href="#cb33-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-966"><a href="#cb33-966" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> vec.fit_transform(subset[<span class="st">'contact_lead_title'</span>].fillna(<span class="st">''</span>))</span>
<span id="cb33-967"><a href="#cb33-967" aria-hidden="true" tabindex="-1"></a>    words <span class="op">=</span> np.array(vec.get_feature_names_out())</span>
<span id="cb33-968"><a href="#cb33-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-969"><a href="#cb33-969" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> subset[<span class="st">'is_success'</span>].values</span>
<span id="cb33-970"><a href="#cb33-970" aria-hidden="true" tabindex="-1"></a>    x_pos <span class="op">=</span> np.array(X[y<span class="op">==</span><span class="dv">1</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)).flatten()</span>
<span id="cb33-971"><a href="#cb33-971" aria-hidden="true" tabindex="-1"></a>    x_neg <span class="op">=</span> np.array(X[y<span class="op">==</span><span class="dv">0</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)).flatten()</span>
<span id="cb33-972"><a href="#cb33-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-973"><a href="#cb33-973" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log-odds with Laplace smoothing</span></span>
<span id="cb33-974"><a href="#cb33-974" aria-hidden="true" tabindex="-1"></a>    p_pos <span class="op">=</span> (x_pos <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> (x_pos.<span class="bu">sum</span>() <span class="op">+</span> <span class="bu">len</span>(words))</span>
<span id="cb33-975"><a href="#cb33-975" aria-hidden="true" tabindex="-1"></a>    p_neg <span class="op">=</span> (x_neg <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> (x_neg.<span class="bu">sum</span>() <span class="op">+</span> <span class="bu">len</span>(words))</span>
<span id="cb33-976"><a href="#cb33-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-977"><a href="#cb33-977" aria-hidden="true" tabindex="-1"></a>    log_odds <span class="op">=</span> np.log(p_pos <span class="op">/</span> p_neg)</span>
<span id="cb33-978"><a href="#cb33-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-979"><a href="#cb33-979" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> pd.DataFrame({</span>
<span id="cb33-980"><a href="#cb33-980" aria-hidden="true" tabindex="-1"></a>        <span class="st">'phrase'</span>: words,</span>
<span id="cb33-981"><a href="#cb33-981" aria-hidden="true" tabindex="-1"></a>        <span class="st">'log_odds'</span>: log_odds,</span>
<span id="cb33-982"><a href="#cb33-982" aria-hidden="true" tabindex="-1"></a>        <span class="st">'freq'</span>: x_pos <span class="op">+</span> x_neg,</span>
<span id="cb33-983"><a href="#cb33-983" aria-hidden="true" tabindex="-1"></a>        <span class="st">'n_words'</span>: [<span class="bu">len</span>(w.split()) <span class="cf">for</span> w <span class="kw">in</span> words]</span>
<span id="cb33-984"><a href="#cb33-984" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb33-985"><a href="#cb33-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-986"><a href="#cb33-986" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter by frequency</span></span>
<span id="cb33-987"><a href="#cb33-987" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> res[res[<span class="st">'freq'</span>] <span class="op">&gt;=</span> min_freq]</span>
<span id="cb33-988"><a href="#cb33-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-989"><a href="#cb33-989" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top signals</span></span>
<span id="cb33-990"><a href="#cb33-990" aria-hidden="true" tabindex="-1"></a>    top_positive <span class="op">=</span> res.nlargest(<span class="dv">12</span>, <span class="st">'log_odds'</span>)</span>
<span id="cb33-991"><a href="#cb33-991" aria-hidden="true" tabindex="-1"></a>    top_negative <span class="op">=</span> res.nsmallest(<span class="dv">8</span>, <span class="st">'log_odds'</span>)</span>
<span id="cb33-992"><a href="#cb33-992" aria-hidden="true" tabindex="-1"></a>    top_signals <span class="op">=</span> pd.concat([top_positive, top_negative]).sort_values(<span class="st">'log_odds'</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-993"><a href="#cb33-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-994"><a href="#cb33-994" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb33-995"><a href="#cb33-995" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb33-996"><a href="#cb33-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-997"><a href="#cb33-997" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>] <span class="cf">for</span> x <span class="kw">in</span> top_signals[<span class="st">'log_odds'</span>]]</span>
<span id="cb33-998"><a href="#cb33-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-999"><a href="#cb33-999" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(top_signals))</span>
<span id="cb33-1000"><a href="#cb33-1000" aria-hidden="true" tabindex="-1"></a>    ax.barh(y_pos, top_signals[<span class="st">'log_odds'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb33-1001"><a href="#cb33-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1002"><a href="#cb33-1002" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Labels</span></span>
<span id="cb33-1003"><a href="#cb33-1003" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(top_signals.itertuples()):</span>
<span id="cb33-1004"><a href="#cb33-1004" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row<span class="sc">.</span>phrase<span class="sc">}</span><span class="ss"> (n=</span><span class="sc">{</span>row<span class="sc">.</span>freq<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb33-1005"><a href="#cb33-1005" aria-hidden="true" tabindex="-1"></a>        ax.text(<span class="fl">0.01</span> <span class="cf">if</span> row.log_odds <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="op">-</span><span class="fl">0.01</span>, i, label,</span>
<span id="cb33-1006"><a href="#cb33-1006" aria-hidden="true" tabindex="-1"></a>               va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'left'</span> <span class="cf">if</span> row.log_odds <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'right'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb33-1007"><a href="#cb33-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1008"><a href="#cb33-1008" aria-hidden="true" tabindex="-1"></a>    ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-1009"><a href="#cb33-1009" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks([])</span>
<span id="cb33-1010"><a href="#cb33-1010" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Log-Odds Ratio (Right = Higher Conversion, Left = Lower)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-1011"><a href="#cb33-1011" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'Semantic Signals for </span><span class="sc">{</span>product_filter<span class="sc">}</span><span class="ss">: Title Words/Phrases that Predict Conversion'</span>,</span>
<span id="cb33-1012"><a href="#cb33-1012" aria-hidden="true" tabindex="-1"></a>                fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-1013"><a href="#cb33-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1014"><a href="#cb33-1014" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb33-1015"><a href="#cb33-1015" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb33-1016"><a href="#cb33-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1017"><a href="#cb33-1017" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">📝 CALL LIST: Top phrases predicting success:"</span>)</span>
<span id="cb33-1018"><a href="#cb33-1018" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_positive[[<span class="st">'phrase'</span>, <span class="st">'log_odds'</span>, <span class="st">'freq'</span>]].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb33-1019"><a href="#cb33-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1020"><a href="#cb33-1020" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">⚠️  AVOID LIST: Phrases predicting failure:"</span>)</span>
<span id="cb33-1021"><a href="#cb33-1021" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top_negative[[<span class="st">'phrase'</span>, <span class="st">'log_odds'</span>, <span class="st">'freq'</span>]].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb33-1022"><a href="#cb33-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1023"><a href="#cb33-1023" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span>
<span id="cb33-1024"><a href="#cb33-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1025"><a href="#cb33-1025" aria-hidden="true" tabindex="-1"></a>semantic_results <span class="op">=</span> semantic_log_odds(df, <span class="st">'Mx'</span>)</span>
<span id="cb33-1026"><a href="#cb33-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1027"><a href="#cb33-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1028"><a href="#cb33-1028" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.8 Feature Importance (Mutual Information)</span></span>
<span id="cb33-1029"><a href="#cb33-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1032"><a href="#cb33-1032" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-1033"><a href="#cb33-1033" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mutual-info</span></span>
<span id="cb33-1034"><a href="#cb33-1034" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Driver Rank: Mathematical importance of each feature for predicting success"</span></span>
<span id="cb33-1035"><a href="#cb33-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1036"><a href="#cb33-1036" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rank_features(df, product<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb33-1037"><a href="#cb33-1037" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-1038"><a href="#cb33-1038" aria-hidden="true" tabindex="-1"></a><span class="co">    Use Mutual Information to objectively rank feature importance.</span></span>
<span id="cb33-1039"><a href="#cb33-1039" aria-hidden="true" tabindex="-1"></a><span class="co">    This removes human bias from feature selection.</span></span>
<span id="cb33-1040"><a href="#cb33-1040" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-1041"><a href="#cb33-1041" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> product:</span>
<span id="cb33-1042"><a href="#cb33-1042" aria-hidden="true" tabindex="-1"></a>        df_subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb33-1043"><a href="#cb33-1043" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb33-1044"><a href="#cb33-1044" aria-hidden="true" tabindex="-1"></a>        df_subset <span class="op">=</span> df.copy()</span>
<span id="cb33-1045"><a href="#cb33-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1046"><a href="#cb33-1046" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select features</span></span>
<span id="cb33-1047"><a href="#cb33-1047" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [<span class="st">'acct_target_industry'</span>, <span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb33-1048"><a href="#cb33-1048" aria-hidden="true" tabindex="-1"></a>                <span class="st">'title_seniority'</span>, <span class="st">'title_function'</span>, <span class="st">'title_scope'</span>,</span>
<span id="cb33-1049"><a href="#cb33-1049" aria-hidden="true" tabindex="-1"></a>                <span class="st">'priority'</span>, <span class="st">'last_tactic_campaign_channel'</span>, <span class="st">'completeness_tier'</span>]</span>
<span id="cb33-1050"><a href="#cb33-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1051"><a href="#cb33-1051" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to existing columns</span></span>
<span id="cb33-1052"><a href="#cb33-1052" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> features <span class="cf">if</span> f <span class="kw">in</span> df_subset.columns]</span>
<span id="cb33-1053"><a href="#cb33-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1054"><a href="#cb33-1054" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Encode</span></span>
<span id="cb33-1055"><a href="#cb33-1055" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df_subset[features].astype(<span class="bu">str</span>).<span class="bu">apply</span>(LabelEncoder().fit_transform)</span>
<span id="cb33-1056"><a href="#cb33-1056" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> df_subset[<span class="st">'is_success'</span>]</span>
<span id="cb33-1057"><a href="#cb33-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1058"><a href="#cb33-1058" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate MI</span></span>
<span id="cb33-1059"><a href="#cb33-1059" aria-hidden="true" tabindex="-1"></a>    mi <span class="op">=</span> mutual_info_classif(X, y, discrete_features<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb33-1060"><a href="#cb33-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1061"><a href="#cb33-1061" aria-hidden="true" tabindex="-1"></a>    mi_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb33-1062"><a href="#cb33-1062" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Feature'</span>: features,</span>
<span id="cb33-1063"><a href="#cb33-1063" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Importance'</span>: mi</span>
<span id="cb33-1064"><a href="#cb33-1064" aria-hidden="true" tabindex="-1"></a>    }).sort_values(<span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-1065"><a href="#cb33-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1066"><a href="#cb33-1066" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-1067"><a href="#cb33-1067" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"FEATURE IMPORTANCE </span><span class="sc">{</span><span class="st">'('</span><span class="op">+</span>product<span class="op">+</span><span class="st">')'</span> <span class="cf">if</span> product <span class="cf">else</span> <span class="st">'(All)'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-1068"><a href="#cb33-1068" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-1069"><a href="#cb33-1069" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(mi_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb33-1070"><a href="#cb33-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1071"><a href="#cb33-1071" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb33-1072"><a href="#cb33-1072" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb33-1073"><a href="#cb33-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1074"><a href="#cb33-1074" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> imp <span class="op">&gt;</span> mi_df[<span class="st">'Importance'</span>].median()</span>
<span id="cb33-1075"><a href="#cb33-1075" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> PROJECT_COLS[<span class="st">'Neutral'</span>] <span class="cf">for</span> imp <span class="kw">in</span> mi_df[<span class="st">'Importance'</span>]]</span>
<span id="cb33-1076"><a href="#cb33-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1077"><a href="#cb33-1077" aria-hidden="true" tabindex="-1"></a>    ax.barh(<span class="bu">range</span>(<span class="bu">len</span>(mi_df)), mi_df[<span class="st">'Importance'</span>], color<span class="op">=</span>colors)</span>
<span id="cb33-1078"><a href="#cb33-1078" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(mi_df)))</span>
<span id="cb33-1079"><a href="#cb33-1079" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(mi_df[<span class="st">'Feature'</span>])</span>
<span id="cb33-1080"><a href="#cb33-1080" aria-hidden="true" tabindex="-1"></a>    ax.invert_yaxis()</span>
<span id="cb33-1081"><a href="#cb33-1081" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Mutual Information (bits)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-1082"><a href="#cb33-1082" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="ss">f'Feature Importance for Predicting Success'</span></span>
<span id="cb33-1083"><a href="#cb33-1083" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> product:</span>
<span id="cb33-1084"><a href="#cb33-1084" aria-hidden="true" tabindex="-1"></a>        title <span class="op">+=</span> <span class="ss">f' (</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">)'</span></span>
<span id="cb33-1085"><a href="#cb33-1085" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-1086"><a href="#cb33-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1087"><a href="#cb33-1087" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb33-1088"><a href="#cb33-1088" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb33-1089"><a href="#cb33-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1090"><a href="#cb33-1090" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mi_df</span>
<span id="cb33-1091"><a href="#cb33-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1092"><a href="#cb33-1092" aria-hidden="true" tabindex="-1"></a>mi_results <span class="op">=</span> rank_features(df, <span class="st">'Mx'</span>)</span>
<span id="cb33-1093"><a href="#cb33-1093" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1094"><a href="#cb33-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1095"><a href="#cb33-1095" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb33-1096"><a href="#cb33-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1097"><a href="#cb33-1097" aria-hidden="true" tabindex="-1"></a><span class="fu"># Phase 5: Record Completeness Analysis</span></span>
<span id="cb33-1098"><a href="#cb33-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1099"><a href="#cb33-1099" aria-hidden="true" tabindex="-1"></a>**Architect's Note:**</span>
<span id="cb33-1100"><a href="#cb33-1100" aria-hidden="true" tabindex="-1"></a>HYPOTHESIS: Companies that fill out more CRM fields are more serious buyers.</span>
<span id="cb33-1101"><a href="#cb33-1101" aria-hidden="true" tabindex="-1"></a>This is a proxy for "buyer sophistication" that other teams will miss.</span>
<span id="cb33-1102"><a href="#cb33-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1105"><a href="#cb33-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-1106"><a href="#cb33-1106" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: completeness-analysis</span></span>
<span id="cb33-1107"><a href="#cb33-1107" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Record Completeness: More complete records = More serious buyers?"</span></span>
<span id="cb33-1108"><a href="#cb33-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1109"><a href="#cb33-1109" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_completeness(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb33-1110"><a href="#cb33-1110" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-1111"><a href="#cb33-1111" aria-hidden="true" tabindex="-1"></a><span class="co">    Test if record completeness correlates with conversion.</span></span>
<span id="cb33-1112"><a href="#cb33-1112" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-1113"><a href="#cb33-1113" aria-hidden="true" tabindex="-1"></a>    df_product <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb33-1114"><a href="#cb33-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1115"><a href="#cb33-1115" aria-hidden="true" tabindex="-1"></a>    completeness_stats <span class="op">=</span> df_product.groupby(<span class="st">'completeness_tier'</span>).agg(</span>
<span id="cb33-1116"><a href="#cb33-1116" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'size'</span>),</span>
<span id="cb33-1117"><a href="#cb33-1117" aria-hidden="true" tabindex="-1"></a>        successes<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'sum'</span>)</span>
<span id="cb33-1118"><a href="#cb33-1118" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb33-1119"><a href="#cb33-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1120"><a href="#cb33-1120" aria-hidden="true" tabindex="-1"></a>    completeness_stats[<span class="st">'rate'</span>] <span class="op">=</span> completeness_stats.<span class="bu">apply</span>(</span>
<span id="cb33-1121"><a href="#cb33-1121" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">0</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-1122"><a href="#cb33-1122" aria-hidden="true" tabindex="-1"></a>    completeness_stats[<span class="st">'ci_low'</span>] <span class="op">=</span> completeness_stats.<span class="bu">apply</span>(</span>
<span id="cb33-1123"><a href="#cb33-1123" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">1</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-1124"><a href="#cb33-1124" aria-hidden="true" tabindex="-1"></a>    completeness_stats[<span class="st">'ci_high'</span>] <span class="op">=</span> completeness_stats.<span class="bu">apply</span>(</span>
<span id="cb33-1125"><a href="#cb33-1125" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">2</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-1126"><a href="#cb33-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1127"><a href="#cb33-1127" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-1128"><a href="#cb33-1128" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"RECORD COMPLETENESS vs CONVERSION (</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb33-1129"><a href="#cb33-1129" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-1130"><a href="#cb33-1130" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(completeness_stats.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb33-1131"><a href="#cb33-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1132"><a href="#cb33-1132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb33-1133"><a href="#cb33-1133" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb33-1134"><a href="#cb33-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1135"><a href="#cb33-1135" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(completeness_stats))</span>
<span id="cb33-1136"><a href="#cb33-1136" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.bar(x, completeness_stats[<span class="st">'rate'</span>],</span>
<span id="cb33-1137"><a href="#cb33-1137" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span>[PROJECT_COLS[<span class="st">'Failure'</span>], PROJECT_COLS[<span class="st">'Neutral'</span>], PROJECT_COLS[<span class="st">'Success'</span>]])</span>
<span id="cb33-1138"><a href="#cb33-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1139"><a href="#cb33-1139" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Error bars</span></span>
<span id="cb33-1140"><a href="#cb33-1140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> completeness_stats.iterrows():</span>
<span id="cb33-1141"><a href="#cb33-1141" aria-hidden="true" tabindex="-1"></a>        ax.errorbar(i, row[<span class="st">'rate'</span>],</span>
<span id="cb33-1142"><a href="#cb33-1142" aria-hidden="true" tabindex="-1"></a>                   yerr<span class="op">=</span>[[row[<span class="st">'rate'</span>] <span class="op">-</span> row[<span class="st">'ci_low'</span>]], [row[<span class="st">'ci_high'</span>] <span class="op">-</span> row[<span class="st">'rate'</span>]]],</span>
<span id="cb33-1143"><a href="#cb33-1143" aria-hidden="true" tabindex="-1"></a>                   fmt<span class="op">=</span><span class="st">'none'</span>, color<span class="op">=</span><span class="st">'black'</span>, capsize<span class="op">=</span><span class="dv">10</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb33-1144"><a href="#cb33-1144" aria-hidden="true" tabindex="-1"></a>        ax.text(i, row[<span class="st">'rate'</span>] <span class="op">+</span> <span class="fl">0.02</span>, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'rate'</span>]<span class="sc">:.1%}</span><span class="ch">\n</span><span class="ss">(n=</span><span class="sc">{</span>row[<span class="st">'n'</span>]<span class="sc">}</span><span class="ss">)"</span>,</span>
<span id="cb33-1145"><a href="#cb33-1145" aria-hidden="true" tabindex="-1"></a>               ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb33-1146"><a href="#cb33-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1147"><a href="#cb33-1147" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(x)</span>
<span id="cb33-1148"><a href="#cb33-1148" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels(completeness_stats[<span class="st">'completeness_tier'</span>])</span>
<span id="cb33-1149"><a href="#cb33-1149" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Conversion Rate'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-1150"><a href="#cb33-1150" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Record Completeness Tier'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb33-1151"><a href="#cb33-1151" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">: Does CRM Data Quality Predict Conversion?'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-1152"><a href="#cb33-1152" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="dv">0</span>, <span class="fl">0.30</span>)</span>
<span id="cb33-1153"><a href="#cb33-1153" aria-hidden="true" tabindex="-1"></a>    ax.axhline(y<span class="op">=</span>df_product[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Average'</span>)</span>
<span id="cb33-1154"><a href="#cb33-1154" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span>
<span id="cb33-1155"><a href="#cb33-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1156"><a href="#cb33-1156" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb33-1157"><a href="#cb33-1157" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb33-1158"><a href="#cb33-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1159"><a href="#cb33-1159" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insight</span></span>
<span id="cb33-1160"><a href="#cb33-1160" aria-hidden="true" tabindex="-1"></a>    high_rate <span class="op">=</span> completeness_stats[completeness_stats[<span class="st">'completeness_tier'</span>] <span class="op">==</span> <span class="st">'High'</span>][<span class="st">'rate'</span>].values</span>
<span id="cb33-1161"><a href="#cb33-1161" aria-hidden="true" tabindex="-1"></a>    low_rate <span class="op">=</span> completeness_stats[completeness_stats[<span class="st">'completeness_tier'</span>] <span class="op">==</span> <span class="st">'Low'</span>][<span class="st">'rate'</span>].values</span>
<span id="cb33-1162"><a href="#cb33-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1163"><a href="#cb33-1163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(high_rate) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="bu">len</span>(low_rate) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb33-1164"><a href="#cb33-1164" aria-hidden="true" tabindex="-1"></a>        lift <span class="op">=</span> high_rate[<span class="dv">0</span>] <span class="op">/</span> low_rate[<span class="dv">0</span>] <span class="cf">if</span> low_rate[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb33-1165"><a href="#cb33-1165" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📊 INSIGHT: High completeness records convert </span><span class="sc">{</span>lift<span class="sc">:.1f}</span><span class="ss">x vs Low completeness"</span>)</span>
<span id="cb33-1166"><a href="#cb33-1166" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lift <span class="op">&gt;</span> <span class="fl">1.2</span>:</span>
<span id="cb33-1167"><a href="#cb33-1167" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"   → RECOMMENDATION: Prioritize leads with complete CRM data"</span>)</span>
<span id="cb33-1168"><a href="#cb33-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1169"><a href="#cb33-1169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> completeness_stats</span>
<span id="cb33-1170"><a href="#cb33-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1171"><a href="#cb33-1171" aria-hidden="true" tabindex="-1"></a>completeness_stats <span class="op">=</span> analyze_completeness(df, <span class="st">'Mx'</span>)</span>
<span id="cb33-1172"><a href="#cb33-1172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1173"><a href="#cb33-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1174"><a href="#cb33-1174" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb33-1175"><a href="#cb33-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1176"><a href="#cb33-1176" aria-hidden="true" tabindex="-1"></a><span class="fu"># Phase 6: Executive Summary &amp; Export</span></span>
<span id="cb33-1177"><a href="#cb33-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1180"><a href="#cb33-1180" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-1181"><a href="#cb33-1181" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: summary</span></span>
<span id="cb33-1182"><a href="#cb33-1182" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Generate executive summary"</span></span>
<span id="cb33-1183"><a href="#cb33-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1184"><a href="#cb33-1184" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_executive_summary(df):</span>
<span id="cb33-1185"><a href="#cb33-1185" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-1186"><a href="#cb33-1186" aria-hidden="true" tabindex="-1"></a><span class="co">    The one-page summary for the C-Suite.</span></span>
<span id="cb33-1187"><a href="#cb33-1187" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-1188"><a href="#cb33-1188" aria-hidden="true" tabindex="-1"></a>    df_mx <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>]</span>
<span id="cb33-1189"><a href="#cb33-1189" aria-hidden="true" tabindex="-1"></a>    df_qx <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Qx'</span>]</span>
<span id="cb33-1190"><a href="#cb33-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1191"><a href="#cb33-1191" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-1192"><a href="#cb33-1192" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"EXECUTIVE SUMMARY: MX PERFORMANCE OPTIMIZATION"</span>)</span>
<span id="cb33-1193"><a href="#cb33-1193" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-1194"><a href="#cb33-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1195"><a href="#cb33-1195" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"""</span></span>
<span id="cb33-1196"><a href="#cb33-1196" aria-hidden="true" tabindex="-1"></a><span class="ss">╔══════════════════════════════════════════════════════════════════════╗</span></span>
<span id="cb33-1197"><a href="#cb33-1197" aria-hidden="true" tabindex="-1"></a><span class="ss">║                        THE PERFORMANCE GAP                           ║</span></span>
<span id="cb33-1198"><a href="#cb33-1198" aria-hidden="true" tabindex="-1"></a><span class="ss">╠══════════════════════════════════════════════════════════════════════╣</span></span>
<span id="cb33-1199"><a href="#cb33-1199" aria-hidden="true" tabindex="-1"></a><span class="ss">║  Mx Conversion:  </span><span class="sc">{</span>df_mx[<span class="st">'is_success'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">  (n=</span><span class="sc">{</span><span class="bu">len</span>(df_mx)<span class="sc">:,}</span><span class="ss">)</span></span>
<span id="cb33-1200"><a href="#cb33-1200" aria-hidden="true" tabindex="-1"></a><span class="ss">║  Qx Conversion:  </span><span class="sc">{</span>df_qx[<span class="st">'is_success'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">  (n=</span><span class="sc">{</span><span class="bu">len</span>(df_qx)<span class="sc">:,}</span><span class="ss">)</span></span>
<span id="cb33-1201"><a href="#cb33-1201" aria-hidden="true" tabindex="-1"></a><span class="ss">║  Gap:            </span><span class="sc">{</span>df_qx[<span class="st">'is_success'</span>]<span class="sc">.</span>mean() <span class="op">-</span> df_mx[<span class="st">'is_success'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss"> points</span></span>
<span id="cb33-1202"><a href="#cb33-1202" aria-hidden="true" tabindex="-1"></a><span class="ss">╚══════════════════════════════════════════════════════════════════════╝</span></span>
<span id="cb33-1203"><a href="#cb33-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1204"><a href="#cb33-1204" aria-hidden="true" tabindex="-1"></a><span class="ss">KEY FINDINGS:</span></span>
<span id="cb33-1205"><a href="#cb33-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1206"><a href="#cb33-1206" aria-hidden="true" tabindex="-1"></a><span class="ss">1. VELOCITY PROBLEM</span></span>
<span id="cb33-1207"><a href="#cb33-1207" aria-hidden="true" tabindex="-1"></a><span class="ss">   Mx leads stall longer in the pipeline → Need faster SLAs</span></span>
<span id="cb33-1208"><a href="#cb33-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1209"><a href="#cb33-1209" aria-hidden="true" tabindex="-1"></a><span class="ss">2. GOLDEN SEGMENT (Power Trio)</span></span>
<span id="cb33-1210"><a href="#cb33-1210" aria-hidden="true" tabindex="-1"></a><span class="ss">   Directors + Pharma + In-House → Highest Mx conversion</span></span>
<span id="cb33-1211"><a href="#cb33-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1212"><a href="#cb33-1212" aria-hidden="true" tabindex="-1"></a><span class="ss">3. POWER MODIFIERS</span></span>
<span id="cb33-1213"><a href="#cb33-1213" aria-hidden="true" tabindex="-1"></a><span class="ss">   "Global" titles → 2x+ conversion lift vs "Site" titles</span></span>
<span id="cb33-1214"><a href="#cb33-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1215"><a href="#cb33-1215" aria-hidden="true" tabindex="-1"></a><span class="ss">4. ZOMBIE OPPORTUNITY</span></span>
<span id="cb33-1216"><a href="#cb33-1216" aria-hidden="true" tabindex="-1"></a><span class="ss">   </span><span class="sc">{</span><span class="bu">len</span>(df_mx[df_mx[<span class="st">'outcome_tier'</span>]<span class="op">==</span><span class="st">'Near-Miss'</span>])<span class="sc">:,}</span><span class="ss"> recycled Mx leads → Nurture campaign targets</span></span>
<span id="cb33-1217"><a href="#cb33-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1218"><a href="#cb33-1218" aria-hidden="true" tabindex="-1"></a><span class="ss">5. DATA QUALITY SIGNAL</span></span>
<span id="cb33-1219"><a href="#cb33-1219" aria-hidden="true" tabindex="-1"></a><span class="ss">   High completeness records convert better → Prioritize clean data</span></span>
<span id="cb33-1220"><a href="#cb33-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1221"><a href="#cb33-1221" aria-hidden="true" tabindex="-1"></a><span class="ss">RECOMMENDED ACTIONS:</span></span>
<span id="cb33-1222"><a href="#cb33-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1223"><a href="#cb33-1223" aria-hidden="true" tabindex="-1"></a><span class="ss">✓ Target: Directors/VPs with Global scope in Pharma/In-House</span></span>
<span id="cb33-1224"><a href="#cb33-1224" aria-hidden="true" tabindex="-1"></a><span class="ss">✓ Avoid: ICs, Site-level roles, Unknown industries</span></span>
<span id="cb33-1225"><a href="#cb33-1225" aria-hidden="true" tabindex="-1"></a><span class="ss">✓ Speed: Implement 24-hour SLA for Mx leads</span></span>
<span id="cb33-1226"><a href="#cb33-1226" aria-hidden="true" tabindex="-1"></a><span class="ss">✓ Nurture: Build re-engagement campaign for recycled leads</span></span>
<span id="cb33-1227"><a href="#cb33-1227" aria-hidden="true" tabindex="-1"></a><span class="ss">✓ Data: Prioritize leads with complete CRM records</span></span>
<span id="cb33-1228"><a href="#cb33-1228" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span>)</span>
<span id="cb33-1229"><a href="#cb33-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1230"><a href="#cb33-1230" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb33-1231"><a href="#cb33-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1232"><a href="#cb33-1232" aria-hidden="true" tabindex="-1"></a>generate_executive_summary(df)</span>
<span id="cb33-1233"><a href="#cb33-1233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1234"><a href="#cb33-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1235"><a href="#cb33-1235" aria-hidden="true" tabindex="-1"></a><span class="fu">## 6.1 Export Enriched Dataset</span></span>
<span id="cb33-1236"><a href="#cb33-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1239"><a href="#cb33-1239" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb33-1240"><a href="#cb33-1240" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: export</span></span>
<span id="cb33-1241"><a href="#cb33-1241" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb33-1242"><a href="#cb33-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1243"><a href="#cb33-1243" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> export_enriched_dataset(df):</span>
<span id="cb33-1244"><a href="#cb33-1244" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-1245"><a href="#cb33-1245" aria-hidden="true" tabindex="-1"></a><span class="co">    Export the competition-grade enriched dataset for modeling.</span></span>
<span id="cb33-1246"><a href="#cb33-1246" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-1247"><a href="#cb33-1247" aria-hidden="true" tabindex="-1"></a>    export_cols <span class="op">=</span> [</span>
<span id="cb33-1248"><a href="#cb33-1248" aria-hidden="true" tabindex="-1"></a>        <span class="co"># IDs</span></span>
<span id="cb33-1249"><a href="#cb33-1249" aria-hidden="true" tabindex="-1"></a>        <span class="st">'qal_id'</span>, <span class="st">'contact_lead_id'</span>,</span>
<span id="cb33-1250"><a href="#cb33-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1251"><a href="#cb33-1251" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Target</span></span>
<span id="cb33-1252"><a href="#cb33-1252" aria-hidden="true" tabindex="-1"></a>        <span class="st">'is_success'</span>, <span class="st">'outcome_tier'</span>, <span class="st">'next_stage__c'</span>,</span>
<span id="cb33-1253"><a href="#cb33-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1254"><a href="#cb33-1254" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Product</span></span>
<span id="cb33-1255"><a href="#cb33-1255" aria-hidden="true" tabindex="-1"></a>        <span class="st">'product_segment'</span>, <span class="st">'solution_rollup'</span>,</span>
<span id="cb33-1256"><a href="#cb33-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1257"><a href="#cb33-1257" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Account attributes</span></span>
<span id="cb33-1258"><a href="#cb33-1258" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acct_target_industry'</span>, <span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb33-1259"><a href="#cb33-1259" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acct_primary_site_function'</span>, <span class="st">'acct_territory_rollup'</span>, <span class="st">'acct_tier_rollup'</span>,</span>
<span id="cb33-1260"><a href="#cb33-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1261"><a href="#cb33-1261" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Title features (engineered)</span></span>
<span id="cb33-1262"><a href="#cb33-1262" aria-hidden="true" tabindex="-1"></a>        <span class="st">'contact_lead_title'</span>, <span class="st">'title_seniority'</span>, <span class="st">'title_function'</span>,</span>
<span id="cb33-1263"><a href="#cb33-1263" aria-hidden="true" tabindex="-1"></a>        <span class="st">'title_scope'</span>, <span class="st">'is_decision_maker'</span>,</span>
<span id="cb33-1264"><a href="#cb33-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1265"><a href="#cb33-1265" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Quality features</span></span>
<span id="cb33-1266"><a href="#cb33-1266" aria-hidden="true" tabindex="-1"></a>        <span class="st">'record_completeness'</span>, <span class="st">'completeness_tier'</span>,</span>
<span id="cb33-1267"><a href="#cb33-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1268"><a href="#cb33-1268" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Lead attributes</span></span>
<span id="cb33-1269"><a href="#cb33-1269" aria-hidden="true" tabindex="-1"></a>        <span class="st">'priority'</span>, <span class="st">'last_tactic_campaign_channel'</span>,</span>
<span id="cb33-1270"><a href="#cb33-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1271"><a href="#cb33-1271" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Temporal</span></span>
<span id="cb33-1272"><a href="#cb33-1272" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cohort_date'</span>, <span class="st">'cohort_year'</span>, <span class="st">'cohort_quarter'</span>, <span class="st">'lead_age_days'</span></span>
<span id="cb33-1273"><a href="#cb33-1273" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb33-1274"><a href="#cb33-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1275"><a href="#cb33-1275" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to existing columns</span></span>
<span id="cb33-1276"><a href="#cb33-1276" aria-hidden="true" tabindex="-1"></a>    export_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> export_cols <span class="cf">if</span> c <span class="kw">in</span> df.columns]</span>
<span id="cb33-1277"><a href="#cb33-1277" aria-hidden="true" tabindex="-1"></a>    df_export <span class="op">=</span> df[export_cols].copy()</span>
<span id="cb33-1278"><a href="#cb33-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1279"><a href="#cb33-1279" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path.cwd() <span class="op">/</span> <span class="st">"Cleaned_QAL_Competition_Grade.csv"</span></span>
<span id="cb33-1280"><a href="#cb33-1280" aria-hidden="true" tabindex="-1"></a>    df_export.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-1281"><a href="#cb33-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1282"><a href="#cb33-1282" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Exported: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-1283"><a href="#cb33-1283" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Rows: </span><span class="sc">{</span><span class="bu">len</span>(df_export)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb33-1284"><a href="#cb33-1284" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Columns: </span><span class="sc">{</span><span class="bu">len</span>(df_export.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-1285"><a href="#cb33-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1286"><a href="#cb33-1286" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_export</span>
<span id="cb33-1287"><a href="#cb33-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1288"><a href="#cb33-1288" aria-hidden="true" tabindex="-1"></a>df_export <span class="op">=</span> export_enriched_dataset(df)</span>
<span id="cb33-1289"><a href="#cb33-1289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb33-1290"><a href="#cb33-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1291"><a href="#cb33-1291" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb33-1292"><a href="#cb33-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1293"><a href="#cb33-1293" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix: Statistical Methodology</span></span>
<span id="cb33-1294"><a href="#cb33-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1295"><a href="#cb33-1295" aria-hidden="true" tabindex="-1"></a>**Bayesian Credible Intervals:** We use Beta-Binomial conjugacy with uninformative priors (α=1, β=1) to estimate conversion rates. This provides more robust uncertainty quantification for small samples compared to frequentist confidence intervals.</span>
<span id="cb33-1296"><a href="#cb33-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1297"><a href="#cb33-1297" aria-hidden="true" tabindex="-1"></a>**Mutual Information:** Feature importance is calculated using Shannon mutual information, which measures the reduction in uncertainty about the target variable given knowledge of each feature.</span>
<span id="cb33-1298"><a href="#cb33-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1299"><a href="#cb33-1299" aria-hidden="true" tabindex="-1"></a>**Decision Tree Interactions:** We use shallow decision trees (depth ≤ 3) as interaction detectors. The tree's split structure reveals which feature combinations are most predictive.</span>
<span id="cb33-1300"><a href="#cb33-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1301"><a href="#cb33-1301" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb33-1302"><a href="#cb33-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1303"><a href="#cb33-1303" aria-hidden="true" tabindex="-1"></a>*Document generated for MSBA Capstone Case Competition - Spring 2026*</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="MSBA Capstone Group 3">
<meta name="dcterms.date" content="2026-01-01">

<title>The Signal in the Noise: MasterControl Strategic EDA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="MasterControl_EDA_Professional_files/libs/clipboard/clipboard.min.js"></script>
<script src="MasterControl_EDA_Professional_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="MasterControl_EDA_Professional_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="MasterControl_EDA_Professional_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="MasterControl_EDA_Professional_files/libs/quarto-html/popper.min.js"></script>
<script src="MasterControl_EDA_Professional_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="MasterControl_EDA_Professional_files/libs/quarto-html/anchor.min.js"></script>
<link href="MasterControl_EDA_Professional_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="MasterControl_EDA_Professional_files/libs/quarto-html/quarto-syntax-highlighting-597958c53c93a607afca12fd375c57ed.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="MasterControl_EDA_Professional_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="MasterControl_EDA_Professional_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="MasterControl_EDA_Professional_files/libs/bootstrap/bootstrap-b7765afd3d55690ea613244cf51af5f6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-business-intelligence-briefing" id="toc-the-business-intelligence-briefing" class="nav-link active" data-scroll-target="#the-business-intelligence-briefing">The Business Intelligence Briefing</a>
  <ul class="collapse">
  <li><a href="#the-client-mastercontrol" id="toc-the-client-mastercontrol" class="nav-link" data-scroll-target="#the-client-mastercontrol">1.1 The Client: MasterControl</a></li>
  <li><a href="#the-tale-of-two-products-the-core-problem" id="toc-the-tale-of-two-products-the-core-problem" class="nav-link" data-scroll-target="#the-tale-of-two-products-the-core-problem">1.2 The “Tale of Two Products” (The Core Problem)</a></li>
  </ul></li>
  <li><a href="#system-architecture" id="toc-system-architecture" class="nav-link" data-scroll-target="#system-architecture">System Architecture</a></li>
  <li><a href="#feature-engineering-the-secret-weapon" id="toc-feature-engineering-the-secret-weapon" class="nav-link" data-scroll-target="#feature-engineering-the-secret-weapon">Feature Engineering (The Secret Weapon)</a>
  <ul class="collapse">
  <li><a href="#the-data-asset" id="toc-the-data-asset" class="nav-link" data-scroll-target="#the-data-asset">3.1 The Data Asset</a></li>
  <li><a href="#the-engineering-strategy" id="toc-the-engineering-strategy" class="nav-link" data-scroll-target="#the-engineering-strategy">3.2 The Engineering Strategy</a></li>
  </ul></li>
  <li><a href="#the-yield-gap-analysis" id="toc-the-yield-gap-analysis" class="nav-link" data-scroll-target="#the-yield-gap-analysis">The Yield Gap Analysis</a>
  <ul class="collapse">
  <li><a href="#quantifying-the-pain" id="toc-quantifying-the-pain" class="nav-link" data-scroll-target="#quantifying-the-pain">4.1 Quantifying the Pain</a></li>
  <li><a href="#the-funnel-visualization" id="toc-the-funnel-visualization" class="nav-link" data-scroll-target="#the-funnel-visualization">4.2 The Funnel Visualization</a></li>
  </ul></li>
  <li><a href="#signal-detection-finding-the-solution" id="toc-signal-detection-finding-the-solution" class="nav-link" data-scroll-target="#signal-detection-finding-the-solution">Signal Detection (Finding the Solution)</a>
  <ul class="collapse">
  <li><a href="#semantic-log-odds-decoding-the-buyers-language" id="toc-semantic-log-odds-decoding-the-buyers-language" class="nav-link" data-scroll-target="#semantic-log-odds-decoding-the-buyers-language">5.1 Semantic Log-Odds (Decoding the “Buyer’s Language”)</a></li>
  <li><a href="#the-magic-quadrant-micro-segment-discovery" id="toc-the-magic-quadrant-micro-segment-discovery" class="nav-link" data-scroll-target="#the-magic-quadrant-micro-segment-discovery">5.2 The “Magic Quadrant” (Micro-Segment Discovery)</a></li>
  <li><a href="#the-power-trio-interaction" id="toc-the-power-trio-interaction" class="nav-link" data-scroll-target="#the-power-trio-interaction">5.3 The “Power Trio” Interaction</a></li>
  <li><a href="#power-scope-analysis-global-vs-site" id="toc-power-scope-analysis-global-vs-site" class="nav-link" data-scroll-target="#power-scope-analysis-global-vs-site">5.4 Power Scope Analysis (Global vs Site)</a></li>
  <li><a href="#pipeline-velocity-analysis" id="toc-pipeline-velocity-analysis" class="nav-link" data-scroll-target="#pipeline-velocity-analysis">5.5 Pipeline Velocity Analysis</a></li>
  <li><a href="#driver-analysis-entropy-scoring" id="toc-driver-analysis-entropy-scoring" class="nav-link" data-scroll-target="#driver-analysis-entropy-scoring">5.6 Driver Analysis (Entropy Scoring)</a></li>
  <li><a href="#decision-tree-algorithmic-segment-discovery" id="toc-decision-tree-algorithmic-segment-discovery" class="nav-link" data-scroll-target="#decision-tree-algorithmic-segment-discovery">5.7 Decision Tree: Algorithmic Segment Discovery</a></li>
  </ul></li>
  <li><a href="#the-zombie-lead-opportunity" id="toc-the-zombie-lead-opportunity" class="nav-link" data-scroll-target="#the-zombie-lead-opportunity">The “Zombie” Lead Opportunity</a></li>
  <li><a href="#executive-summary-dashboard" id="toc-executive-summary-dashboard" class="nav-link" data-scroll-target="#executive-summary-dashboard">Executive Summary Dashboard</a></li>
  <li><a href="#deployment" id="toc-deployment" class="nav-link" data-scroll-target="#deployment">Deployment</a></li>
  <li><a href="#appendix-statistical-methodology" id="toc-appendix-statistical-methodology" class="nav-link" data-scroll-target="#appendix-statistical-methodology">Appendix: Statistical Methodology</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="..\..\..\MasterControl_EDA_Professional.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">The Signal in the Noise: MasterControl Strategic EDA</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">A Masterclass in Identifying the Ideal Customer Profile (ICP) for Mx Expansion</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>MSBA Capstone Group 3 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 1, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="the-business-intelligence-briefing" class="level1">
<h1>The Business Intelligence Briefing</h1>
<section id="the-client-mastercontrol" class="level2">
<h2 class="anchored" data-anchor-id="the-client-mastercontrol">1.1 The Client: MasterControl</h2>
<p>Before analyzing a single row of data, we must understand the engine we are tuning. <strong>MasterControl</strong> is a SaaS provider for the <strong>Life Sciences</strong> industry (Pharmaceuticals, Biotech, and Medical Devices).</p>
<ul>
<li><strong>The Stakes:</strong> These industries are highly regulated by the FDA. One mistake in a manufacturing record can lead to millions in fines or a plant shutdown. MasterControl sells software that digitizes these records to ensure compliance and efficiency.</li>
<li><strong>The Landscape:</strong> They are not selling generic software; they are selling <em>safety and speed</em> to people who make life-saving drugs and devices.</li>
</ul>
</section>
<section id="the-tale-of-two-products-the-core-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-tale-of-two-products-the-core-problem">1.2 The “Tale of Two Products” (The Core Problem)</h2>
<p>This case is defined by the performance gap between two product lines:</p>
<ol type="1">
<li><strong>Qx (Quality Excellence):</strong>
<ul>
<li><em>The Legacy:</em> This is the “Cash Cow.” MasterControl has sold QMS (Quality Management Systems) for 20+ years.</li>
<li><em>The Buyer:</em> Quality Managers (Risk-averse, compliance-focused).</li>
<li><em>Performance:</em> <strong>19.7% Conversion Rate.</strong> The sales motion is a well-oiled machine.</li>
</ul></li>
<li><strong>Mx (Manufacturing Excellence):</strong>
<ul>
<li><em>The Challenger:</em> A newer product (launched ~4 years ago) focused on MES (Manufacturing Execution Systems) – digitizing the shop floor.</li>
<li><em>The Buyer:</em> Operations/Plant Directors (Efficiency-focused).</li>
<li><em>The Problem:</em> <strong>12.7% Conversion Rate.</strong> It is underperforming Qx by <strong>~55%</strong>.</li>
</ul></li>
</ol>
<p><strong>Our Mission:</strong> The data suggests MasterControl is trying to sell Mx to the <em>wrong people</em> (Quality Managers) at the <em>wrong companies</em>. We must identify the <strong>Ideal Customer Profile (ICP)</strong>—the specific combination of <strong>Job Title</strong>, <strong>Industry</strong>, and <strong>Manufacturing Model</strong>—that actually buys Mx.</p>
<hr>
</section>
</section>
<section id="system-architecture" class="level1">
<h1>System Architecture</h1>
<p>We begin by initializing a “Competition-Grade” environment. We use a specific color palette (<code>#00534B</code> Teal vs <code>#F05627</code> Orange) to visually reinforce the “Success vs Failure” binary in every chart.</p>
<div id="setup" class="cell" data-message="false" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># CORE ARCHITECTURE</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> beta, mannwhitneyu</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> mutual_info_classif</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier, plot_tree</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># --- THE PSYCHOLOGICAL PALETTE ---</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># In our visuals, Teal always represents the GOAL (Success/Mx).</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Orange always represents the PROBLEM (Failure/Gap/Qx Benchmark).</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>PROJECT_COLS <span class="op">=</span> {</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Success'</span>: <span class="st">'#00534B'</span>,  <span class="co"># MasterControl Teal</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Failure'</span>: <span class="st">'#F05627'</span>,  <span class="co"># Risk Orange</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Neutral'</span>: <span class="st">'#95a5a6'</span>,  <span class="co"># Gray for noise</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Mx'</span>: <span class="st">'#00534B'</span>,       <span class="co"># Focus Product</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Qx'</span>: <span class="st">'#F05627'</span>,       <span class="co"># Benchmark Product</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Highlight'</span>: <span class="st">'#2980b9'</span> <span class="co"># Blue for emphasis</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical thresholds</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>ALPHA <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>MIN_SAMPLE_SIZE <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>BAYESIAN_PRIOR_ALPHA <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>BAYESIAN_PRIOR_BETA <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting configuration</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"whitegrid"</span>, context<span class="op">=</span><span class="st">"talk"</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">14</span>, <span class="dv">8</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'sans-serif'</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.titleweight'</span>] <span class="op">=</span> <span class="st">'bold'</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ System Initialized: Data Science Environment Active"</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Visual Strategy: Success=</span><span class="sc">{</span>PROJECT_COLS[<span class="st">'Success'</span>]<span class="sc">}</span><span class="ss"> | Failure=</span><span class="sc">{</span>PROJECT_COLS[<span class="st">'Failure'</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ System Initialized: Data Science Environment Active
✓ Visual Strategy: Success=#00534B | Failure=#F05627</code></pre>
</div>
</div>
<hr>
</section>
<section id="feature-engineering-the-secret-weapon" class="level1">
<h1>Feature Engineering (The Secret Weapon)</h1>
<section id="the-data-asset" class="level2">
<h2 class="anchored" data-anchor-id="the-data-asset">3.1 The Data Asset</h2>
<p>We are analyzing <strong>16,644 Qualified Leads (QALs)</strong> from 2024-2025.</p>
<ul>
<li><strong>Target Variable:</strong> <code>next_stage__c</code>. Did the lead die (“Recycled”) or progress to a sales opportunity (“SQL/SQO/Won”)?</li>
<li><strong>The Hidden Gold:</strong> The <code>contact/lead title</code> column contains 4,000+ unstructured text strings (e.g., “Sr.&nbsp;Mgr of Quality &amp; Ops”).</li>
</ul>
</section>
<section id="the-engineering-strategy" class="level2">
<h2 class="anchored" data-anchor-id="the-engineering-strategy">3.2 The Engineering Strategy</h2>
<p>Most teams will simply drop the messy text columns. <strong>We will win by mining them.</strong> We define custom functions to extract structured signals from the chaos:</p>
<ol type="1">
<li><strong>The Authority Parser:</strong> Extracts <em>Seniority</em> (VP vs.&nbsp;Manager). Hypothesis: Mx requires higher budget authority than Qx, so VPs should convert better.</li>
<li><strong>The Domain Parser:</strong> Extracts <em>Function</em> (Quality vs.&nbsp;Ops). Hypothesis: “Operations” titles will drive Mx success, while “Quality” titles drive Qx success.</li>
<li><strong>The Scope Parser:</strong> Extracts <em>Power Modifiers</em> (Global vs.&nbsp;Site). Hypothesis: “Global” roles have more budget authority.</li>
</ol>
<div id="data-pipeline" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># THE DATA PIPELINE</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bayesian_conversion_rate(successes, n, alpha<span class="op">=</span>BAYESIAN_PRIOR_ALPHA, beta_param<span class="op">=</span>BAYESIAN_PRIOR_BETA):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Bayesian credible interval using Beta-Binomial conjugacy.</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns: (posterior_mean, ci_low, ci_high)</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    post_alpha <span class="op">=</span> alpha <span class="op">+</span> successes</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    post_beta <span class="op">=</span> beta_param <span class="op">+</span> (n <span class="op">-</span> successes)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> post_alpha <span class="op">/</span> (post_alpha <span class="op">+</span> post_beta)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    ci_low <span class="op">=</span> beta.ppf(<span class="fl">0.025</span>, post_alpha, post_beta)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    ci_high <span class="op">=</span> beta.ppf(<span class="fl">0.975</span>, post_alpha, post_beta)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean, ci_low, ci_high</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_and_engineer(filepath<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">    Transforms raw CRM data into high-octane signals.</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. ROBUST LOADING --------------------------------------------------------</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filepath <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        possible_paths <span class="op">=</span> [</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            Path.cwd() <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            Path.cwd().parent <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span>,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>            Path.cwd().parent.parent <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span>,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>            Path.cwd().parent.parent.parent <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> possible_paths:</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> p.exists():</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>                filepath <span class="op">=</span> p</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filepath <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        filepath <span class="op">=</span> Path(<span class="st">"QAL Performance for MSBA.csv"</span>)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> filepath.exists():</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="st">"Warning: Data file not found. Please ensure 'QAL Performance for MSBA.csv' is in the data folder."</span>)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>         <span class="cf">return</span> pd.DataFrame()</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(filepath)</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardize Headers</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [c.strip().lower().replace(<span class="st">' '</span>, <span class="st">'_'</span>).replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">'-'</span>, <span class="st">'_'</span>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> c <span class="kw">in</span> df.columns]</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. TARGET DEFINITION -----------------------------------------------------</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    success_stages <span class="op">=</span> [<span class="st">'SQL'</span>, <span class="st">'SQO'</span>, <span class="st">'Won'</span>]</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'is_success'</span>] <span class="op">=</span> df[<span class="st">'next_stage__c'</span>].isin(success_stages).astype(<span class="bu">int</span>)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Outcome Tiers (for Near-Miss Analysis)</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> classify_outcome(stage):</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> stage <span class="kw">in</span> [<span class="st">'SQL'</span>, <span class="st">'SQO'</span>, <span class="st">'Won'</span>]:</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Success'</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> stage <span class="op">==</span> <span class="st">'Recycled'</span>:</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Near-Miss'</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Lost'</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'outcome_tier'</span>] <span class="op">=</span> df[<span class="st">'next_stage__c'</span>].<span class="bu">apply</span>(classify_outcome)</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. PRODUCT SEGMENTATION --------------------------------------------------</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> segment_product(sol):</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">str</span>(sol) <span class="op">==</span> <span class="st">'Mx'</span>: <span class="cf">return</span> <span class="st">'Mx'</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">str</span>(sol) <span class="op">==</span> <span class="st">'Qx'</span>: <span class="cf">return</span> <span class="st">'Qx'</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'product_segment'</span>] <span class="op">=</span> df[<span class="st">'solution_rollup'</span>].<span class="bu">apply</span>(segment_product)</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. TITLE PARSING (The Alpha Feature) -------------------------------------</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_seniority(t):</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(t): <span class="cf">return</span> <span class="st">'Unknown'</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">str</span>(t).lower()</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">ceo</span><span class="cf">|</span><span class="vs">cfo</span><span class="cf">|</span><span class="vs">coo</span><span class="cf">|</span><span class="vs">cto</span><span class="cf">|</span><span class="vs">cio</span><span class="cf">|</span><span class="vs">chief</span><span class="cf">|</span><span class="vs">c-level</span><span class="cf">|</span><span class="vs">president</span><span class="cf">|</span><span class="vs">founder</span><span class="cf">|</span><span class="vs">owner</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'C-Suite'</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">svp</span><span class="cf">|</span><span class="vs">senior vice president</span><span class="cf">|</span><span class="vs">evp</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'SVP'</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">vp</span><span class="cf">|</span><span class="vs">vice president</span><span class="cf">|</span><span class="vs">head of</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'VP/Head'</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">director</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Director'</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">manager</span><span class="cf">|</span><span class="vs">mgr</span><span class="cf">|</span><span class="vs">lead</span><span class="cf">|</span><span class="vs">supervisor</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Manager'</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">analyst</span><span class="cf">|</span><span class="vs">engineer</span><span class="cf">|</span><span class="vs">specialist</span><span class="cf">|</span><span class="vs">associate</span><span class="cf">|</span><span class="vs">coordinator</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'IC'</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_function(t):</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(t): <span class="cf">return</span> <span class="st">'Unknown'</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">str</span>(t).lower()</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">manuf</span><span class="cf">|</span><span class="vs">prod</span><span class="cf">|</span><span class="vs">ops</span><span class="cf">|</span><span class="vs">plant</span><span class="cf">|</span><span class="vs">supply</span><span class="cf">|</span><span class="vs">site</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Manufacturing/Ops'</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">quality</span><span class="cf">|</span><span class="vs">qa</span><span class="cf">|</span><span class="vs">qc</span><span class="cf">|</span><span class="vs">qms</span><span class="cf">|</span><span class="vs">compliance</span><span class="cf">|</span><span class="vs">validation</span><span class="cf">|</span><span class="vs">capa</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Quality/Reg'</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">regulatory</span><span class="cf">|</span><span class="vs">reg affairs</span><span class="cf">|</span><span class="vs">submissions</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Regulatory'</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">it</span><span class="cf">|</span><span class="vs">info</span><span class="cf">|</span><span class="vs">sys</span><span class="cf">|</span><span class="vs">tech</span><span class="cf">|</span><span class="vs">data</span><span class="cf">|</span><span class="vs">soft</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'IT/Systems'</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">lab</span><span class="cf">|</span><span class="vs">r&amp;d</span><span class="cf">|</span><span class="vs">sci</span><span class="cf">|</span><span class="vs">dev</span><span class="cf">|</span><span class="vs">clin</span><span class="cf">|</span><span class="vs">research</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'R&amp;D/Lab'</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">project</span><span class="cf">|</span><span class="vs">program</span><span class="cf">|</span><span class="vs">pmo</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'PMO'</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_scope(t):</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(t): <span class="cf">return</span> <span class="st">'Standard'</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">str</span>(t).lower()</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">global</span><span class="cf">|</span><span class="vs">worldwide</span><span class="cf">|</span><span class="vs">international</span><span class="cf">|</span><span class="vs">corporate</span><span class="cf">|</span><span class="vs">enterprise</span><span class="cf">|</span><span class="vs">group</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Global'</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">regional</span><span class="cf">|</span><span class="vs">division</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Regional'</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">site</span><span class="cf">|</span><span class="vs">plant</span><span class="cf">|</span><span class="vs">facility</span><span class="cf">|</span><span class="vs">local</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Site'</span></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Standard'</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'title_seniority'</span>] <span class="op">=</span> df[<span class="st">'contact_lead_title'</span>].<span class="bu">apply</span>(parse_seniority)</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'title_function'</span>] <span class="op">=</span> df[<span class="st">'contact_lead_title'</span>].<span class="bu">apply</span>(parse_function)</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'title_scope'</span>] <span class="op">=</span> df[<span class="st">'contact_lead_title'</span>].<span class="bu">apply</span>(parse_scope)</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'is_decision_maker'</span>] <span class="op">=</span> df[<span class="st">'title_seniority'</span>].isin([<span class="st">'C-Suite'</span>, <span class="st">'SVP'</span>, <span class="st">'VP/Head'</span>, <span class="st">'Director'</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. RECORD COMPLETENESS (Buyer Seriousness Proxy) -------------------------</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>    completeness_cols <span class="op">=</span> [<span class="st">'acct_manufacturing_model'</span>, <span class="st">'acct_primary_site_function'</span>,</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'acct_target_industry'</span>, <span class="st">'acct_territory_rollup'</span>, <span class="st">'acct_tier_rollup'</span>]</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calc_completeness(row):</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>        filled <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> col <span class="kw">in</span> completeness_cols</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">if</span> col <span class="kw">in</span> row.index <span class="kw">and</span> pd.notna(row[col]) <span class="kw">and</span> <span class="bu">str</span>(row[col]) <span class="op">!=</span> <span class="st">'Unknown'</span>)</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> filled <span class="op">/</span> <span class="bu">len</span>(completeness_cols)</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'record_completeness'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(calc_completeness, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'completeness_tier'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'record_completeness'</span>],</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>                                      bins<span class="op">=</span>[<span class="op">-</span><span class="fl">0.01</span>, <span class="fl">0.4</span>, <span class="fl">0.8</span>, <span class="fl">1.01</span>],</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>                                      labels<span class="op">=</span>[<span class="st">'Low'</span>, <span class="st">'Medium'</span>, <span class="st">'High'</span>])</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 6. TEMPORAL FEATURES -----------------------------------------------------</span></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'qal_cohort_date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_year'</span>] <span class="op">=</span> df[<span class="st">'cohort_date'</span>].dt.year</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_quarter'</span>] <span class="op">=</span> df[<span class="st">'cohort_date'</span>].dt.to_period(<span class="st">'Q'</span>).astype(<span class="bu">str</span>)</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>    max_date <span class="op">=</span> df[<span class="st">'cohort_date'</span>].<span class="bu">max</span>()</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lead_age_days'</span>] <span class="op">=</span> (max_date <span class="op">-</span> df[<span class="st">'cohort_date'</span>]).dt.days</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 7. STRATEGIC IMPUTATION --------------------------------------------------</span></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>    cols_to_fill <span class="op">=</span> [<span class="st">'acct_manufacturing_model'</span>, <span class="st">'acct_primary_site_function'</span>,</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'acct_target_industry'</span>, <span class="st">'acct_territory_rollup'</span>]</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> cols_to_fill:</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> c <span class="kw">in</span> df.columns:</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>            df[c] <span class="op">=</span> df[c].fillna(<span class="st">'Unknown'</span>)</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"DATA PIPELINE COMPLETE"</span>)</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Total Rows: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Target Rate (is_success): </span><span class="sc">{</span>df[<span class="st">'is_success'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Mx Leads: </span><span class="sc">{</span><span class="bu">len</span>(df[df[<span class="st">'product_segment'</span>]<span class="op">==</span><span class="st">'Mx'</span>])<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Qx Leads: </span><span class="sc">{</span><span class="bu">len</span>(df[df[<span class="st">'product_segment'</span>]<span class="op">==</span><span class="st">'Qx'</span>])<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Near-Miss (Recycled): </span><span class="sc">{</span><span class="bu">len</span>(df[df[<span class="st">'outcome_tier'</span>]<span class="op">==</span><span class="st">'Near-Miss'</span>])<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Decision Makers: </span><span class="sc">{</span>df[<span class="st">'is_decision_maker'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span>df[<span class="st">'is_decision_maker'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute Pipeline</span></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> clean_and_engineer()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
DATA PIPELINE COMPLETE
======================================================================
✓ Total Rows: 16,815
✓ Target Rate (is_success): 17.9%
✓ Mx Leads: 4,239
✓ Qx Leads: 12,547
✓ Near-Miss (Recycled): 12,067
✓ Decision Makers: 3,138 (18.7%)
======================================================================</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="the-yield-gap-analysis" class="level1">
<h1>The Yield Gap Analysis</h1>
<section id="quantifying-the-pain" class="level2">
<h2 class="anchored" data-anchor-id="quantifying-the-pain">4.1 Quantifying the Pain</h2>
<p>Before providing a solution, we must quantify the problem. The chart below is the “Money Slide.” It proves that for every 100 leads:</p>
<ul>
<li><strong>Qx</strong> generates ~20 opportunities.</li>
<li><strong>Mx</strong> generates ~12 opportunities.</li>
</ul>
<p>That gap represents millions in wasted marketing spend and lost revenue.</p>
<div id="cell-gap-analysis" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_performance_gap(df):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    df_main <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_main) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate stats with Bayesian CIs</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> product <span class="kw">in</span> [<span class="st">'Mx'</span>, <span class="st">'Qx'</span>]:</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        subset <span class="op">=</span> df_main[df_main[<span class="st">'product_segment'</span>] <span class="op">==</span> product]</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(subset)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        successes <span class="op">=</span> subset[<span class="st">'is_success'</span>].<span class="bu">sum</span>()</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        rate, ci_low, ci_high <span class="op">=</span> bayesian_conversion_rate(successes, n)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        results.append({</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'product'</span>: product,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'n'</span>: n,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'successes'</span>: successes,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'rate'</span>: rate,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ci_low'</span>: ci_low,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ci_high'</span>: ci_high</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create visualization</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LEFT: Bar chart with CIs</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Mx'</span>], PROJECT_COLS[<span class="st">'Qx'</span>]]</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax1.bar(results_df[<span class="st">'product'</span>], results_df[<span class="st">'rate'</span>], color<span class="op">=</span>colors,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>                   edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, width<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> results_df.iterrows():</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        ax1.errorbar(i, row[<span class="st">'rate'</span>],</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>                    yerr<span class="op">=</span>[[row[<span class="st">'rate'</span>] <span class="op">-</span> row[<span class="st">'ci_low'</span>]], [row[<span class="st">'ci_high'</span>] <span class="op">-</span> row[<span class="st">'rate'</span>]]],</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>                    fmt<span class="op">=</span><span class="st">'none'</span>, color<span class="op">=</span><span class="st">'black'</span>, capsize<span class="op">=</span><span class="dv">12</span>, capthick<span class="op">=</span><span class="dv">2</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        ax1.text(i, row[<span class="st">'rate'</span>] <span class="op">+</span> <span class="fl">0.025</span>, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'rate'</span>]<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        ax1.text(i, row[<span class="st">'ci_low'</span>] <span class="op">-</span> <span class="fl">0.015</span>, <span class="ss">f"n=</span><span class="sc">{</span>row[<span class="st">'n'</span>]<span class="sc">:,}</span><span class="ss">"</span>,</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'top'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Conversion Rate (Lead → SQL+)'</span>, fontsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'The Yield Gap: Mx vs Qx Performance</span><span class="ch">\n</span><span class="st">(with 95% Bayesian Credible Intervals)'</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>                  fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylim(<span class="dv">0</span>, <span class="fl">0.30</span>)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    ax1.axhline(y<span class="op">=</span>df_main[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    ax1.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RIGHT: Waterfall showing the gap</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    mx_rate <span class="op">=</span> results_df[results_df[<span class="st">'product'</span>]<span class="op">==</span><span class="st">'Mx'</span>][<span class="st">'rate'</span>].values[<span class="dv">0</span>]</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    qx_rate <span class="op">=</span> results_df[results_df[<span class="st">'product'</span>]<span class="op">==</span><span class="st">'Qx'</span>][<span class="st">'rate'</span>].values[<span class="dv">0</span>]</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    gap <span class="op">=</span> qx_rate <span class="op">-</span> mx_rate</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    waterfall_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">'label'</span>: [<span class="st">'Qx Baseline'</span>, <span class="st">'Performance Gap'</span>, <span class="st">'Mx Current'</span>],</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">'value'</span>: [qx_rate, <span class="op">-</span>gap, mx_rate],</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">'color'</span>: [PROJECT_COLS[<span class="st">'Qx'</span>], PROJECT_COLS[<span class="st">'Failure'</span>], PROJECT_COLS[<span class="st">'Mx'</span>]]</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    ax2.bar(waterfall_data[<span class="st">'label'</span>], waterfall_data[<span class="st">'value'</span>], color<span class="op">=</span>waterfall_data[<span class="st">'color'</span>])</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    ax2.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Conversion Rate'</span>, fontsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="ss">f'The </span><span class="sc">{</span>gap<span class="sc">:.1%}</span><span class="ss"> Performance Gap</span><span class="ch">\n</span><span class="ss">(Revenue Opportunity)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylim(<span class="dv">0</span>, <span class="fl">0.25</span>)</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add annotation</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    ax2.annotate(<span class="ss">f'GAP:</span><span class="ch">\n</span><span class="sc">{</span>gap<span class="sc">:.1%}</span><span class="ss">'</span>, xy<span class="op">=</span>(<span class="dv">1</span>, <span class="fl">0.05</span>), fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>,</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, color<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>                bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'round'</span>, facecolor<span class="op">=</span>PROJECT_COLS[<span class="st">'Failure'</span>], alpha<span class="op">=</span><span class="fl">0.8</span>))</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">⚠️  PERFORMANCE GAP: </span><span class="sc">{</span>gap<span class="sc">:.1%}</span><span class="ss"> points"</span>)</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Mx: </span><span class="sc">{</span>mx_rate<span class="sc">:.1%}</span><span class="ss"> | Qx: </span><span class="sc">{</span>qx_rate<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Mx performs </span><span class="sc">{</span>(<span class="dv">1</span> <span class="op">-</span> mx_rate<span class="op">/</span>qx_rate)<span class="op">*</span><span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">% worse relative to Qx"</span>)</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>    plot_performance_gap(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div id="gap-analysis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/gap-analysis-output-1.png" width="1505" height="542" class="figure-img"></p>
<figcaption>The Yield Gap: Mx trails Qx by ~7 percentage points. Closing this gap is the primary objective.</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
⚠️  PERFORMANCE GAP: 7.1% points
   Mx: 12.6% | Qx: 19.7%
   Mx performs 36% worse relative to Qx</code></pre>
</div>
</div>
</section>
<section id="the-funnel-visualization" class="level2">
<h2 class="anchored" data-anchor-id="the-funnel-visualization">4.2 The Funnel Visualization</h2>
<p>Let’s see where leads are falling off in the pipeline.</p>
<div id="cell-funnel-viz" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_funnel_analysis(df):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    df_products <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_products) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LEFT: Stage distribution by product</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    stage_dist <span class="op">=</span> df_products.groupby([<span class="st">'product_segment'</span>, <span class="st">'next_stage__c'</span>]).size().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    stage_dist_pct <span class="op">=</span> stage_dist.div(stage_dist.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    stage_dist_pct.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax1,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                        colormap<span class="op">=</span><span class="st">'RdYlGn'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Percentage of Leads'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">''</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'Lead Outcome Distribution by Product'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    ax1.legend(title<span class="op">=</span><span class="st">'Stage'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    ax1.set_xticklabels(ax1.get_xticklabels(), rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RIGHT: Outcome Tier comparison (simplified view)</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    outcome_dist <span class="op">=</span> df_products.groupby([<span class="st">'product_segment'</span>, <span class="st">'outcome_tier'</span>]).size().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    outcome_dist <span class="op">=</span> outcome_dist[[<span class="st">'Lost'</span>, <span class="st">'Near-Miss'</span>, <span class="st">'Success'</span>]]  <span class="co"># Order matters</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    outcome_dist_pct <span class="op">=</span> outcome_dist.div(outcome_dist.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.arange(<span class="bu">len</span>(outcome_dist_pct.index))</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> <span class="fl">0.25</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Failure'</span>], PROJECT_COLS[<span class="st">'Neutral'</span>], PROJECT_COLS[<span class="st">'Success'</span>]]</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (col, color) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(outcome_dist_pct.columns, colors)):</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        ax2.bar(x <span class="op">+</span> i<span class="op">*</span>width, outcome_dist_pct[col], width, label<span class="op">=</span>col, color<span class="op">=</span>color)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, val <span class="kw">in</span> <span class="bu">enumerate</span>(outcome_dist_pct[col]):</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>            ax2.text(x[j] <span class="op">+</span> i<span class="op">*</span>width, val <span class="op">+</span> <span class="dv">1</span>, <span class="ss">f'</span><span class="sc">{</span>val<span class="sc">:.0f}</span><span class="ss">%'</span>, ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Percentage'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    ax2.set_xticks(x <span class="op">+</span> width)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    ax2.set_xticklabels(outcome_dist_pct.index)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'Outcome Tiers: Success vs Near-Miss vs Lost'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    ax2.legend()</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylim(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    plot_funnel_analysis(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div id="funnel-viz" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/funnel-viz-output-1.png" width="1503" height="543" class="figure-img"></p>
<figcaption>The Pipeline Funnel: Visualizing where leads go in the sales process.</figcaption>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="signal-detection-finding-the-solution" class="level1">
<h1>Signal Detection (Finding the Solution)</h1>
<section id="semantic-log-odds-decoding-the-buyers-language" class="level2">
<h2 class="anchored" data-anchor-id="semantic-log-odds-decoding-the-buyers-language">5.1 Semantic Log-Odds (Decoding the “Buyer’s Language”)</h2>
<p>We use a technique called <strong>Log-Odds Ratio Analysis</strong>.</p>
<ul>
<li><strong>Concept:</strong> We treat job titles as a “Bag of Words.” We count how often “Manager” appears in successful leads vs.&nbsp;failed leads.</li>
<li><strong>The Math:</strong> If “Director” appears 5x more often in successful Mx leads than failed ones, it has a high positive log-odds.</li>
<li><strong>The Insight:</strong> This tells us <em>exactly</em> which keywords sales reps should search for on LinkedIn.</li>
</ul>
<div id="cell-nlp-signal" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> semantic_log_odds(df, product_filter<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product_filter].copy()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(subset) <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Vectorize with bigrams for context</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    vec <span class="op">=</span> CountVectorizer(stop_words<span class="op">=</span><span class="st">'english'</span>, min_df<span class="op">=</span><span class="dv">5</span>, ngram_range<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                          token_pattern<span class="op">=</span><span class="vs">r'</span><span class="dv">\b</span><span class="pp">[a-zA-Z]</span><span class="op">{2,}</span><span class="dv">\b</span><span class="vs">'</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> vec.fit_transform(subset[<span class="st">'contact_lead_title'</span>].fillna(<span class="st">''</span>))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    words <span class="op">=</span> np.array(vec.get_feature_names_out())</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate frequencies with Laplace smoothing</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> subset[<span class="st">'is_success'</span>].values</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    x_pos <span class="op">=</span> np.array(X[y<span class="op">==</span><span class="dv">1</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)).flatten() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    x_neg <span class="op">=</span> np.array(X[y<span class="op">==</span><span class="dv">0</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)).flatten() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log-Odds calculation</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    p_pos <span class="op">=</span> x_pos <span class="op">/</span> x_pos.<span class="bu">sum</span>()</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    p_neg <span class="op">=</span> x_neg <span class="op">/</span> x_neg.<span class="bu">sum</span>()</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    log_odds <span class="op">=</span> np.log(p_pos <span class="op">/</span> p_neg)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> pd.DataFrame({</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'word'</span>: words,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'log_odds'</span>: log_odds,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'freq'</span>: x_pos <span class="op">+</span> x_neg <span class="op">-</span> <span class="dv">2</span>,  <span class="co"># Remove smoothing for display</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'n_words'</span>: [<span class="bu">len</span>(w.split()) <span class="cf">for</span> w <span class="kw">in</span> words]</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for significant volume</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> res[res[<span class="st">'freq'</span>] <span class="op">&gt;</span> <span class="dv">25</span>]</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    top_signals <span class="op">=</span> pd.concat([res.nlargest(<span class="dv">12</span>, <span class="st">'log_odds'</span>), res.nsmallest(<span class="dv">12</span>, <span class="st">'log_odds'</span>)])</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    top_signals <span class="op">=</span> top_signals.sort_values(<span class="st">'log_odds'</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>]</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>              <span class="cf">for</span> x <span class="kw">in</span> top_signals[<span class="st">'log_odds'</span>]]</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(top_signals))</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(y_pos, top_signals[<span class="st">'log_odds'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add labels</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (idx, row) <span class="kw">in</span> <span class="bu">enumerate</span>(top_signals.iterrows()):</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'word'</span>]<span class="sc">}</span><span class="ss"> (n=</span><span class="sc">{</span><span class="bu">int</span>(row[<span class="st">'freq'</span>])<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>        x_pos <span class="op">=</span> <span class="fl">0.02</span> <span class="cf">if</span> row[<span class="st">'log_odds'</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="op">-</span><span class="fl">0.02</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        ha <span class="op">=</span> <span class="st">'left'</span> <span class="cf">if</span> row[<span class="st">'log_odds'</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'right'</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        ax.text(x_pos, i, label, va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span>ha, fontsize<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>    ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks([])</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Log-Odds Ratio (→ Higher Conversion | ← Lower Conversion)"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"Semantic Signals for </span><span class="sc">{</span>product_filter<span class="sc">}</span><span class="ss">: The 'Deal Maker' vs. 'Deal Killer' Keywords"</span>,</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>                 fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add legend box</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>    ax.text(<span class="fl">0.98</span>, <span class="fl">0.98</span>, <span class="st">'GREEN = Call These</span><span class="ch">\n</span><span class="st">ORANGE = Avoid These'</span>,</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>            transform<span class="op">=</span>ax.transAxes, fontsize<span class="op">=</span><span class="dv">11</span>, va<span class="op">=</span><span class="st">'top'</span>, ha<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>            bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'round'</span>, facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.9</span>))</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">📞 CALL LIST (Top phrases predicting success):"</span>)</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(res.nlargest(<span class="dv">10</span>, <span class="st">'log_odds'</span>)[[<span class="st">'word'</span>, <span class="st">'log_odds'</span>, <span class="st">'freq'</span>]].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">⛔ AVOID LIST (Phrases predicting failure):"</span>)</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(res.nsmallest(<span class="dv">10</span>, <span class="st">'log_odds'</span>)[[<span class="st">'word'</span>, <span class="st">'log_odds'</span>, <span class="st">'freq'</span>]].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    semantic_results <span class="op">=</span> semantic_log_odds(df, <span class="st">'Mx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div id="nlp-signal" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/nlp-signal-output-1.png" width="1311" height="928" class="figure-img"></p>
<figcaption>The Language of Buyers: Words on the right (Green) predict success. Words on the left (Orange) predict failure.</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
📞 CALL LIST (Top phrases predicting success):
              word  log_odds  freq
               ceo  1.213176    31
   project manager  0.682548    45
        automation  0.587906    29
  process engineer  0.587906    29
   quality manager  0.523368    59
           project  0.512557    80
          research  0.480808    40
        production  0.461264    79
production manager  0.344676    26
      head quality  0.322203    36

⛔ AVOID LIST (Phrases predicting failure):
              word  log_odds  freq
          services -1.939560    35
manager operations -1.513041    47
         executive -1.282780    57
    senior manager -0.895015    80
        validation -0.840948    37
           affairs -0.716895    56
        operations -0.707416   343
 assurance manager -0.691416    32
regulatory affairs -0.596751    50
         associate -0.589633   122</code></pre>
</div>
</div>
</section>
<section id="the-magic-quadrant-micro-segment-discovery" class="level2">
<h2 class="anchored" data-anchor-id="the-magic-quadrant-micro-segment-discovery">5.2 The “Magic Quadrant” (Micro-Segment Discovery)</h2>
<p>A single variable is rarely the answer. We need to find the <strong>Interaction Effects</strong>. This heatmap intersects <strong>Industry</strong> (Rows) with <strong>Manufacturing Model</strong> (Columns).</p>
<ul>
<li><strong>Green Cells:</strong> These are our “Honey Pots.” The specific combinations where Mx conversion skyrockets.</li>
<li><strong>Action:</strong> Marketing should redirect budget <em>exclusively</em> to these green zones.</li>
</ul>
<div id="cell-magic-quadrant" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> interaction_heatmap(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(subset) <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pivot tables</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    pivot_rate <span class="op">=</span> subset.pivot_table(index<span class="op">=</span><span class="st">'acct_target_industry'</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                                    columns<span class="op">=</span><span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                                    values<span class="op">=</span><span class="st">'is_success'</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                                    aggfunc<span class="op">=</span><span class="st">'mean'</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    pivot_n <span class="op">=</span> subset.pivot_table(index<span class="op">=</span><span class="st">'acct_target_industry'</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                                 columns<span class="op">=</span><span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                                 values<span class="op">=</span><span class="st">'is_success'</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                                 aggfunc<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create annotation with rate and n</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    annot <span class="op">=</span> pivot_rate.copy().astype(<span class="bu">str</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> pivot_rate.index:</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> pivot_rate.columns:</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>            rate <span class="op">=</span> pivot_rate.loc[i, j]</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>            n <span class="op">=</span> pivot_n.loc[i, j] <span class="cf">if</span> pd.notna(pivot_n.loc[i, j]) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pd.notna(rate) <span class="kw">and</span> n <span class="op">&gt;=</span> <span class="dv">15</span>:</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>                annot.loc[i, j] <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>rate<span class="sc">:.0%}</span><span class="ch">\n</span><span class="ss">(n=</span><span class="sc">{</span><span class="bu">int</span>(n)<span class="sc">}</span><span class="ss">)'</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                annot.loc[i, j] <span class="op">=</span> <span class="st">''</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mask cells with low sample size</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> pivot_n <span class="op">&lt;</span> <span class="dv">15</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(pivot_rate, annot<span class="op">=</span>annot, fmt<span class="op">=</span><span class="st">''</span>, mask<span class="op">=</span>mask,</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">"RdYlGn"</span>, center<span class="op">=</span>subset[<span class="st">'is_success'</span>].mean(),</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>                cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Conversion Rate'</span>}, linewidths<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"The 'Magic Quadrant' for </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">: Where do we Win?</span><span class="ch">\n</span><span class="ss">(Gray = Insufficient Data, n&lt;15)"</span>,</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Industry Sector"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Manufacturing Model"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find top segments</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    pivot_flat <span class="op">=</span> pivot_rate.stack().reset_index()</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    pivot_flat.columns <span class="op">=</span> [<span class="st">'Industry'</span>, <span class="st">'Model'</span>, <span class="st">'Rate'</span>]</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    pivot_flat_n <span class="op">=</span> pivot_n.stack().reset_index()</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    pivot_flat_n.columns <span class="op">=</span> [<span class="st">'Industry'</span>, <span class="st">'Model'</span>, <span class="st">'N'</span>]</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    pivot_flat <span class="op">=</span> pivot_flat.merge(pivot_flat_n)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    pivot_flat <span class="op">=</span> pivot_flat[pivot_flat[<span class="st">'N'</span>] <span class="op">&gt;=</span> <span class="dv">15</span>].sort_values(<span class="st">'Rate'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🎯 TOP 5 SEGMENTS for </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> (n &gt;= 15):"</span>)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(pivot_flat.head(<span class="dv">5</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    interaction_heatmap(df, <span class="st">'Mx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div id="magic-quadrant" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/magic-quadrant-output-1.png" width="1249" height="930" class="figure-img"></p>
<figcaption>The Magic Quadrant: Identifying high-yield micro-segments for Mx.</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
🎯 TOP 5 SEGMENTS for Mx (n &gt;= 15):
        Industry                            Model     Rate     N
Non-Life Science Original Equipment Manufacturing 0.542857  35.0
Non-Life Science                         In-House 0.333333 192.0
Non-Life Science                             CDMO 0.277778  18.0
Non-Life Science            Not Enough Info Found 0.272727  22.0
Pharma &amp; BioTech                             503B 0.263158  19.0</code></pre>
</div>
</div>
</section>
<section id="the-power-trio-interaction" class="level2">
<h2 class="anchored" data-anchor-id="the-power-trio-interaction">5.3 The “Power Trio” Interaction</h2>
<p>Does <strong>Seniority</strong> matter more in <strong>Operations</strong> than in <strong>Quality</strong>?</p>
<div id="cell-power-trio" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_power_trio(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to main categories</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> subset[subset[<span class="st">'title_function'</span>].isin([<span class="st">'Manufacturing/Ops'</span>, <span class="st">'Quality/Reg'</span>, <span class="st">'IT/Systems'</span>, <span class="st">'R&amp;D/Lab'</span>])]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> subset[subset[<span class="st">'title_seniority'</span>].isin([<span class="st">'VP/Head'</span>, <span class="st">'Director'</span>, <span class="st">'Manager'</span>, <span class="st">'IC'</span>])]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(subset) <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate rates with sample sizes</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    viz <span class="op">=</span> subset.groupby([<span class="st">'title_function'</span>, <span class="st">'title_seniority'</span>]).agg(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        rate<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'mean'</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'size'</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for minimum sample size</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    viz <span class="op">=</span> viz[viz[<span class="st">'n'</span>] <span class="op">&gt;=</span> <span class="dv">10</span>]</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">7</span>))</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LEFT: Grouped bar chart</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    pivot_viz <span class="op">=</span> viz.pivot(index<span class="op">=</span><span class="st">'title_function'</span>, columns<span class="op">=</span><span class="st">'title_seniority'</span>, values<span class="op">=</span><span class="st">'rate'</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reorder columns by seniority</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    col_order <span class="op">=</span> [<span class="st">'VP/Head'</span>, <span class="st">'Director'</span>, <span class="st">'Manager'</span>, <span class="st">'IC'</span>]</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    pivot_viz <span class="op">=</span> pivot_viz[[c <span class="cf">for</span> c <span class="kw">in</span> col_order <span class="cf">if</span> c <span class="kw">in</span> pivot_viz.columns]]</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    pivot_viz.plot(kind<span class="op">=</span><span class="st">'bar'</span>, ax<span class="op">=</span>ax1, colormap<span class="op">=</span><span class="st">'viridis'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, width<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="ss">f"The ICP Formula: Which Title Level Works Best in Which Dept for </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">?"</span>,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>                  fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">"Conversion Rate"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">""</span>)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylim(<span class="dv">0</span>, <span class="fl">0.35</span>)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    ax1.legend(title<span class="op">=</span><span class="st">'Seniority Level'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    ax1.axhline(subset[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Avg'</span>)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    ax1.set_xticklabels(ax1.get_xticklabels(), rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    ax1.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RIGHT: Heatmap view</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    pivot_heatmap <span class="op">=</span> viz.pivot(index<span class="op">=</span><span class="st">'title_function'</span>, columns<span class="op">=</span><span class="st">'title_seniority'</span>, values<span class="op">=</span><span class="st">'rate'</span>)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    pivot_heatmap <span class="op">=</span> pivot_heatmap[[c <span class="cf">for</span> c <span class="kw">in</span> col_order <span class="cf">if</span> c <span class="kw">in</span> pivot_heatmap.columns]]</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(pivot_heatmap, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.0%'</span>, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>,</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>                center<span class="op">=</span>subset[<span class="st">'is_success'</span>].mean(), ax<span class="op">=</span>ax2, linewidths<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Conversion Rate: Function × Seniority'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    plot_power_trio(df, <span class="st">'Mx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div id="power-trio" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/power-trio-output-1.png" width="1509" height="639" class="figure-img"></p>
<figcaption>The Power Trio: Function x Seniority interaction reveals the ICP.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="power-scope-analysis-global-vs-site" class="level2">
<h2 class="anchored" data-anchor-id="power-scope-analysis-global-vs-site">5.4 Power Scope Analysis (Global vs Site)</h2>
<p>Does having “Global” in your title make you a better Mx buyer?</p>
<div id="cell-scope-analysis" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_scope(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(subset) <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate stats by scope</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    scope_stats <span class="op">=</span> subset.groupby(<span class="st">'title_scope'</span>).agg(</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'size'</span>),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        successes<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'sum'</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add Bayesian estimates</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    scope_stats[<span class="st">'rate'</span>] <span class="op">=</span> scope_stats.<span class="bu">apply</span>(</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">0</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    scope_stats[<span class="st">'ci_low'</span>] <span class="op">=</span> scope_stats.<span class="bu">apply</span>(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">1</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    scope_stats[<span class="st">'ci_high'</span>] <span class="op">=</span> scope_stats.<span class="bu">apply</span>(</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">2</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    scope_stats <span class="op">=</span> scope_stats.sort_values(<span class="st">'rate'</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(scope_stats))</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> r <span class="op">&gt;</span> subset[<span class="st">'is_success'</span>].mean()</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>] <span class="cf">for</span> r <span class="kw">in</span> scope_stats[<span class="st">'rate'</span>]]</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(y_pos, scope_stats[<span class="st">'rate'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>, height<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Error bars and labels</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> scope_stats.iterrows():</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="bu">list</span>(scope_stats.index).index(i)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>        ax.plot([row[<span class="st">'ci_low'</span>], row[<span class="st">'ci_high'</span>]], [idx, idx], color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>        ax.text(row[<span class="st">'rate'</span>] <span class="op">+</span> <span class="fl">0.01</span>, idx, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'rate'</span>]<span class="sc">:.1%}</span><span class="ss"> (n=</span><span class="sc">{</span>row[<span class="st">'n'</span>]<span class="sc">:,}</span><span class="ss">)"</span>,</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>               va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(y_pos)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(scope_stats[<span class="st">'title_scope'</span>], fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>    ax.axvline(x<span class="op">=</span>subset[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>,</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>               alpha<span class="op">=</span><span class="fl">0.7</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Average'</span>)</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Conversion Rate'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'Impact of Title Scope on </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Conversion</span><span class="ch">\n</span><span class="ss">("Global VP" vs "Site Manager")'</span>,</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>                fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'lower right'</span>)</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">0</span>, <span class="fl">0.30</span>)</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate lift</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    global_rate <span class="op">=</span> scope_stats[scope_stats[<span class="st">'title_scope'</span>] <span class="op">==</span> <span class="st">'Global'</span>][<span class="st">'rate'</span>].values</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    standard_rate <span class="op">=</span> scope_stats[scope_stats[<span class="st">'title_scope'</span>] <span class="op">==</span> <span class="st">'Standard'</span>][<span class="st">'rate'</span>].values</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(global_rate) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="bu">len</span>(standard_rate) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> standard_rate[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>        lift <span class="op">=</span> global_rate[<span class="dv">0</span>] <span class="op">/</span> standard_rate[<span class="dv">0</span>]</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🎯 KEY FINDING: 'Global' titles show </span><span class="sc">{</span>lift<span class="sc">:.1f}</span><span class="ss">x conversion lift vs Standard"</span>)</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>    analyze_scope(df, <span class="st">'Mx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div id="scope-analysis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/scope-analysis-output-1.png" width="1119" height="541" class="figure-img"></p>
<figcaption>Power Scope: Do ‘Global’ titles convert better than ‘Site’ titles?</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
🎯 KEY FINDING: 'Global' titles show 1.0x conversion lift vs Standard</code></pre>
</div>
</div>
</section>
<section id="pipeline-velocity-analysis" class="level2">
<h2 class="anchored" data-anchor-id="pipeline-velocity-analysis">5.5 Pipeline Velocity Analysis</h2>
<p>Are Mx leads slower to convert? This tells us if the problem is targeting or sales enablement.</p>
<div id="cell-velocity" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_velocity(df):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    df_velocity <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])].copy()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    df_success <span class="op">=</span> df_velocity[df_velocity[<span class="st">'is_success'</span>] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_success) <span class="op">&lt;</span> <span class="dv">20</span>:</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Stats by product</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    velocity_stats <span class="op">=</span> df_success.groupby(<span class="st">'product_segment'</span>).agg(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        median_age<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="st">'median'</span>),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        mean_age<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="st">'mean'</span>),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        p25<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.25</span>)),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        p75<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.75</span>)),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'sum'</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"PIPELINE VELOCITY ANALYSIS"</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(velocity_stats.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LEFT: Distribution</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> product, color <span class="kw">in</span> [(<span class="st">'Mx'</span>, PROJECT_COLS[<span class="st">'Mx'</span>]), (<span class="st">'Qx'</span>, PROJECT_COLS[<span class="st">'Qx'</span>])]:</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>] <span class="op">==</span> product][<span class="st">'lead_age_days'</span>].dropna()</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(data) <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>            ax1.hist(data, bins<span class="op">=</span><span class="dv">25</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> (n=</span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss">)'</span>,</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>                    color<span class="op">=</span>color, density<span class="op">=</span><span class="va">True</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Lead Age at Conversion (Days)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Density'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'Time-to-Convert Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    ax1.legend()</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    ax1.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RIGHT: Box plot</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="op">=</span> df_success[[<span class="st">'product_segment'</span>, <span class="st">'lead_age_days'</span>]].dropna()</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    bp <span class="op">=</span> df_plot.boxplot(column<span class="op">=</span><span class="st">'lead_age_days'</span>, by<span class="op">=</span><span class="st">'product_segment'</span>, ax<span class="op">=</span>ax2,</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>                         patch_artist<span class="op">=</span><span class="va">True</span>, return_type<span class="op">=</span><span class="st">'dict'</span>)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Mx'</span>], PROJECT_COLS[<span class="st">'Qx'</span>]]</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> patch, color <span class="kw">in</span> <span class="bu">zip</span>(bp[<span class="st">'lead_age_days'</span>][<span class="st">'boxes'</span>], colors):</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>        patch.set_facecolor(color)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>        patch.set_alpha(<span class="fl">0.7</span>)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'Product'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Lead Age (Days)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'Time-to-Convert Comparison'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="st">''</span>)</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Statistical test</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    mx_ages <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>][<span class="st">'lead_age_days'</span>].dropna()</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>    qx_ages <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Qx'</span>][<span class="st">'lead_age_days'</span>].dropna()</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mx_ages) <span class="op">&gt;</span> <span class="dv">5</span> <span class="kw">and</span> <span class="bu">len</span>(qx_ages) <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>        stat, p_val <span class="op">=</span> mannwhitneyu(mx_ages, qx_ages, alternative<span class="op">=</span><span class="st">'two-sided'</span>)</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>        mx_med <span class="op">=</span> mx_ages.median()</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>        qx_med <span class="op">=</span> qx_ages.median()</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>        diff <span class="op">=</span> mx_med <span class="op">-</span> qx_med</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🚨 KEY FINDING: Mx deals take </span><span class="sc">{</span><span class="bu">abs</span>(diff)<span class="sc">:.0f}</span><span class="ss"> days </span><span class="sc">{</span><span class="st">'longer'</span> <span class="cf">if</span> diff <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'shorter'</span><span class="sc">}</span><span class="ss"> (median)"</span>)</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   Mann-Whitney p-value: </span><span class="sc">{</span>p_val<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>    analyze_velocity(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
PIPELINE VELOCITY ANALYSIS
============================================================
product_segment  median_age   mean_age   p25   p75    n
             Mx       389.0 380.829268 200.0 564.0  533
             Qx       389.0 382.243833 202.0 560.0 2473</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="velocity" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/velocity-output-2.png" width="1312" height="421" class="figure-img"></p>
<figcaption>Pipeline Velocity: Are Mx leads stalling longer than Qx?</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
🚨 KEY FINDING: Mx deals take 0 days shorter (median)
   Mann-Whitney p-value: 0.8945</code></pre>
</div>
</div>
</section>
<section id="driver-analysis-entropy-scoring" class="level2">
<h2 class="anchored" data-anchor-id="driver-analysis-entropy-scoring">5.6 Driver Analysis (Entropy Scoring)</h2>
<p>We use <strong>Mutual Information (Information Theory)</strong> to mathematically rank which features are the strongest predictors.</p>
<div id="cell-feature-importance" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rank_features(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> product:</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        subset <span class="op">=</span> df.copy()</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select features</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [<span class="st">'acct_target_industry'</span>, <span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">'title_seniority'</span>, <span class="st">'title_function'</span>, <span class="st">'title_scope'</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">'is_decision_maker'</span>, <span class="st">'completeness_tier'</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">'priority'</span>, <span class="st">'last_tactic_campaign_channel'</span>]</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> features <span class="cf">if</span> f <span class="kw">in</span> subset.columns]</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    clean_df <span class="op">=</span> subset.dropna(subset<span class="op">=</span>features)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(clean_df) <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> clean_df[features].astype(<span class="bu">str</span>).<span class="bu">apply</span>(LabelEncoder().fit_transform)</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> clean_df[<span class="st">'is_success'</span>]</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate Mutual Information</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    mi <span class="op">=</span> mutual_info_classif(X, y, discrete_features<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    mi_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Feature'</span>: features,</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Importance'</span>: mi</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    }).sort_values(<span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"FEATURE IMPORTANCE (</span><span class="sc">{</span>product <span class="cf">if</span> product <span class="cf">else</span> <span class="st">'All'</span><span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(mi_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> imp <span class="op">&gt;</span> mi_df[<span class="st">'Importance'</span>].median()</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> PROJECT_COLS[<span class="st">'Neutral'</span>] <span class="cf">for</span> imp <span class="kw">in</span> mi_df[<span class="st">'Importance'</span>]]</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(<span class="bu">range</span>(<span class="bu">len</span>(mi_df)), mi_df[<span class="st">'Importance'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(mi_df)))</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(mi_df[<span class="st">'Feature'</span>], fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    ax.invert_yaxis()</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Mutual Information Score (bits)"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"Driver Analysis: Which attributes drive </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> conversion?"</span>,</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>                 fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add value labels</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (imp, feat) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(mi_df[<span class="st">'Importance'</span>], mi_df[<span class="st">'Feature'</span>])):</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>        ax.text(imp <span class="op">+</span> <span class="fl">0.001</span>, i, <span class="ss">f'</span><span class="sc">{</span>imp<span class="sc">:.4f}</span><span class="ss">'</span>, va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mi_df</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>    mi_results <span class="op">=</span> rank_features(df, <span class="st">'Mx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
FEATURE IMPORTANCE (Mx)
============================================================
                     Feature  Importance
    acct_manufacturing_model    0.051688
                    priority    0.051483
           completeness_tier    0.045494
last_tactic_campaign_channel    0.036704
              title_function    0.005572
             title_seniority    0.004537
        acct_target_industry    0.001777
           is_decision_maker    0.000241
                 title_scope    0.000132</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="feature-importance" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/feature-importance-output-2.png" width="1120" height="638" class="figure-img"></p>
<figcaption>Driver Rank: Mathematical importance of each feature based on Mutual Information.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="decision-tree-algorithmic-segment-discovery" class="level2">
<h2 class="anchored" data-anchor-id="decision-tree-algorithmic-segment-discovery">5.7 Decision Tree: Algorithmic Segment Discovery</h2>
<p>Let the algorithm find the optimal targeting rules automatically.</p>
<div id="cell-decision-tree" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> discover_rules(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [<span class="st">'title_seniority'</span>, <span class="st">'title_function'</span>, <span class="st">'acct_target_industry'</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">'acct_manufacturing_model'</span>, <span class="st">'title_scope'</span>]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> features <span class="cf">if</span> f <span class="kw">in</span> subset.columns]</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Encode</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> subset[features].astype(<span class="bu">str</span>).copy()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    encoders <span class="op">=</span> {}</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> features:</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        le <span class="op">=</span> LabelEncoder()</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        X[col] <span class="op">=</span> le.fit_transform(X[col])</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        encoders[col] <span class="op">=</span> le</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> subset[<span class="st">'is_success'</span>]</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit tree</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">3</span>, min_samples_leaf<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>                                   min_samples_split<span class="op">=</span><span class="dv">60</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    tree.fit(X, y)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feature importance from tree</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    importance <span class="op">=</span> pd.DataFrame({</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'feature'</span>: features,</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'importance'</span>: tree.feature_importances_</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    }).sort_values(<span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"DECISION TREE FEATURE IMPORTANCE (</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(importance.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualize tree</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    plot_tree(tree, feature_names<span class="op">=</span>features, class_names<span class="op">=</span>[<span class="st">'Fail'</span>, <span class="st">'Success'</span>],</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>              filled<span class="op">=</span><span class="va">True</span>, rounded<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax, fontsize<span class="op">=</span><span class="dv">10</span>, max_depth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Targeting Decision Rules</span><span class="ch">\n</span><span class="ss">(Read: IF condition THEN outcome)'</span>,</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>                 fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tree, importance</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>    tree_model, tree_importance <span class="op">=</span> discover_rules(df, <span class="st">'Mx'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
DECISION TREE FEATURE IMPORTANCE (Mx)
============================================================
                 feature  importance
acct_manufacturing_model    0.760146
    acct_target_industry    0.201763
         title_seniority    0.038092
          title_function    0.000000
             title_scope    0.000000</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="decision-tree" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/decision-tree-output-2.png" width="1887" height="926" class="figure-img"></p>
<figcaption>Algorithmic targeting: The machine finds segments humans miss.</figcaption>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="the-zombie-lead-opportunity" class="level1">
<h1>The “Zombie” Lead Opportunity</h1>
<p>“Recycled” leads are NOT failures - they’re timing mismatches. This is a nurture campaign opportunity.</p>
<div id="cell-zombie-analysis" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_zombies(df):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    df_products <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])].copy()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    mx_zombies <span class="op">=</span> df_products[(df_products[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>) <span class="op">&amp;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                              (df_products[<span class="st">'outcome_tier'</span>] <span class="op">==</span> <span class="st">'Near-Miss'</span>)]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mx_zombies) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top-left: Zombies by industry</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    zombie_industry <span class="op">=</span> mx_zombies[<span class="st">'acct_target_industry'</span>].value_counts().head(<span class="dv">8</span>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    zombie_industry.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax1, color<span class="op">=</span>PROJECT_COLS[<span class="st">'Neutral'</span>])</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Count of Recycled Leads'</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'Mx "Zombie" Leads by Industry</span><span class="ch">\n</span><span class="st">(Nurture Campaign Targets)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top-right: Zombies by seniority</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    zombie_seniority <span class="op">=</span> mx_zombies[<span class="st">'title_seniority'</span>].value_counts()</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    zombie_seniority.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax2, color<span class="op">=</span>PROJECT_COLS[<span class="st">'Highlight'</span>])</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'Count of Recycled Leads'</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'Mx "Zombie" Leads by Seniority'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bottom-left: Zombies by function</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>]</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    zombie_function <span class="op">=</span> mx_zombies[<span class="st">'title_function'</span>].value_counts()</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    zombie_function.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax3, color<span class="op">=</span>PROJECT_COLS[<span class="st">'Success'</span>])</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    ax3.set_xlabel(<span class="st">'Count of Recycled Leads'</span>)</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    ax3.set_title(<span class="st">'Mx "Zombie" Leads by Function'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bottom-right: Decision maker split</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    ax4 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    dm_split <span class="op">=</span> mx_zombies[<span class="st">'is_decision_maker'</span>].value_counts()</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>    dm_split.index <span class="op">=</span> [<span class="st">'Non-Decision Maker'</span>, <span class="st">'Decision Maker'</span>]</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Failure'</span>], PROJECT_COLS[<span class="st">'Success'</span>]]</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    dm_split.plot(kind<span class="op">=</span><span class="st">'pie'</span>, ax<span class="op">=</span>ax4, colors<span class="op">=</span>colors, autopct<span class="op">=</span><span class="st">'%1.0f</span><span class="sc">%%</span><span class="st">'</span>, startangle<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    ax4.set_ylabel(<span class="st">''</span>)</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    ax4.set_title(<span class="st">'Zombie Lead Quality</span><span class="ch">\n</span><span class="st">(Decision Maker Status)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🧟 ZOMBIE LEAD SUMMARY (Mx Recycled):"</span>)</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Total Mx Zombies: </span><span class="sc">{</span><span class="bu">len</span>(mx_zombies)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Decision Maker Rate: </span><span class="sc">{</span>mx_zombies[<span class="st">'is_decision_maker'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   → These are high-value re-engagement targets!"</span>)</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>    analyze_zombies(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div id="zombie-analysis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/zombie-analysis-output-1.png" width="1326" height="927" class="figure-img"></p>
<figcaption>Zombie Leads: Where are we recycling high-potential prospects?</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
🧟 ZOMBIE LEAD SUMMARY (Mx Recycled):
   Total Mx Zombies: 3,287
   Decision Maker Rate: 27.1%

   → These are high-value re-engagement targets!</code></pre>
</div>
</div>
<hr>
</section>
<section id="executive-summary-dashboard" class="level1">
<h1>Executive Summary Dashboard</h1>
<div id="cell-executive-dashboard" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> executive_dashboard(df):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df.empty:</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    df_mx <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>]</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    df_qx <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Qx'</span>]</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">12</span>))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create grid</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    gs <span class="op">=</span> fig.add_gridspec(<span class="dv">3</span>, <span class="dv">3</span>, hspace<span class="op">=</span><span class="fl">0.3</span>, wspace<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. KPI Cards (top row)</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    ax_kpi <span class="op">=</span> fig.add_subplot(gs[<span class="dv">0</span>, :])</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    ax_kpi.axis(<span class="st">'off'</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    mx_rate <span class="op">=</span> df_mx[<span class="st">'is_success'</span>].mean()</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    qx_rate <span class="op">=</span> df_qx[<span class="st">'is_success'</span>].mean()</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    gap <span class="op">=</span> qx_rate <span class="op">-</span> mx_rate</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    zombies <span class="op">=</span> <span class="bu">len</span>(df_mx[df_mx[<span class="st">'outcome_tier'</span>] <span class="op">==</span> <span class="st">'Near-Miss'</span>])</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    dm_rate <span class="op">=</span> df_mx[<span class="st">'is_decision_maker'</span>].mean()</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    kpi_text <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="ss">    ╔═══════════════════╦═══════════════════╦═══════════════════╦═══════════════════╗</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="ss">    ║   MX CONVERSION   ║   QX CONVERSION   ║   PERFORMANCE GAP ║   ZOMBIE LEADS    ║</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="ss">    ║      </span><span class="sc">{</span>mx_rate<span class="sc">:.1%}</span><span class="ss">         ║      </span><span class="sc">{</span>qx_rate<span class="sc">:.1%}</span><span class="ss">         ║      </span><span class="sc">{</span>gap<span class="sc">:.1%}</span><span class="ss">         ║      </span><span class="sc">{</span>zombies<span class="sc">:,}</span><span class="ss">          ║</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="ss">    ╚═══════════════════╩═══════════════════╩═══════════════════╩═══════════════════╝</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    ax_kpi.text(<span class="fl">0.5</span>, <span class="fl">0.5</span>, kpi_text, fontsize<span class="op">=</span><span class="dv">14</span>, fontfamily<span class="op">=</span><span class="st">'monospace'</span>,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax_kpi.transAxes)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    ax_kpi.set_title(<span class="st">'KEY PERFORMANCE INDICATORS'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Conversion by Seniority</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    seniority_rates <span class="op">=</span> df_mx.groupby(<span class="st">'title_seniority'</span>)[<span class="st">'is_success'</span>].mean().sort_values()</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> r <span class="op">&gt;</span> mx_rate <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>] <span class="cf">for</span> r <span class="kw">in</span> seniority_rates]</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    seniority_rates.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax2, color<span class="op">=</span>colors)</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    ax2.axvline(mx_rate, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'Mx by Seniority'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'Conversion Rate'</span>)</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Conversion by Function</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    function_rates <span class="op">=</span> df_mx.groupby(<span class="st">'title_function'</span>)[<span class="st">'is_success'</span>].mean().sort_values()</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> r <span class="op">&gt;</span> mx_rate <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>] <span class="cf">for</span> r <span class="kw">in</span> function_rates]</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>    function_rates.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax3, color<span class="op">=</span>colors)</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>    ax3.axvline(mx_rate, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>    ax3.set_title(<span class="st">'Mx by Function'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>    ax3.set_xlabel(<span class="st">'Conversion Rate'</span>)</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Conversion by Scope</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>    ax4 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>    scope_rates <span class="op">=</span> df_mx.groupby(<span class="st">'title_scope'</span>)[<span class="st">'is_success'</span>].mean().sort_values()</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> r <span class="op">&gt;</span> mx_rate <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>] <span class="cf">for</span> r <span class="kw">in</span> scope_rates]</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>    scope_rates.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax4, color<span class="op">=</span>colors)</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>    ax4.axvline(mx_rate, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>    ax4.set_title(<span class="st">'Mx by Scope'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>    ax4.set_xlabel(<span class="st">'Conversion Rate'</span>)</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. Outcome Distribution</span></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>    ax5 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">2</span>, <span class="dv">0</span>])</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>    outcome_counts <span class="op">=</span> df_mx[<span class="st">'outcome_tier'</span>].value_counts()</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Failure'</span>], PROJECT_COLS[<span class="st">'Neutral'</span>], PROJECT_COLS[<span class="st">'Success'</span>]]</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>    outcome_counts.plot(kind<span class="op">=</span><span class="st">'pie'</span>, ax<span class="op">=</span>ax5, colors<span class="op">=</span>colors, autopct<span class="op">=</span><span class="st">'%1.0f</span><span class="sc">%%</span><span class="st">'</span>)</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>    ax5.set_ylabel(<span class="st">''</span>)</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>    ax5.set_title(<span class="st">'Mx Outcome Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 6. Top Industries</span></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>    ax6 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">2</span>, <span class="dv">1</span>])</span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>    industry_rates <span class="op">=</span> df_mx.groupby(<span class="st">'acct_target_industry'</span>).agg(</span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>        rate<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'mean'</span>),</span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'size'</span>)</span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>    industry_rates <span class="op">=</span> industry_rates[industry_rates[<span class="st">'n'</span>] <span class="op">&gt;=</span> <span class="dv">30</span>].sort_values(<span class="st">'rate'</span>, ascending<span class="op">=</span><span class="va">True</span>).tail(<span class="dv">8</span>)</span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>    industry_rates[<span class="st">'rate'</span>].plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax6, color<span class="op">=</span>PROJECT_COLS[<span class="st">'Success'</span>])</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>    ax6.set_title(<span class="st">'Top Industries for Mx'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>    ax6.set_xlabel(<span class="st">'Conversion Rate'</span>)</span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 7. Recommendations</span></span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>    ax7 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">2</span>, <span class="dv">2</span>])</span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>    ax7.axis(<span class="st">'off'</span>)</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>    reco_text <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a><span class="st">    RECOMMENDED ACTIONS:</span></span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a><span class="st">    ✓ Target: Directors/VPs with</span></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a><span class="st">       Global scope in Pharma</span></span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a><span class="st">    ✓ Avoid: ICs and Site-level</span></span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a><span class="st">       roles in Unknown industries</span></span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a><span class="st">    ✓ Speed: Implement 24-hour</span></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a><span class="st">       SLA for Mx leads</span></span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a><span class="st">    ✓ Nurture: Re-engage the</span></span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a><span class="st">       </span><span class="sc">{zombies:,}</span><span class="st"> recycled leads</span></span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>.<span class="bu">format</span>(zombies<span class="op">=</span>zombies)</span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>    ax7.text(<span class="fl">0.1</span>, <span class="fl">0.5</span>, reco_text, fontsize<span class="op">=</span><span class="dv">12</span>, fontfamily<span class="op">=</span><span class="st">'monospace'</span>,</span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a>             va<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax7.transAxes,</span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'round'</span>, facecolor<span class="op">=</span><span class="st">'lightyellow'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>))</span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>    ax7.set_title(<span class="st">'ACTION ITEMS'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="st">'MasterControl Mx Performance Dashboard'</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>    executive_dashboard(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div id="executive-dashboard" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="MasterControl_EDA_Professional_files/figure-html/executive-dashboard-output-1.png" width="1495" height="1132" class="figure-img"></p>
<figcaption>Executive Dashboard: The complete picture at a glance.</figcaption>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="deployment" class="level1">
<h1>Deployment</h1>
<p>We export the “Enriched” dataset with our engineered features.</p>
<div id="export" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> export_enriched_dataset(df):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    export_cols <span class="op">=</span> [</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># IDs</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'qal_id'</span>, <span class="st">'contact_lead_id'</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Targets</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'is_success'</span>, <span class="st">'outcome_tier'</span>, <span class="st">'next_stage__c'</span>, <span class="st">'product_segment'</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Account Features</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acct_target_industry'</span>, <span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acct_primary_site_function'</span>, <span class="st">'acct_territory_rollup'</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Engineered Features</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'title_seniority'</span>, <span class="st">'title_function'</span>, <span class="st">'title_scope'</span>, <span class="st">'is_decision_maker'</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'record_completeness'</span>, <span class="st">'completeness_tier'</span>,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Lead attributes</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'priority'</span>, <span class="st">'last_tactic_campaign_channel'</span>,</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Temporal</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cohort_date'</span>, <span class="st">'cohort_year'</span>, <span class="st">'cohort_quarter'</span>, <span class="st">'lead_age_days'</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    export_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> export_cols <span class="cf">if</span> c <span class="kw">in</span> df.columns]</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    df_export <span class="op">=</span> df[export_cols].copy()</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path.cwd() <span class="op">/</span> <span class="st">"Cleaned_QAL_Competition_Grade.csv"</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    df_export.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Exported: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Rows: </span><span class="sc">{</span><span class="bu">len</span>(df_export)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Columns: </span><span class="sc">{</span><span class="bu">len</span>(df_export.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_export</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    df_export <span class="op">=</span> export_enriched_dataset(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<hr>
</section>
<section id="appendix-statistical-methodology" class="level1">
<h1>Appendix: Statistical Methodology</h1>
<p><strong>Bayesian Credible Intervals:</strong> We use Beta-Binomial conjugacy with uninformative priors (alpha=1, beta=1) to estimate conversion rates. This provides more robust uncertainty quantification for small samples compared to frequentist confidence intervals.</p>
<p><strong>Mutual Information:</strong> Feature importance is calculated using Shannon mutual information, which measures the reduction in uncertainty about the target variable given knowledge of each feature.</p>
<p><strong>Decision Tree Interactions:</strong> We use shallow decision trees (depth &lt;= 3) as interaction detectors. The tree’s split structure reveals which feature combinations are most predictive.</p>
<p><strong>Log-Odds Ratio:</strong> For semantic analysis, we calculate log-odds with Laplace smoothing to identify words that discriminate between successful and unsuccessful leads.</p>
<hr>
<p><em>Document generated for MSBA Capstone Case Competition - Spring 2026</em></p>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "The Signal in the Noise: MasterControl Strategic EDA"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "A Masterclass in Identifying the Ideal Customer Profile (ICP) for Mx Expansion"</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "MSBA Capstone Group 3"</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "Spring 2026"</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: journal</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-float: true</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: false</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: github</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co">    documentclass: article</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co">    geometry:</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co">      - margin=1in</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: false</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co">    colorlinks: true</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co">    mainfont: "Arial"</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co">    sansfont: "Arial"</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co">    monofont: "Courier New"</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="fu"># The Business Intelligence Briefing</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1.1 The Client: MasterControl</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>Before analyzing a single row of data, we must understand the engine we are tuning. **MasterControl** is a SaaS provider for the **Life Sciences** industry (Pharmaceuticals, Biotech, and Medical Devices).</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**The Stakes:** These industries are highly regulated by the FDA. One mistake in a manufacturing record can lead to millions in fines or a plant shutdown. MasterControl sells software that digitizes these records to ensure compliance and efficiency.</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**The Landscape:** They are not selling generic software; they are selling *safety and speed* to people who make life-saving drugs and devices.</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1.2 The "Tale of Two Products" (The Core Problem)</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>This case is defined by the performance gap between two product lines:</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Qx (Quality Excellence):**</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*The Legacy:* This is the "Cash Cow." MasterControl has sold QMS (Quality Management Systems) for 20+ years.</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*The Buyer:* Quality Managers (Risk-averse, compliance-focused).</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*Performance:* **19.7% Conversion Rate.** The sales motion is a well-oiled machine.</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Mx (Manufacturing Excellence):**</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*The Challenger:* A newer product (launched \~4 years ago) focused on MES (Manufacturing Execution Systems) – digitizing the shop floor.</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*The Buyer:* Operations/Plant Directors (Efficiency-focused).</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*The Problem:* **12.7% Conversion Rate.** It is underperforming Qx by **\~55%**.</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>**Our Mission:** The data suggests MasterControl is trying to sell Mx to the *wrong people* (Quality Managers) at the *wrong companies*. We must identify the **Ideal Customer Profile (ICP)**—the specific combination of **Job Title**, **Industry**, and **Manufacturing Model**—that actually buys Mx.</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a><span class="fu"># System Architecture</span></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>We begin by initializing a "Competition-Grade" environment. We use a specific color palette (<span class="in">`#00534B`</span> Teal vs <span class="in">`#F05627`</span> Orange) to visually reinforce the "Success vs Failure" binary in every chart.</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a><span class="co"># CORE ARCHITECTURE</span></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> beta, mannwhitneyu</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> mutual_info_classif</span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier, plot_tree</span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a><span class="co"># --- THE PSYCHOLOGICAL PALETTE ---</span></span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a><span class="co"># In our visuals, Teal always represents the GOAL (Success/Mx).</span></span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Orange always represents the PROBLEM (Failure/Gap/Qx Benchmark).</span></span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>PROJECT_COLS <span class="op">=</span> {</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Success'</span>: <span class="st">'#00534B'</span>,  <span class="co"># MasterControl Teal</span></span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Failure'</span>: <span class="st">'#F05627'</span>,  <span class="co"># Risk Orange</span></span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Neutral'</span>: <span class="st">'#95a5a6'</span>,  <span class="co"># Gray for noise</span></span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Mx'</span>: <span class="st">'#00534B'</span>,       <span class="co"># Focus Product</span></span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Qx'</span>: <span class="st">'#F05627'</span>,       <span class="co"># Benchmark Product</span></span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Highlight'</span>: <span class="st">'#2980b9'</span> <span class="co"># Blue for emphasis</span></span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical thresholds</span></span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a>ALPHA <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a>MIN_SAMPLE_SIZE <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a>BAYESIAN_PRIOR_ALPHA <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a>BAYESIAN_PRIOR_BETA <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting configuration</span></span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"whitegrid"</span>, context<span class="op">=</span><span class="st">"talk"</span>)</span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">14</span>, <span class="dv">8</span>)</span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'sans-serif'</span></span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.titleweight'</span>] <span class="op">=</span> <span class="st">'bold'</span></span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ System Initialized: Data Science Environment Active"</span>)</span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Visual Strategy: Success=</span><span class="sc">{</span>PROJECT_COLS[<span class="st">'Success'</span>]<span class="sc">}</span><span class="ss"> | Failure=</span><span class="sc">{</span>PROJECT_COLS[<span class="st">'Failure'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a><span class="fu"># Feature Engineering (The Secret Weapon)</span></span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.1 The Data Asset</span></span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a>We are analyzing **16,644 Qualified Leads (QALs)** from 2024-2025.</span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Target Variable:** <span class="in">`next_stage__c`</span>. Did the lead die ("Recycled") or progress to a sales opportunity ("SQL/SQO/Won")?</span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**The Hidden Gold:** The <span class="in">`contact/lead title`</span> column contains 4,000+ unstructured text strings (e.g., "Sr. Mgr of Quality &amp; Ops").</span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.2 The Engineering Strategy</span></span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a>Most teams will simply drop the messy text columns. **We will win by mining them.** We define custom functions to extract structured signals from the chaos:</span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**The Authority Parser:** Extracts *Seniority* (VP vs. Manager). Hypothesis: Mx requires higher budget authority than Qx, so VPs should convert better.</span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**The Domain Parser:** Extracts *Function* (Quality vs. Ops). Hypothesis: "Operations" titles will drive Mx success, while "Quality" titles drive Qx success.</span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**The Scope Parser:** Extracts *Power Modifiers* (Global vs. Site). Hypothesis: "Global" roles have more budget authority.</span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-pipeline</span></span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a><span class="co"># THE DATA PIPELINE</span></span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bayesian_conversion_rate(successes, n, alpha<span class="op">=</span>BAYESIAN_PRIOR_ALPHA, beta_param<span class="op">=</span>BAYESIAN_PRIOR_BETA):</span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a><span class="co">    Bayesian credible interval using Beta-Binomial conjugacy.</span></span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns: (posterior_mean, ci_low, ci_high)</span></span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a>    post_alpha <span class="op">=</span> alpha <span class="op">+</span> successes</span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a>    post_beta <span class="op">=</span> beta_param <span class="op">+</span> (n <span class="op">-</span> successes)</span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> post_alpha <span class="op">/</span> (post_alpha <span class="op">+</span> post_beta)</span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a>    ci_low <span class="op">=</span> beta.ppf(<span class="fl">0.025</span>, post_alpha, post_beta)</span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a>    ci_high <span class="op">=</span> beta.ppf(<span class="fl">0.975</span>, post_alpha, post_beta)</span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean, ci_low, ci_high</span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_and_engineer(filepath<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a><span class="co">    Transforms raw CRM data into high-octane signals.</span></span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. ROBUST LOADING --------------------------------------------------------</span></span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filepath <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a>        possible_paths <span class="op">=</span> [</span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a>            Path.cwd() <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span>,</span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a>            Path.cwd().parent <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span>,</span>
<span id="cb26-166"><a href="#cb26-166" aria-hidden="true" tabindex="-1"></a>            Path.cwd().parent.parent <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span>,</span>
<span id="cb26-167"><a href="#cb26-167" aria-hidden="true" tabindex="-1"></a>            Path.cwd().parent.parent.parent <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"QAL Performance for MSBA.csv"</span></span>
<span id="cb26-168"><a href="#cb26-168" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> possible_paths:</span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> p.exists():</span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a>                filepath <span class="op">=</span> p</span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filepath <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a>        filepath <span class="op">=</span> Path(<span class="st">"QAL Performance for MSBA.csv"</span>)</span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-177"><a href="#cb26-177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> filepath.exists():</span>
<span id="cb26-178"><a href="#cb26-178" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="st">"Warning: Data file not found. Please ensure 'QAL Performance for MSBA.csv' is in the data folder."</span>)</span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a>         <span class="cf">return</span> pd.DataFrame()</span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(filepath)</span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardize Headers</span></span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [c.strip().lower().replace(<span class="st">' '</span>, <span class="st">'_'</span>).replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">'-'</span>, <span class="st">'_'</span>)</span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> c <span class="kw">in</span> df.columns]</span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. TARGET DEFINITION -----------------------------------------------------</span></span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a>    success_stages <span class="op">=</span> [<span class="st">'SQL'</span>, <span class="st">'SQO'</span>, <span class="st">'Won'</span>]</span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'is_success'</span>] <span class="op">=</span> df[<span class="st">'next_stage__c'</span>].isin(success_stages).astype(<span class="bu">int</span>)</span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-191"><a href="#cb26-191" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Outcome Tiers (for Near-Miss Analysis)</span></span>
<span id="cb26-192"><a href="#cb26-192" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> classify_outcome(stage):</span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> stage <span class="kw">in</span> [<span class="st">'SQL'</span>, <span class="st">'SQO'</span>, <span class="st">'Won'</span>]:</span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Success'</span></span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> stage <span class="op">==</span> <span class="st">'Recycled'</span>:</span>
<span id="cb26-196"><a href="#cb26-196" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Near-Miss'</span></span>
<span id="cb26-197"><a href="#cb26-197" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'Lost'</span></span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'outcome_tier'</span>] <span class="op">=</span> df[<span class="st">'next_stage__c'</span>].<span class="bu">apply</span>(classify_outcome)</span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. PRODUCT SEGMENTATION --------------------------------------------------</span></span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> segment_product(sol):</span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">str</span>(sol) <span class="op">==</span> <span class="st">'Mx'</span>: <span class="cf">return</span> <span class="st">'Mx'</span></span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">str</span>(sol) <span class="op">==</span> <span class="st">'Qx'</span>: <span class="cf">return</span> <span class="st">'Qx'</span></span>
<span id="cb26-205"><a href="#cb26-205" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb26-206"><a href="#cb26-206" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'product_segment'</span>] <span class="op">=</span> df[<span class="st">'solution_rollup'</span>].<span class="bu">apply</span>(segment_product)</span>
<span id="cb26-207"><a href="#cb26-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-208"><a href="#cb26-208" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. TITLE PARSING (The Alpha Feature) -------------------------------------</span></span>
<span id="cb26-209"><a href="#cb26-209" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_seniority(t):</span>
<span id="cb26-210"><a href="#cb26-210" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(t): <span class="cf">return</span> <span class="st">'Unknown'</span></span>
<span id="cb26-211"><a href="#cb26-211" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">str</span>(t).lower()</span>
<span id="cb26-212"><a href="#cb26-212" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">ceo</span><span class="cf">|</span><span class="vs">cfo</span><span class="cf">|</span><span class="vs">coo</span><span class="cf">|</span><span class="vs">cto</span><span class="cf">|</span><span class="vs">cio</span><span class="cf">|</span><span class="vs">chief</span><span class="cf">|</span><span class="vs">c-level</span><span class="cf">|</span><span class="vs">president</span><span class="cf">|</span><span class="vs">founder</span><span class="cf">|</span><span class="vs">owner</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'C-Suite'</span></span>
<span id="cb26-213"><a href="#cb26-213" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">svp</span><span class="cf">|</span><span class="vs">senior vice president</span><span class="cf">|</span><span class="vs">evp</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'SVP'</span></span>
<span id="cb26-214"><a href="#cb26-214" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">vp</span><span class="cf">|</span><span class="vs">vice president</span><span class="cf">|</span><span class="vs">head of</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'VP/Head'</span></span>
<span id="cb26-215"><a href="#cb26-215" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">director</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Director'</span></span>
<span id="cb26-216"><a href="#cb26-216" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">manager</span><span class="cf">|</span><span class="vs">mgr</span><span class="cf">|</span><span class="vs">lead</span><span class="cf">|</span><span class="vs">supervisor</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Manager'</span></span>
<span id="cb26-217"><a href="#cb26-217" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">analyst</span><span class="cf">|</span><span class="vs">engineer</span><span class="cf">|</span><span class="vs">specialist</span><span class="cf">|</span><span class="vs">associate</span><span class="cf">|</span><span class="vs">coordinator</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'IC'</span></span>
<span id="cb26-218"><a href="#cb26-218" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb26-219"><a href="#cb26-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-220"><a href="#cb26-220" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_function(t):</span>
<span id="cb26-221"><a href="#cb26-221" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(t): <span class="cf">return</span> <span class="st">'Unknown'</span></span>
<span id="cb26-222"><a href="#cb26-222" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">str</span>(t).lower()</span>
<span id="cb26-223"><a href="#cb26-223" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">manuf</span><span class="cf">|</span><span class="vs">prod</span><span class="cf">|</span><span class="vs">ops</span><span class="cf">|</span><span class="vs">plant</span><span class="cf">|</span><span class="vs">supply</span><span class="cf">|</span><span class="vs">site</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Manufacturing/Ops'</span></span>
<span id="cb26-224"><a href="#cb26-224" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">quality</span><span class="cf">|</span><span class="vs">qa</span><span class="cf">|</span><span class="vs">qc</span><span class="cf">|</span><span class="vs">qms</span><span class="cf">|</span><span class="vs">compliance</span><span class="cf">|</span><span class="vs">validation</span><span class="cf">|</span><span class="vs">capa</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Quality/Reg'</span></span>
<span id="cb26-225"><a href="#cb26-225" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">regulatory</span><span class="cf">|</span><span class="vs">reg affairs</span><span class="cf">|</span><span class="vs">submissions</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Regulatory'</span></span>
<span id="cb26-226"><a href="#cb26-226" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">it</span><span class="cf">|</span><span class="vs">info</span><span class="cf">|</span><span class="vs">sys</span><span class="cf">|</span><span class="vs">tech</span><span class="cf">|</span><span class="vs">data</span><span class="cf">|</span><span class="vs">soft</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'IT/Systems'</span></span>
<span id="cb26-227"><a href="#cb26-227" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">lab</span><span class="cf">|</span><span class="vs">r&amp;d</span><span class="cf">|</span><span class="vs">sci</span><span class="cf">|</span><span class="vs">dev</span><span class="cf">|</span><span class="vs">clin</span><span class="cf">|</span><span class="vs">research</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'R&amp;D/Lab'</span></span>
<span id="cb26-228"><a href="#cb26-228" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">project</span><span class="cf">|</span><span class="vs">program</span><span class="cf">|</span><span class="vs">pmo</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'PMO'</span></span>
<span id="cb26-229"><a href="#cb26-229" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb26-230"><a href="#cb26-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-231"><a href="#cb26-231" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_scope(t):</span>
<span id="cb26-232"><a href="#cb26-232" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pd.isna(t): <span class="cf">return</span> <span class="st">'Standard'</span></span>
<span id="cb26-233"><a href="#cb26-233" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="bu">str</span>(t).lower()</span>
<span id="cb26-234"><a href="#cb26-234" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">global</span><span class="cf">|</span><span class="vs">worldwide</span><span class="cf">|</span><span class="vs">international</span><span class="cf">|</span><span class="vs">corporate</span><span class="cf">|</span><span class="vs">enterprise</span><span class="cf">|</span><span class="vs">group</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Global'</span></span>
<span id="cb26-235"><a href="#cb26-235" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">regional</span><span class="cf">|</span><span class="vs">division</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Regional'</span></span>
<span id="cb26-236"><a href="#cb26-236" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">site</span><span class="cf">|</span><span class="vs">plant</span><span class="cf">|</span><span class="vs">facility</span><span class="cf">|</span><span class="vs">local</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, t): <span class="cf">return</span> <span class="st">'Site'</span></span>
<span id="cb26-237"><a href="#cb26-237" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Standard'</span></span>
<span id="cb26-238"><a href="#cb26-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-239"><a href="#cb26-239" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'title_seniority'</span>] <span class="op">=</span> df[<span class="st">'contact_lead_title'</span>].<span class="bu">apply</span>(parse_seniority)</span>
<span id="cb26-240"><a href="#cb26-240" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'title_function'</span>] <span class="op">=</span> df[<span class="st">'contact_lead_title'</span>].<span class="bu">apply</span>(parse_function)</span>
<span id="cb26-241"><a href="#cb26-241" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'title_scope'</span>] <span class="op">=</span> df[<span class="st">'contact_lead_title'</span>].<span class="bu">apply</span>(parse_scope)</span>
<span id="cb26-242"><a href="#cb26-242" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'is_decision_maker'</span>] <span class="op">=</span> df[<span class="st">'title_seniority'</span>].isin([<span class="st">'C-Suite'</span>, <span class="st">'SVP'</span>, <span class="st">'VP/Head'</span>, <span class="st">'Director'</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb26-243"><a href="#cb26-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-244"><a href="#cb26-244" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. RECORD COMPLETENESS (Buyer Seriousness Proxy) -------------------------</span></span>
<span id="cb26-245"><a href="#cb26-245" aria-hidden="true" tabindex="-1"></a>    completeness_cols <span class="op">=</span> [<span class="st">'acct_manufacturing_model'</span>, <span class="st">'acct_primary_site_function'</span>,</span>
<span id="cb26-246"><a href="#cb26-246" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'acct_target_industry'</span>, <span class="st">'acct_territory_rollup'</span>, <span class="st">'acct_tier_rollup'</span>]</span>
<span id="cb26-247"><a href="#cb26-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-248"><a href="#cb26-248" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calc_completeness(row):</span>
<span id="cb26-249"><a href="#cb26-249" aria-hidden="true" tabindex="-1"></a>        filled <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> col <span class="kw">in</span> completeness_cols</span>
<span id="cb26-250"><a href="#cb26-250" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">if</span> col <span class="kw">in</span> row.index <span class="kw">and</span> pd.notna(row[col]) <span class="kw">and</span> <span class="bu">str</span>(row[col]) <span class="op">!=</span> <span class="st">'Unknown'</span>)</span>
<span id="cb26-251"><a href="#cb26-251" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> filled <span class="op">/</span> <span class="bu">len</span>(completeness_cols)</span>
<span id="cb26-252"><a href="#cb26-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-253"><a href="#cb26-253" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'record_completeness'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(calc_completeness, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-254"><a href="#cb26-254" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'completeness_tier'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'record_completeness'</span>],</span>
<span id="cb26-255"><a href="#cb26-255" aria-hidden="true" tabindex="-1"></a>                                      bins<span class="op">=</span>[<span class="op">-</span><span class="fl">0.01</span>, <span class="fl">0.4</span>, <span class="fl">0.8</span>, <span class="fl">1.01</span>],</span>
<span id="cb26-256"><a href="#cb26-256" aria-hidden="true" tabindex="-1"></a>                                      labels<span class="op">=</span>[<span class="st">'Low'</span>, <span class="st">'Medium'</span>, <span class="st">'High'</span>])</span>
<span id="cb26-257"><a href="#cb26-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-258"><a href="#cb26-258" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 6. TEMPORAL FEATURES -----------------------------------------------------</span></span>
<span id="cb26-259"><a href="#cb26-259" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'qal_cohort_date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb26-260"><a href="#cb26-260" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_year'</span>] <span class="op">=</span> df[<span class="st">'cohort_date'</span>].dt.year</span>
<span id="cb26-261"><a href="#cb26-261" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'cohort_quarter'</span>] <span class="op">=</span> df[<span class="st">'cohort_date'</span>].dt.to_period(<span class="st">'Q'</span>).astype(<span class="bu">str</span>)</span>
<span id="cb26-262"><a href="#cb26-262" aria-hidden="true" tabindex="-1"></a>    max_date <span class="op">=</span> df[<span class="st">'cohort_date'</span>].<span class="bu">max</span>()</span>
<span id="cb26-263"><a href="#cb26-263" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lead_age_days'</span>] <span class="op">=</span> (max_date <span class="op">-</span> df[<span class="st">'cohort_date'</span>]).dt.days</span>
<span id="cb26-264"><a href="#cb26-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-265"><a href="#cb26-265" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 7. STRATEGIC IMPUTATION --------------------------------------------------</span></span>
<span id="cb26-266"><a href="#cb26-266" aria-hidden="true" tabindex="-1"></a>    cols_to_fill <span class="op">=</span> [<span class="st">'acct_manufacturing_model'</span>, <span class="st">'acct_primary_site_function'</span>,</span>
<span id="cb26-267"><a href="#cb26-267" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'acct_target_industry'</span>, <span class="st">'acct_territory_rollup'</span>]</span>
<span id="cb26-268"><a href="#cb26-268" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> cols_to_fill:</span>
<span id="cb26-269"><a href="#cb26-269" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> c <span class="kw">in</span> df.columns:</span>
<span id="cb26-270"><a href="#cb26-270" aria-hidden="true" tabindex="-1"></a>            df[c] <span class="op">=</span> df[c].fillna(<span class="st">'Unknown'</span>)</span>
<span id="cb26-271"><a href="#cb26-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-272"><a href="#cb26-272" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb26-273"><a href="#cb26-273" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"DATA PIPELINE COMPLETE"</span>)</span>
<span id="cb26-274"><a href="#cb26-274" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb26-275"><a href="#cb26-275" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Total Rows: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb26-276"><a href="#cb26-276" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Target Rate (is_success): </span><span class="sc">{</span>df[<span class="st">'is_success'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb26-277"><a href="#cb26-277" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Mx Leads: </span><span class="sc">{</span><span class="bu">len</span>(df[df[<span class="st">'product_segment'</span>]<span class="op">==</span><span class="st">'Mx'</span>])<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb26-278"><a href="#cb26-278" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Qx Leads: </span><span class="sc">{</span><span class="bu">len</span>(df[df[<span class="st">'product_segment'</span>]<span class="op">==</span><span class="st">'Qx'</span>])<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb26-279"><a href="#cb26-279" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Near-Miss (Recycled): </span><span class="sc">{</span><span class="bu">len</span>(df[df[<span class="st">'outcome_tier'</span>]<span class="op">==</span><span class="st">'Near-Miss'</span>])<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb26-280"><a href="#cb26-280" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Decision Makers: </span><span class="sc">{</span>df[<span class="st">'is_decision_maker'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span>df[<span class="st">'is_decision_maker'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb26-281"><a href="#cb26-281" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb26-282"><a href="#cb26-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-283"><a href="#cb26-283" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb26-284"><a href="#cb26-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-285"><a href="#cb26-285" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute Pipeline</span></span>
<span id="cb26-286"><a href="#cb26-286" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> clean_and_engineer()</span>
<span id="cb26-287"><a href="#cb26-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-288"><a href="#cb26-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-289"><a href="#cb26-289" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-290"><a href="#cb26-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-291"><a href="#cb26-291" aria-hidden="true" tabindex="-1"></a><span class="fu"># The Yield Gap Analysis</span></span>
<span id="cb26-292"><a href="#cb26-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-293"><a href="#cb26-293" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.1 Quantifying the Pain</span></span>
<span id="cb26-294"><a href="#cb26-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-295"><a href="#cb26-295" aria-hidden="true" tabindex="-1"></a>Before providing a solution, we must quantify the problem. The chart below is the "Money Slide." It proves that for every 100 leads:</span>
<span id="cb26-296"><a href="#cb26-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-297"><a href="#cb26-297" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Qx** generates \~20 opportunities.</span>
<span id="cb26-298"><a href="#cb26-298" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Mx** generates \~12 opportunities.</span>
<span id="cb26-299"><a href="#cb26-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-300"><a href="#cb26-300" aria-hidden="true" tabindex="-1"></a>That gap represents millions in wasted marketing spend and lost revenue.</span>
<span id="cb26-301"><a href="#cb26-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-304"><a href="#cb26-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-305"><a href="#cb26-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: gap-analysis</span></span>
<span id="cb26-306"><a href="#cb26-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The Yield Gap: Mx trails Qx by ~7 percentage points. Closing this gap is the primary objective."</span></span>
<span id="cb26-307"><a href="#cb26-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-308"><a href="#cb26-308" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_performance_gap(df):</span>
<span id="cb26-309"><a href="#cb26-309" aria-hidden="true" tabindex="-1"></a>    df_main <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])]</span>
<span id="cb26-310"><a href="#cb26-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-311"><a href="#cb26-311" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_main) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb26-312"><a href="#cb26-312" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb26-313"><a href="#cb26-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-314"><a href="#cb26-314" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate stats with Bayesian CIs</span></span>
<span id="cb26-315"><a href="#cb26-315" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb26-316"><a href="#cb26-316" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> product <span class="kw">in</span> [<span class="st">'Mx'</span>, <span class="st">'Qx'</span>]:</span>
<span id="cb26-317"><a href="#cb26-317" aria-hidden="true" tabindex="-1"></a>        subset <span class="op">=</span> df_main[df_main[<span class="st">'product_segment'</span>] <span class="op">==</span> product]</span>
<span id="cb26-318"><a href="#cb26-318" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(subset)</span>
<span id="cb26-319"><a href="#cb26-319" aria-hidden="true" tabindex="-1"></a>        successes <span class="op">=</span> subset[<span class="st">'is_success'</span>].<span class="bu">sum</span>()</span>
<span id="cb26-320"><a href="#cb26-320" aria-hidden="true" tabindex="-1"></a>        rate, ci_low, ci_high <span class="op">=</span> bayesian_conversion_rate(successes, n)</span>
<span id="cb26-321"><a href="#cb26-321" aria-hidden="true" tabindex="-1"></a>        results.append({</span>
<span id="cb26-322"><a href="#cb26-322" aria-hidden="true" tabindex="-1"></a>            <span class="st">'product'</span>: product,</span>
<span id="cb26-323"><a href="#cb26-323" aria-hidden="true" tabindex="-1"></a>            <span class="st">'n'</span>: n,</span>
<span id="cb26-324"><a href="#cb26-324" aria-hidden="true" tabindex="-1"></a>            <span class="st">'successes'</span>: successes,</span>
<span id="cb26-325"><a href="#cb26-325" aria-hidden="true" tabindex="-1"></a>            <span class="st">'rate'</span>: rate,</span>
<span id="cb26-326"><a href="#cb26-326" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ci_low'</span>: ci_low,</span>
<span id="cb26-327"><a href="#cb26-327" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ci_high'</span>: ci_high</span>
<span id="cb26-328"><a href="#cb26-328" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb26-329"><a href="#cb26-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-330"><a href="#cb26-330" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb26-331"><a href="#cb26-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-332"><a href="#cb26-332" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create visualization</span></span>
<span id="cb26-333"><a href="#cb26-333" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb26-334"><a href="#cb26-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-335"><a href="#cb26-335" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LEFT: Bar chart with CIs</span></span>
<span id="cb26-336"><a href="#cb26-336" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb26-337"><a href="#cb26-337" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Mx'</span>], PROJECT_COLS[<span class="st">'Qx'</span>]]</span>
<span id="cb26-338"><a href="#cb26-338" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax1.bar(results_df[<span class="st">'product'</span>], results_df[<span class="st">'rate'</span>], color<span class="op">=</span>colors,</span>
<span id="cb26-339"><a href="#cb26-339" aria-hidden="true" tabindex="-1"></a>                   edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, width<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb26-340"><a href="#cb26-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-341"><a href="#cb26-341" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> results_df.iterrows():</span>
<span id="cb26-342"><a href="#cb26-342" aria-hidden="true" tabindex="-1"></a>        ax1.errorbar(i, row[<span class="st">'rate'</span>],</span>
<span id="cb26-343"><a href="#cb26-343" aria-hidden="true" tabindex="-1"></a>                    yerr<span class="op">=</span>[[row[<span class="st">'rate'</span>] <span class="op">-</span> row[<span class="st">'ci_low'</span>]], [row[<span class="st">'ci_high'</span>] <span class="op">-</span> row[<span class="st">'rate'</span>]]],</span>
<span id="cb26-344"><a href="#cb26-344" aria-hidden="true" tabindex="-1"></a>                    fmt<span class="op">=</span><span class="st">'none'</span>, color<span class="op">=</span><span class="st">'black'</span>, capsize<span class="op">=</span><span class="dv">12</span>, capthick<span class="op">=</span><span class="dv">2</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb26-345"><a href="#cb26-345" aria-hidden="true" tabindex="-1"></a>        ax1.text(i, row[<span class="st">'rate'</span>] <span class="op">+</span> <span class="fl">0.025</span>, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'rate'</span>]<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb26-346"><a href="#cb26-346" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-347"><a href="#cb26-347" aria-hidden="true" tabindex="-1"></a>        ax1.text(i, row[<span class="st">'ci_low'</span>] <span class="op">-</span> <span class="fl">0.015</span>, <span class="ss">f"n=</span><span class="sc">{</span>row[<span class="st">'n'</span>]<span class="sc">:,}</span><span class="ss">"</span>,</span>
<span id="cb26-348"><a href="#cb26-348" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'top'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb26-349"><a href="#cb26-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-350"><a href="#cb26-350" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Conversion Rate (Lead → SQL+)'</span>, fontsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb26-351"><a href="#cb26-351" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'The Yield Gap: Mx vs Qx Performance</span><span class="ch">\n</span><span class="st">(with 95% Bayesian Credible Intervals)'</span>,</span>
<span id="cb26-352"><a href="#cb26-352" aria-hidden="true" tabindex="-1"></a>                  fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb26-353"><a href="#cb26-353" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylim(<span class="dv">0</span>, <span class="fl">0.30</span>)</span>
<span id="cb26-354"><a href="#cb26-354" aria-hidden="true" tabindex="-1"></a>    ax1.axhline(y<span class="op">=</span>df_main[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb26-355"><a href="#cb26-355" aria-hidden="true" tabindex="-1"></a>    ax1.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb26-356"><a href="#cb26-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-357"><a href="#cb26-357" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RIGHT: Waterfall showing the gap</span></span>
<span id="cb26-358"><a href="#cb26-358" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb26-359"><a href="#cb26-359" aria-hidden="true" tabindex="-1"></a>    mx_rate <span class="op">=</span> results_df[results_df[<span class="st">'product'</span>]<span class="op">==</span><span class="st">'Mx'</span>][<span class="st">'rate'</span>].values[<span class="dv">0</span>]</span>
<span id="cb26-360"><a href="#cb26-360" aria-hidden="true" tabindex="-1"></a>    qx_rate <span class="op">=</span> results_df[results_df[<span class="st">'product'</span>]<span class="op">==</span><span class="st">'Qx'</span>][<span class="st">'rate'</span>].values[<span class="dv">0</span>]</span>
<span id="cb26-361"><a href="#cb26-361" aria-hidden="true" tabindex="-1"></a>    gap <span class="op">=</span> qx_rate <span class="op">-</span> mx_rate</span>
<span id="cb26-362"><a href="#cb26-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-363"><a href="#cb26-363" aria-hidden="true" tabindex="-1"></a>    waterfall_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb26-364"><a href="#cb26-364" aria-hidden="true" tabindex="-1"></a>        <span class="st">'label'</span>: [<span class="st">'Qx Baseline'</span>, <span class="st">'Performance Gap'</span>, <span class="st">'Mx Current'</span>],</span>
<span id="cb26-365"><a href="#cb26-365" aria-hidden="true" tabindex="-1"></a>        <span class="st">'value'</span>: [qx_rate, <span class="op">-</span>gap, mx_rate],</span>
<span id="cb26-366"><a href="#cb26-366" aria-hidden="true" tabindex="-1"></a>        <span class="st">'color'</span>: [PROJECT_COLS[<span class="st">'Qx'</span>], PROJECT_COLS[<span class="st">'Failure'</span>], PROJECT_COLS[<span class="st">'Mx'</span>]]</span>
<span id="cb26-367"><a href="#cb26-367" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb26-368"><a href="#cb26-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-369"><a href="#cb26-369" aria-hidden="true" tabindex="-1"></a>    ax2.bar(waterfall_data[<span class="st">'label'</span>], waterfall_data[<span class="st">'value'</span>], color<span class="op">=</span>waterfall_data[<span class="st">'color'</span>])</span>
<span id="cb26-370"><a href="#cb26-370" aria-hidden="true" tabindex="-1"></a>    ax2.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb26-371"><a href="#cb26-371" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Conversion Rate'</span>, fontsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb26-372"><a href="#cb26-372" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="ss">f'The </span><span class="sc">{</span>gap<span class="sc">:.1%}</span><span class="ss"> Performance Gap</span><span class="ch">\n</span><span class="ss">(Revenue Opportunity)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb26-373"><a href="#cb26-373" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylim(<span class="dv">0</span>, <span class="fl">0.25</span>)</span>
<span id="cb26-374"><a href="#cb26-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-375"><a href="#cb26-375" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add annotation</span></span>
<span id="cb26-376"><a href="#cb26-376" aria-hidden="true" tabindex="-1"></a>    ax2.annotate(<span class="ss">f'GAP:</span><span class="ch">\n</span><span class="sc">{</span>gap<span class="sc">:.1%}</span><span class="ss">'</span>, xy<span class="op">=</span>(<span class="dv">1</span>, <span class="fl">0.05</span>), fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>,</span>
<span id="cb26-377"><a href="#cb26-377" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, color<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb26-378"><a href="#cb26-378" aria-hidden="true" tabindex="-1"></a>                bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'round'</span>, facecolor<span class="op">=</span>PROJECT_COLS[<span class="st">'Failure'</span>], alpha<span class="op">=</span><span class="fl">0.8</span>))</span>
<span id="cb26-379"><a href="#cb26-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-380"><a href="#cb26-380" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-381"><a href="#cb26-381" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb26-382"><a href="#cb26-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-383"><a href="#cb26-383" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">⚠️  PERFORMANCE GAP: </span><span class="sc">{</span>gap<span class="sc">:.1%}</span><span class="ss"> points"</span>)</span>
<span id="cb26-384"><a href="#cb26-384" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Mx: </span><span class="sc">{</span>mx_rate<span class="sc">:.1%}</span><span class="ss"> | Qx: </span><span class="sc">{</span>qx_rate<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb26-385"><a href="#cb26-385" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Mx performs </span><span class="sc">{</span>(<span class="dv">1</span> <span class="op">-</span> mx_rate<span class="op">/</span>qx_rate)<span class="op">*</span><span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">% worse relative to Qx"</span>)</span>
<span id="cb26-386"><a href="#cb26-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-387"><a href="#cb26-387" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb26-388"><a href="#cb26-388" aria-hidden="true" tabindex="-1"></a>    plot_performance_gap(df)</span>
<span id="cb26-389"><a href="#cb26-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-390"><a href="#cb26-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-391"><a href="#cb26-391" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4.2 The Funnel Visualization</span></span>
<span id="cb26-392"><a href="#cb26-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-393"><a href="#cb26-393" aria-hidden="true" tabindex="-1"></a>Let's see where leads are falling off in the pipeline.</span>
<span id="cb26-394"><a href="#cb26-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-397"><a href="#cb26-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-398"><a href="#cb26-398" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: funnel-viz</span></span>
<span id="cb26-399"><a href="#cb26-399" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The Pipeline Funnel: Visualizing where leads go in the sales process."</span></span>
<span id="cb26-400"><a href="#cb26-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-401"><a href="#cb26-401" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_funnel_analysis(df):</span>
<span id="cb26-402"><a href="#cb26-402" aria-hidden="true" tabindex="-1"></a>    df_products <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])]</span>
<span id="cb26-403"><a href="#cb26-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-404"><a href="#cb26-404" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_products) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb26-405"><a href="#cb26-405" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb26-406"><a href="#cb26-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-407"><a href="#cb26-407" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb26-408"><a href="#cb26-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-409"><a href="#cb26-409" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LEFT: Stage distribution by product</span></span>
<span id="cb26-410"><a href="#cb26-410" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb26-411"><a href="#cb26-411" aria-hidden="true" tabindex="-1"></a>    stage_dist <span class="op">=</span> df_products.groupby([<span class="st">'product_segment'</span>, <span class="st">'next_stage__c'</span>]).size().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-412"><a href="#cb26-412" aria-hidden="true" tabindex="-1"></a>    stage_dist_pct <span class="op">=</span> stage_dist.div(stage_dist.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb26-413"><a href="#cb26-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-414"><a href="#cb26-414" aria-hidden="true" tabindex="-1"></a>    stage_dist_pct.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax1,</span>
<span id="cb26-415"><a href="#cb26-415" aria-hidden="true" tabindex="-1"></a>                        colormap<span class="op">=</span><span class="st">'RdYlGn'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb26-416"><a href="#cb26-416" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Percentage of Leads'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-417"><a href="#cb26-417" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">''</span>)</span>
<span id="cb26-418"><a href="#cb26-418" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'Lead Outcome Distribution by Product'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-419"><a href="#cb26-419" aria-hidden="true" tabindex="-1"></a>    ax1.legend(title<span class="op">=</span><span class="st">'Stage'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb26-420"><a href="#cb26-420" aria-hidden="true" tabindex="-1"></a>    ax1.set_xticklabels(ax1.get_xticklabels(), rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-421"><a href="#cb26-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-422"><a href="#cb26-422" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RIGHT: Outcome Tier comparison (simplified view)</span></span>
<span id="cb26-423"><a href="#cb26-423" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb26-424"><a href="#cb26-424" aria-hidden="true" tabindex="-1"></a>    outcome_dist <span class="op">=</span> df_products.groupby([<span class="st">'product_segment'</span>, <span class="st">'outcome_tier'</span>]).size().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-425"><a href="#cb26-425" aria-hidden="true" tabindex="-1"></a>    outcome_dist <span class="op">=</span> outcome_dist[[<span class="st">'Lost'</span>, <span class="st">'Near-Miss'</span>, <span class="st">'Success'</span>]]  <span class="co"># Order matters</span></span>
<span id="cb26-426"><a href="#cb26-426" aria-hidden="true" tabindex="-1"></a>    outcome_dist_pct <span class="op">=</span> outcome_dist.div(outcome_dist.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb26-427"><a href="#cb26-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-428"><a href="#cb26-428" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.arange(<span class="bu">len</span>(outcome_dist_pct.index))</span>
<span id="cb26-429"><a href="#cb26-429" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> <span class="fl">0.25</span></span>
<span id="cb26-430"><a href="#cb26-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-431"><a href="#cb26-431" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Failure'</span>], PROJECT_COLS[<span class="st">'Neutral'</span>], PROJECT_COLS[<span class="st">'Success'</span>]]</span>
<span id="cb26-432"><a href="#cb26-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-433"><a href="#cb26-433" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (col, color) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(outcome_dist_pct.columns, colors)):</span>
<span id="cb26-434"><a href="#cb26-434" aria-hidden="true" tabindex="-1"></a>        ax2.bar(x <span class="op">+</span> i<span class="op">*</span>width, outcome_dist_pct[col], width, label<span class="op">=</span>col, color<span class="op">=</span>color)</span>
<span id="cb26-435"><a href="#cb26-435" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, val <span class="kw">in</span> <span class="bu">enumerate</span>(outcome_dist_pct[col]):</span>
<span id="cb26-436"><a href="#cb26-436" aria-hidden="true" tabindex="-1"></a>            ax2.text(x[j] <span class="op">+</span> i<span class="op">*</span>width, val <span class="op">+</span> <span class="dv">1</span>, <span class="ss">f'</span><span class="sc">{</span>val<span class="sc">:.0f}</span><span class="ss">%'</span>, ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-437"><a href="#cb26-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-438"><a href="#cb26-438" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Percentage'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-439"><a href="#cb26-439" aria-hidden="true" tabindex="-1"></a>    ax2.set_xticks(x <span class="op">+</span> width)</span>
<span id="cb26-440"><a href="#cb26-440" aria-hidden="true" tabindex="-1"></a>    ax2.set_xticklabels(outcome_dist_pct.index)</span>
<span id="cb26-441"><a href="#cb26-441" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'Outcome Tiers: Success vs Near-Miss vs Lost'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-442"><a href="#cb26-442" aria-hidden="true" tabindex="-1"></a>    ax2.legend()</span>
<span id="cb26-443"><a href="#cb26-443" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylim(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb26-444"><a href="#cb26-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-445"><a href="#cb26-445" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-446"><a href="#cb26-446" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb26-447"><a href="#cb26-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-448"><a href="#cb26-448" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb26-449"><a href="#cb26-449" aria-hidden="true" tabindex="-1"></a>    plot_funnel_analysis(df)</span>
<span id="cb26-450"><a href="#cb26-450" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-451"><a href="#cb26-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-452"><a href="#cb26-452" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-453"><a href="#cb26-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-454"><a href="#cb26-454" aria-hidden="true" tabindex="-1"></a><span class="fu"># Signal Detection (Finding the Solution)</span></span>
<span id="cb26-455"><a href="#cb26-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-456"><a href="#cb26-456" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.1 Semantic Log-Odds (Decoding the "Buyer's Language")</span></span>
<span id="cb26-457"><a href="#cb26-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-458"><a href="#cb26-458" aria-hidden="true" tabindex="-1"></a>We use a technique called **Log-Odds Ratio Analysis**.</span>
<span id="cb26-459"><a href="#cb26-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-460"><a href="#cb26-460" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Concept:** We treat job titles as a "Bag of Words." We count how often "Manager" appears in successful leads vs. failed leads.</span>
<span id="cb26-461"><a href="#cb26-461" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**The Math:** If "Director" appears 5x more often in successful Mx leads than failed ones, it has a high positive log-odds.</span>
<span id="cb26-462"><a href="#cb26-462" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**The Insight:** This tells us *exactly* which keywords sales reps should search for on LinkedIn.</span>
<span id="cb26-463"><a href="#cb26-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-466"><a href="#cb26-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-467"><a href="#cb26-467" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: nlp-signal</span></span>
<span id="cb26-468"><a href="#cb26-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The Language of Buyers: Words on the right (Green) predict success. Words on the left (Orange) predict failure."</span></span>
<span id="cb26-469"><a href="#cb26-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-470"><a href="#cb26-470" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> semantic_log_odds(df, product_filter<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb26-471"><a href="#cb26-471" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product_filter].copy()</span>
<span id="cb26-472"><a href="#cb26-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-473"><a href="#cb26-473" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(subset) <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb26-474"><a href="#cb26-474" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb26-475"><a href="#cb26-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-476"><a href="#cb26-476" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Vectorize with bigrams for context</span></span>
<span id="cb26-477"><a href="#cb26-477" aria-hidden="true" tabindex="-1"></a>    vec <span class="op">=</span> CountVectorizer(stop_words<span class="op">=</span><span class="st">'english'</span>, min_df<span class="op">=</span><span class="dv">5</span>, ngram_range<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb26-478"><a href="#cb26-478" aria-hidden="true" tabindex="-1"></a>                          token_pattern<span class="op">=</span><span class="vs">r'</span><span class="dv">\b</span><span class="pp">[a-zA-Z]</span><span class="op">{2,}</span><span class="dv">\b</span><span class="vs">'</span>)</span>
<span id="cb26-479"><a href="#cb26-479" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> vec.fit_transform(subset[<span class="st">'contact_lead_title'</span>].fillna(<span class="st">''</span>))</span>
<span id="cb26-480"><a href="#cb26-480" aria-hidden="true" tabindex="-1"></a>    words <span class="op">=</span> np.array(vec.get_feature_names_out())</span>
<span id="cb26-481"><a href="#cb26-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-482"><a href="#cb26-482" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate frequencies with Laplace smoothing</span></span>
<span id="cb26-483"><a href="#cb26-483" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> subset[<span class="st">'is_success'</span>].values</span>
<span id="cb26-484"><a href="#cb26-484" aria-hidden="true" tabindex="-1"></a>    x_pos <span class="op">=</span> np.array(X[y<span class="op">==</span><span class="dv">1</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)).flatten() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb26-485"><a href="#cb26-485" aria-hidden="true" tabindex="-1"></a>    x_neg <span class="op">=</span> np.array(X[y<span class="op">==</span><span class="dv">0</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)).flatten() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb26-486"><a href="#cb26-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-487"><a href="#cb26-487" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log-Odds calculation</span></span>
<span id="cb26-488"><a href="#cb26-488" aria-hidden="true" tabindex="-1"></a>    p_pos <span class="op">=</span> x_pos <span class="op">/</span> x_pos.<span class="bu">sum</span>()</span>
<span id="cb26-489"><a href="#cb26-489" aria-hidden="true" tabindex="-1"></a>    p_neg <span class="op">=</span> x_neg <span class="op">/</span> x_neg.<span class="bu">sum</span>()</span>
<span id="cb26-490"><a href="#cb26-490" aria-hidden="true" tabindex="-1"></a>    log_odds <span class="op">=</span> np.log(p_pos <span class="op">/</span> p_neg)</span>
<span id="cb26-491"><a href="#cb26-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-492"><a href="#cb26-492" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> pd.DataFrame({</span>
<span id="cb26-493"><a href="#cb26-493" aria-hidden="true" tabindex="-1"></a>        <span class="st">'word'</span>: words,</span>
<span id="cb26-494"><a href="#cb26-494" aria-hidden="true" tabindex="-1"></a>        <span class="st">'log_odds'</span>: log_odds,</span>
<span id="cb26-495"><a href="#cb26-495" aria-hidden="true" tabindex="-1"></a>        <span class="st">'freq'</span>: x_pos <span class="op">+</span> x_neg <span class="op">-</span> <span class="dv">2</span>,  <span class="co"># Remove smoothing for display</span></span>
<span id="cb26-496"><a href="#cb26-496" aria-hidden="true" tabindex="-1"></a>        <span class="st">'n_words'</span>: [<span class="bu">len</span>(w.split()) <span class="cf">for</span> w <span class="kw">in</span> words]</span>
<span id="cb26-497"><a href="#cb26-497" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb26-498"><a href="#cb26-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-499"><a href="#cb26-499" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for significant volume</span></span>
<span id="cb26-500"><a href="#cb26-500" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> res[res[<span class="st">'freq'</span>] <span class="op">&gt;</span> <span class="dv">25</span>]</span>
<span id="cb26-501"><a href="#cb26-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-502"><a href="#cb26-502" aria-hidden="true" tabindex="-1"></a>    top_signals <span class="op">=</span> pd.concat([res.nlargest(<span class="dv">12</span>, <span class="st">'log_odds'</span>), res.nsmallest(<span class="dv">12</span>, <span class="st">'log_odds'</span>)])</span>
<span id="cb26-503"><a href="#cb26-503" aria-hidden="true" tabindex="-1"></a>    top_signals <span class="op">=</span> top_signals.sort_values(<span class="st">'log_odds'</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-504"><a href="#cb26-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-505"><a href="#cb26-505" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb26-506"><a href="#cb26-506" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))</span>
<span id="cb26-507"><a href="#cb26-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-508"><a href="#cb26-508" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>]</span>
<span id="cb26-509"><a href="#cb26-509" aria-hidden="true" tabindex="-1"></a>              <span class="cf">for</span> x <span class="kw">in</span> top_signals[<span class="st">'log_odds'</span>]]</span>
<span id="cb26-510"><a href="#cb26-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-511"><a href="#cb26-511" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(top_signals))</span>
<span id="cb26-512"><a href="#cb26-512" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(y_pos, top_signals[<span class="st">'log_odds'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb26-513"><a href="#cb26-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-514"><a href="#cb26-514" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add labels</span></span>
<span id="cb26-515"><a href="#cb26-515" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (idx, row) <span class="kw">in</span> <span class="bu">enumerate</span>(top_signals.iterrows()):</span>
<span id="cb26-516"><a href="#cb26-516" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'word'</span>]<span class="sc">}</span><span class="ss"> (n=</span><span class="sc">{</span><span class="bu">int</span>(row[<span class="st">'freq'</span>])<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb26-517"><a href="#cb26-517" aria-hidden="true" tabindex="-1"></a>        x_pos <span class="op">=</span> <span class="fl">0.02</span> <span class="cf">if</span> row[<span class="st">'log_odds'</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="op">-</span><span class="fl">0.02</span></span>
<span id="cb26-518"><a href="#cb26-518" aria-hidden="true" tabindex="-1"></a>        ha <span class="op">=</span> <span class="st">'left'</span> <span class="cf">if</span> row[<span class="st">'log_odds'</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'right'</span></span>
<span id="cb26-519"><a href="#cb26-519" aria-hidden="true" tabindex="-1"></a>        ax.text(x_pos, i, label, va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span>ha, fontsize<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-520"><a href="#cb26-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-521"><a href="#cb26-521" aria-hidden="true" tabindex="-1"></a>    ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb26-522"><a href="#cb26-522" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks([])</span>
<span id="cb26-523"><a href="#cb26-523" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Log-Odds Ratio (→ Higher Conversion | ← Lower Conversion)"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-524"><a href="#cb26-524" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"Semantic Signals for </span><span class="sc">{</span>product_filter<span class="sc">}</span><span class="ss">: The 'Deal Maker' vs. 'Deal Killer' Keywords"</span>,</span>
<span id="cb26-525"><a href="#cb26-525" aria-hidden="true" tabindex="-1"></a>                 fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-526"><a href="#cb26-526" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb26-527"><a href="#cb26-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-528"><a href="#cb26-528" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add legend box</span></span>
<span id="cb26-529"><a href="#cb26-529" aria-hidden="true" tabindex="-1"></a>    ax.text(<span class="fl">0.98</span>, <span class="fl">0.98</span>, <span class="st">'GREEN = Call These</span><span class="ch">\n</span><span class="st">ORANGE = Avoid These'</span>,</span>
<span id="cb26-530"><a href="#cb26-530" aria-hidden="true" tabindex="-1"></a>            transform<span class="op">=</span>ax.transAxes, fontsize<span class="op">=</span><span class="dv">11</span>, va<span class="op">=</span><span class="st">'top'</span>, ha<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb26-531"><a href="#cb26-531" aria-hidden="true" tabindex="-1"></a>            bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'round'</span>, facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.9</span>))</span>
<span id="cb26-532"><a href="#cb26-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-533"><a href="#cb26-533" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-534"><a href="#cb26-534" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb26-535"><a href="#cb26-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-536"><a href="#cb26-536" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">📞 CALL LIST (Top phrases predicting success):"</span>)</span>
<span id="cb26-537"><a href="#cb26-537" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(res.nlargest(<span class="dv">10</span>, <span class="st">'log_odds'</span>)[[<span class="st">'word'</span>, <span class="st">'log_odds'</span>, <span class="st">'freq'</span>]].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb26-538"><a href="#cb26-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-539"><a href="#cb26-539" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">⛔ AVOID LIST (Phrases predicting failure):"</span>)</span>
<span id="cb26-540"><a href="#cb26-540" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(res.nsmallest(<span class="dv">10</span>, <span class="st">'log_odds'</span>)[[<span class="st">'word'</span>, <span class="st">'log_odds'</span>, <span class="st">'freq'</span>]].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb26-541"><a href="#cb26-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-542"><a href="#cb26-542" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span>
<span id="cb26-543"><a href="#cb26-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-544"><a href="#cb26-544" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb26-545"><a href="#cb26-545" aria-hidden="true" tabindex="-1"></a>    semantic_results <span class="op">=</span> semantic_log_odds(df, <span class="st">'Mx'</span>)</span>
<span id="cb26-546"><a href="#cb26-546" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-547"><a href="#cb26-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-548"><a href="#cb26-548" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.2 The "Magic Quadrant" (Micro-Segment Discovery)</span></span>
<span id="cb26-549"><a href="#cb26-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-550"><a href="#cb26-550" aria-hidden="true" tabindex="-1"></a>A single variable is rarely the answer. We need to find the **Interaction Effects**. This heatmap intersects **Industry** (Rows) with **Manufacturing Model** (Columns).</span>
<span id="cb26-551"><a href="#cb26-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-552"><a href="#cb26-552" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Green Cells:** These are our "Honey Pots." The specific combinations where Mx conversion skyrockets.</span>
<span id="cb26-553"><a href="#cb26-553" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Action:** Marketing should redirect budget *exclusively* to these green zones.</span>
<span id="cb26-554"><a href="#cb26-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-557"><a href="#cb26-557" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-558"><a href="#cb26-558" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: magic-quadrant</span></span>
<span id="cb26-559"><a href="#cb26-559" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The Magic Quadrant: Identifying high-yield micro-segments for Mx."</span></span>
<span id="cb26-560"><a href="#cb26-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-561"><a href="#cb26-561" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> interaction_heatmap(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb26-562"><a href="#cb26-562" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product]</span>
<span id="cb26-563"><a href="#cb26-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-564"><a href="#cb26-564" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(subset) <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb26-565"><a href="#cb26-565" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb26-566"><a href="#cb26-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-567"><a href="#cb26-567" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pivot tables</span></span>
<span id="cb26-568"><a href="#cb26-568" aria-hidden="true" tabindex="-1"></a>    pivot_rate <span class="op">=</span> subset.pivot_table(index<span class="op">=</span><span class="st">'acct_target_industry'</span>,</span>
<span id="cb26-569"><a href="#cb26-569" aria-hidden="true" tabindex="-1"></a>                                    columns<span class="op">=</span><span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb26-570"><a href="#cb26-570" aria-hidden="true" tabindex="-1"></a>                                    values<span class="op">=</span><span class="st">'is_success'</span>,</span>
<span id="cb26-571"><a href="#cb26-571" aria-hidden="true" tabindex="-1"></a>                                    aggfunc<span class="op">=</span><span class="st">'mean'</span>)</span>
<span id="cb26-572"><a href="#cb26-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-573"><a href="#cb26-573" aria-hidden="true" tabindex="-1"></a>    pivot_n <span class="op">=</span> subset.pivot_table(index<span class="op">=</span><span class="st">'acct_target_industry'</span>,</span>
<span id="cb26-574"><a href="#cb26-574" aria-hidden="true" tabindex="-1"></a>                                 columns<span class="op">=</span><span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb26-575"><a href="#cb26-575" aria-hidden="true" tabindex="-1"></a>                                 values<span class="op">=</span><span class="st">'is_success'</span>,</span>
<span id="cb26-576"><a href="#cb26-576" aria-hidden="true" tabindex="-1"></a>                                 aggfunc<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb26-577"><a href="#cb26-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-578"><a href="#cb26-578" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create annotation with rate and n</span></span>
<span id="cb26-579"><a href="#cb26-579" aria-hidden="true" tabindex="-1"></a>    annot <span class="op">=</span> pivot_rate.copy().astype(<span class="bu">str</span>)</span>
<span id="cb26-580"><a href="#cb26-580" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> pivot_rate.index:</span>
<span id="cb26-581"><a href="#cb26-581" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> pivot_rate.columns:</span>
<span id="cb26-582"><a href="#cb26-582" aria-hidden="true" tabindex="-1"></a>            rate <span class="op">=</span> pivot_rate.loc[i, j]</span>
<span id="cb26-583"><a href="#cb26-583" aria-hidden="true" tabindex="-1"></a>            n <span class="op">=</span> pivot_n.loc[i, j] <span class="cf">if</span> pd.notna(pivot_n.loc[i, j]) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb26-584"><a href="#cb26-584" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pd.notna(rate) <span class="kw">and</span> n <span class="op">&gt;=</span> <span class="dv">15</span>:</span>
<span id="cb26-585"><a href="#cb26-585" aria-hidden="true" tabindex="-1"></a>                annot.loc[i, j] <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>rate<span class="sc">:.0%}</span><span class="ch">\n</span><span class="ss">(n=</span><span class="sc">{</span><span class="bu">int</span>(n)<span class="sc">}</span><span class="ss">)'</span></span>
<span id="cb26-586"><a href="#cb26-586" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb26-587"><a href="#cb26-587" aria-hidden="true" tabindex="-1"></a>                annot.loc[i, j] <span class="op">=</span> <span class="st">''</span></span>
<span id="cb26-588"><a href="#cb26-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-589"><a href="#cb26-589" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mask cells with low sample size</span></span>
<span id="cb26-590"><a href="#cb26-590" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> pivot_n <span class="op">&lt;</span> <span class="dv">15</span></span>
<span id="cb26-591"><a href="#cb26-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-592"><a href="#cb26-592" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))</span>
<span id="cb26-593"><a href="#cb26-593" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(pivot_rate, annot<span class="op">=</span>annot, fmt<span class="op">=</span><span class="st">''</span>, mask<span class="op">=</span>mask,</span>
<span id="cb26-594"><a href="#cb26-594" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">"RdYlGn"</span>, center<span class="op">=</span>subset[<span class="st">'is_success'</span>].mean(),</span>
<span id="cb26-595"><a href="#cb26-595" aria-hidden="true" tabindex="-1"></a>                cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Conversion Rate'</span>}, linewidths<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb26-596"><a href="#cb26-596" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"The 'Magic Quadrant' for </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">: Where do we Win?</span><span class="ch">\n</span><span class="ss">(Gray = Insufficient Data, n&lt;15)"</span>,</span>
<span id="cb26-597"><a href="#cb26-597" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-598"><a href="#cb26-598" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Industry Sector"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-599"><a href="#cb26-599" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Manufacturing Model"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-600"><a href="#cb26-600" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-601"><a href="#cb26-601" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb26-602"><a href="#cb26-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-603"><a href="#cb26-603" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find top segments</span></span>
<span id="cb26-604"><a href="#cb26-604" aria-hidden="true" tabindex="-1"></a>    pivot_flat <span class="op">=</span> pivot_rate.stack().reset_index()</span>
<span id="cb26-605"><a href="#cb26-605" aria-hidden="true" tabindex="-1"></a>    pivot_flat.columns <span class="op">=</span> [<span class="st">'Industry'</span>, <span class="st">'Model'</span>, <span class="st">'Rate'</span>]</span>
<span id="cb26-606"><a href="#cb26-606" aria-hidden="true" tabindex="-1"></a>    pivot_flat_n <span class="op">=</span> pivot_n.stack().reset_index()</span>
<span id="cb26-607"><a href="#cb26-607" aria-hidden="true" tabindex="-1"></a>    pivot_flat_n.columns <span class="op">=</span> [<span class="st">'Industry'</span>, <span class="st">'Model'</span>, <span class="st">'N'</span>]</span>
<span id="cb26-608"><a href="#cb26-608" aria-hidden="true" tabindex="-1"></a>    pivot_flat <span class="op">=</span> pivot_flat.merge(pivot_flat_n)</span>
<span id="cb26-609"><a href="#cb26-609" aria-hidden="true" tabindex="-1"></a>    pivot_flat <span class="op">=</span> pivot_flat[pivot_flat[<span class="st">'N'</span>] <span class="op">&gt;=</span> <span class="dv">15</span>].sort_values(<span class="st">'Rate'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-610"><a href="#cb26-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-611"><a href="#cb26-611" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🎯 TOP 5 SEGMENTS for </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> (n &gt;= 15):"</span>)</span>
<span id="cb26-612"><a href="#cb26-612" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(pivot_flat.head(<span class="dv">5</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb26-613"><a href="#cb26-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-614"><a href="#cb26-614" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb26-615"><a href="#cb26-615" aria-hidden="true" tabindex="-1"></a>    interaction_heatmap(df, <span class="st">'Mx'</span>)</span>
<span id="cb26-616"><a href="#cb26-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-617"><a href="#cb26-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-618"><a href="#cb26-618" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.3 The "Power Trio" Interaction</span></span>
<span id="cb26-619"><a href="#cb26-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-620"><a href="#cb26-620" aria-hidden="true" tabindex="-1"></a>Does **Seniority** matter more in **Operations** than in **Quality**?</span>
<span id="cb26-621"><a href="#cb26-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-624"><a href="#cb26-624" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-625"><a href="#cb26-625" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: power-trio</span></span>
<span id="cb26-626"><a href="#cb26-626" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The Power Trio: Function x Seniority interaction reveals the ICP."</span></span>
<span id="cb26-627"><a href="#cb26-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-628"><a href="#cb26-628" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_power_trio(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb26-629"><a href="#cb26-629" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb26-630"><a href="#cb26-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-631"><a href="#cb26-631" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to main categories</span></span>
<span id="cb26-632"><a href="#cb26-632" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> subset[subset[<span class="st">'title_function'</span>].isin([<span class="st">'Manufacturing/Ops'</span>, <span class="st">'Quality/Reg'</span>, <span class="st">'IT/Systems'</span>, <span class="st">'R&amp;D/Lab'</span>])]</span>
<span id="cb26-633"><a href="#cb26-633" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> subset[subset[<span class="st">'title_seniority'</span>].isin([<span class="st">'VP/Head'</span>, <span class="st">'Director'</span>, <span class="st">'Manager'</span>, <span class="st">'IC'</span>])]</span>
<span id="cb26-634"><a href="#cb26-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-635"><a href="#cb26-635" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(subset) <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb26-636"><a href="#cb26-636" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb26-637"><a href="#cb26-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-638"><a href="#cb26-638" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate rates with sample sizes</span></span>
<span id="cb26-639"><a href="#cb26-639" aria-hidden="true" tabindex="-1"></a>    viz <span class="op">=</span> subset.groupby([<span class="st">'title_function'</span>, <span class="st">'title_seniority'</span>]).agg(</span>
<span id="cb26-640"><a href="#cb26-640" aria-hidden="true" tabindex="-1"></a>        rate<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'mean'</span>),</span>
<span id="cb26-641"><a href="#cb26-641" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'size'</span>)</span>
<span id="cb26-642"><a href="#cb26-642" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb26-643"><a href="#cb26-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-644"><a href="#cb26-644" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for minimum sample size</span></span>
<span id="cb26-645"><a href="#cb26-645" aria-hidden="true" tabindex="-1"></a>    viz <span class="op">=</span> viz[viz[<span class="st">'n'</span>] <span class="op">&gt;=</span> <span class="dv">10</span>]</span>
<span id="cb26-646"><a href="#cb26-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-647"><a href="#cb26-647" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">7</span>))</span>
<span id="cb26-648"><a href="#cb26-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-649"><a href="#cb26-649" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LEFT: Grouped bar chart</span></span>
<span id="cb26-650"><a href="#cb26-650" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb26-651"><a href="#cb26-651" aria-hidden="true" tabindex="-1"></a>    pivot_viz <span class="op">=</span> viz.pivot(index<span class="op">=</span><span class="st">'title_function'</span>, columns<span class="op">=</span><span class="st">'title_seniority'</span>, values<span class="op">=</span><span class="st">'rate'</span>)</span>
<span id="cb26-652"><a href="#cb26-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-653"><a href="#cb26-653" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reorder columns by seniority</span></span>
<span id="cb26-654"><a href="#cb26-654" aria-hidden="true" tabindex="-1"></a>    col_order <span class="op">=</span> [<span class="st">'VP/Head'</span>, <span class="st">'Director'</span>, <span class="st">'Manager'</span>, <span class="st">'IC'</span>]</span>
<span id="cb26-655"><a href="#cb26-655" aria-hidden="true" tabindex="-1"></a>    pivot_viz <span class="op">=</span> pivot_viz[[c <span class="cf">for</span> c <span class="kw">in</span> col_order <span class="cf">if</span> c <span class="kw">in</span> pivot_viz.columns]]</span>
<span id="cb26-656"><a href="#cb26-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-657"><a href="#cb26-657" aria-hidden="true" tabindex="-1"></a>    pivot_viz.plot(kind<span class="op">=</span><span class="st">'bar'</span>, ax<span class="op">=</span>ax1, colormap<span class="op">=</span><span class="st">'viridis'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, width<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb26-658"><a href="#cb26-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-659"><a href="#cb26-659" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="ss">f"The ICP Formula: Which Title Level Works Best in Which Dept for </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">?"</span>,</span>
<span id="cb26-660"><a href="#cb26-660" aria-hidden="true" tabindex="-1"></a>                  fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-661"><a href="#cb26-661" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">"Conversion Rate"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-662"><a href="#cb26-662" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">""</span>)</span>
<span id="cb26-663"><a href="#cb26-663" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylim(<span class="dv">0</span>, <span class="fl">0.35</span>)</span>
<span id="cb26-664"><a href="#cb26-664" aria-hidden="true" tabindex="-1"></a>    ax1.legend(title<span class="op">=</span><span class="st">'Seniority Level'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb26-665"><a href="#cb26-665" aria-hidden="true" tabindex="-1"></a>    ax1.axhline(subset[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Avg'</span>)</span>
<span id="cb26-666"><a href="#cb26-666" aria-hidden="true" tabindex="-1"></a>    ax1.set_xticklabels(ax1.get_xticklabels(), rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb26-667"><a href="#cb26-667" aria-hidden="true" tabindex="-1"></a>    ax1.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb26-668"><a href="#cb26-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-669"><a href="#cb26-669" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RIGHT: Heatmap view</span></span>
<span id="cb26-670"><a href="#cb26-670" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb26-671"><a href="#cb26-671" aria-hidden="true" tabindex="-1"></a>    pivot_heatmap <span class="op">=</span> viz.pivot(index<span class="op">=</span><span class="st">'title_function'</span>, columns<span class="op">=</span><span class="st">'title_seniority'</span>, values<span class="op">=</span><span class="st">'rate'</span>)</span>
<span id="cb26-672"><a href="#cb26-672" aria-hidden="true" tabindex="-1"></a>    pivot_heatmap <span class="op">=</span> pivot_heatmap[[c <span class="cf">for</span> c <span class="kw">in</span> col_order <span class="cf">if</span> c <span class="kw">in</span> pivot_heatmap.columns]]</span>
<span id="cb26-673"><a href="#cb26-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-674"><a href="#cb26-674" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(pivot_heatmap, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.0%'</span>, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>,</span>
<span id="cb26-675"><a href="#cb26-675" aria-hidden="true" tabindex="-1"></a>                center<span class="op">=</span>subset[<span class="st">'is_success'</span>].mean(), ax<span class="op">=</span>ax2, linewidths<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb26-676"><a href="#cb26-676" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Conversion Rate: Function × Seniority'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-677"><a href="#cb26-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-678"><a href="#cb26-678" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-679"><a href="#cb26-679" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb26-680"><a href="#cb26-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-681"><a href="#cb26-681" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb26-682"><a href="#cb26-682" aria-hidden="true" tabindex="-1"></a>    plot_power_trio(df, <span class="st">'Mx'</span>)</span>
<span id="cb26-683"><a href="#cb26-683" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-684"><a href="#cb26-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-685"><a href="#cb26-685" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.4 Power Scope Analysis (Global vs Site)</span></span>
<span id="cb26-686"><a href="#cb26-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-687"><a href="#cb26-687" aria-hidden="true" tabindex="-1"></a>Does having "Global" in your title make you a better Mx buyer?</span>
<span id="cb26-688"><a href="#cb26-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-691"><a href="#cb26-691" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-692"><a href="#cb26-692" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: scope-analysis</span></span>
<span id="cb26-693"><a href="#cb26-693" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Power Scope: Do 'Global' titles convert better than 'Site' titles?"</span></span>
<span id="cb26-694"><a href="#cb26-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-695"><a href="#cb26-695" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_scope(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb26-696"><a href="#cb26-696" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb26-697"><a href="#cb26-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-698"><a href="#cb26-698" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(subset) <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb26-699"><a href="#cb26-699" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb26-700"><a href="#cb26-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-701"><a href="#cb26-701" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate stats by scope</span></span>
<span id="cb26-702"><a href="#cb26-702" aria-hidden="true" tabindex="-1"></a>    scope_stats <span class="op">=</span> subset.groupby(<span class="st">'title_scope'</span>).agg(</span>
<span id="cb26-703"><a href="#cb26-703" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'size'</span>),</span>
<span id="cb26-704"><a href="#cb26-704" aria-hidden="true" tabindex="-1"></a>        successes<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'sum'</span>)</span>
<span id="cb26-705"><a href="#cb26-705" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb26-706"><a href="#cb26-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-707"><a href="#cb26-707" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add Bayesian estimates</span></span>
<span id="cb26-708"><a href="#cb26-708" aria-hidden="true" tabindex="-1"></a>    scope_stats[<span class="st">'rate'</span>] <span class="op">=</span> scope_stats.<span class="bu">apply</span>(</span>
<span id="cb26-709"><a href="#cb26-709" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">0</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-710"><a href="#cb26-710" aria-hidden="true" tabindex="-1"></a>    scope_stats[<span class="st">'ci_low'</span>] <span class="op">=</span> scope_stats.<span class="bu">apply</span>(</span>
<span id="cb26-711"><a href="#cb26-711" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">1</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-712"><a href="#cb26-712" aria-hidden="true" tabindex="-1"></a>    scope_stats[<span class="st">'ci_high'</span>] <span class="op">=</span> scope_stats.<span class="bu">apply</span>(</span>
<span id="cb26-713"><a href="#cb26-713" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> r: bayesian_conversion_rate(r[<span class="st">'successes'</span>], r[<span class="st">'n'</span>])[<span class="dv">2</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-714"><a href="#cb26-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-715"><a href="#cb26-715" aria-hidden="true" tabindex="-1"></a>    scope_stats <span class="op">=</span> scope_stats.sort_values(<span class="st">'rate'</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-716"><a href="#cb26-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-717"><a href="#cb26-717" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb26-718"><a href="#cb26-718" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb26-719"><a href="#cb26-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-720"><a href="#cb26-720" aria-hidden="true" tabindex="-1"></a>    y_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(scope_stats))</span>
<span id="cb26-721"><a href="#cb26-721" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> r <span class="op">&gt;</span> subset[<span class="st">'is_success'</span>].mean()</span>
<span id="cb26-722"><a href="#cb26-722" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>] <span class="cf">for</span> r <span class="kw">in</span> scope_stats[<span class="st">'rate'</span>]]</span>
<span id="cb26-723"><a href="#cb26-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-724"><a href="#cb26-724" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(y_pos, scope_stats[<span class="st">'rate'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>, height<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb26-725"><a href="#cb26-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-726"><a href="#cb26-726" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Error bars and labels</span></span>
<span id="cb26-727"><a href="#cb26-727" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> scope_stats.iterrows():</span>
<span id="cb26-728"><a href="#cb26-728" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="bu">list</span>(scope_stats.index).index(i)</span>
<span id="cb26-729"><a href="#cb26-729" aria-hidden="true" tabindex="-1"></a>        ax.plot([row[<span class="st">'ci_low'</span>], row[<span class="st">'ci_high'</span>]], [idx, idx], color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb26-730"><a href="#cb26-730" aria-hidden="true" tabindex="-1"></a>        ax.text(row[<span class="st">'rate'</span>] <span class="op">+</span> <span class="fl">0.01</span>, idx, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'rate'</span>]<span class="sc">:.1%}</span><span class="ss"> (n=</span><span class="sc">{</span>row[<span class="st">'n'</span>]<span class="sc">:,}</span><span class="ss">)"</span>,</span>
<span id="cb26-731"><a href="#cb26-731" aria-hidden="true" tabindex="-1"></a>               va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-732"><a href="#cb26-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-733"><a href="#cb26-733" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(y_pos)</span>
<span id="cb26-734"><a href="#cb26-734" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(scope_stats[<span class="st">'title_scope'</span>], fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-735"><a href="#cb26-735" aria-hidden="true" tabindex="-1"></a>    ax.axvline(x<span class="op">=</span>subset[<span class="st">'is_success'</span>].mean(), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>,</span>
<span id="cb26-736"><a href="#cb26-736" aria-hidden="true" tabindex="-1"></a>               alpha<span class="op">=</span><span class="fl">0.7</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Average'</span>)</span>
<span id="cb26-737"><a href="#cb26-737" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Conversion Rate'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-738"><a href="#cb26-738" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'Impact of Title Scope on </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Conversion</span><span class="ch">\n</span><span class="ss">("Global VP" vs "Site Manager")'</span>,</span>
<span id="cb26-739"><a href="#cb26-739" aria-hidden="true" tabindex="-1"></a>                fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb26-740"><a href="#cb26-740" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'lower right'</span>)</span>
<span id="cb26-741"><a href="#cb26-741" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="dv">0</span>, <span class="fl">0.30</span>)</span>
<span id="cb26-742"><a href="#cb26-742" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb26-743"><a href="#cb26-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-744"><a href="#cb26-744" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-745"><a href="#cb26-745" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb26-746"><a href="#cb26-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-747"><a href="#cb26-747" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate lift</span></span>
<span id="cb26-748"><a href="#cb26-748" aria-hidden="true" tabindex="-1"></a>    global_rate <span class="op">=</span> scope_stats[scope_stats[<span class="st">'title_scope'</span>] <span class="op">==</span> <span class="st">'Global'</span>][<span class="st">'rate'</span>].values</span>
<span id="cb26-749"><a href="#cb26-749" aria-hidden="true" tabindex="-1"></a>    standard_rate <span class="op">=</span> scope_stats[scope_stats[<span class="st">'title_scope'</span>] <span class="op">==</span> <span class="st">'Standard'</span>][<span class="st">'rate'</span>].values</span>
<span id="cb26-750"><a href="#cb26-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-751"><a href="#cb26-751" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(global_rate) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="bu">len</span>(standard_rate) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> standard_rate[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb26-752"><a href="#cb26-752" aria-hidden="true" tabindex="-1"></a>        lift <span class="op">=</span> global_rate[<span class="dv">0</span>] <span class="op">/</span> standard_rate[<span class="dv">0</span>]</span>
<span id="cb26-753"><a href="#cb26-753" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🎯 KEY FINDING: 'Global' titles show </span><span class="sc">{</span>lift<span class="sc">:.1f}</span><span class="ss">x conversion lift vs Standard"</span>)</span>
<span id="cb26-754"><a href="#cb26-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-755"><a href="#cb26-755" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb26-756"><a href="#cb26-756" aria-hidden="true" tabindex="-1"></a>    analyze_scope(df, <span class="st">'Mx'</span>)</span>
<span id="cb26-757"><a href="#cb26-757" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-758"><a href="#cb26-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-759"><a href="#cb26-759" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.5 Pipeline Velocity Analysis</span></span>
<span id="cb26-760"><a href="#cb26-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-761"><a href="#cb26-761" aria-hidden="true" tabindex="-1"></a>Are Mx leads slower to convert? This tells us if the problem is targeting or sales enablement.</span>
<span id="cb26-762"><a href="#cb26-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-765"><a href="#cb26-765" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-766"><a href="#cb26-766" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: velocity</span></span>
<span id="cb26-767"><a href="#cb26-767" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Pipeline Velocity: Are Mx leads stalling longer than Qx?"</span></span>
<span id="cb26-768"><a href="#cb26-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-769"><a href="#cb26-769" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_velocity(df):</span>
<span id="cb26-770"><a href="#cb26-770" aria-hidden="true" tabindex="-1"></a>    df_velocity <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])].copy()</span>
<span id="cb26-771"><a href="#cb26-771" aria-hidden="true" tabindex="-1"></a>    df_success <span class="op">=</span> df_velocity[df_velocity[<span class="st">'is_success'</span>] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb26-772"><a href="#cb26-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-773"><a href="#cb26-773" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_success) <span class="op">&lt;</span> <span class="dv">20</span>:</span>
<span id="cb26-774"><a href="#cb26-774" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb26-775"><a href="#cb26-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-776"><a href="#cb26-776" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Stats by product</span></span>
<span id="cb26-777"><a href="#cb26-777" aria-hidden="true" tabindex="-1"></a>    velocity_stats <span class="op">=</span> df_success.groupby(<span class="st">'product_segment'</span>).agg(</span>
<span id="cb26-778"><a href="#cb26-778" aria-hidden="true" tabindex="-1"></a>        median_age<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="st">'median'</span>),</span>
<span id="cb26-779"><a href="#cb26-779" aria-hidden="true" tabindex="-1"></a>        mean_age<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="st">'mean'</span>),</span>
<span id="cb26-780"><a href="#cb26-780" aria-hidden="true" tabindex="-1"></a>        p25<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.25</span>)),</span>
<span id="cb26-781"><a href="#cb26-781" aria-hidden="true" tabindex="-1"></a>        p75<span class="op">=</span>(<span class="st">'lead_age_days'</span>, <span class="kw">lambda</span> x: x.quantile(<span class="fl">0.75</span>)),</span>
<span id="cb26-782"><a href="#cb26-782" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'sum'</span>)</span>
<span id="cb26-783"><a href="#cb26-783" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb26-784"><a href="#cb26-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-785"><a href="#cb26-785" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb26-786"><a href="#cb26-786" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"PIPELINE VELOCITY ANALYSIS"</span>)</span>
<span id="cb26-787"><a href="#cb26-787" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb26-788"><a href="#cb26-788" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(velocity_stats.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb26-789"><a href="#cb26-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-790"><a href="#cb26-790" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb26-791"><a href="#cb26-791" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb26-792"><a href="#cb26-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-793"><a href="#cb26-793" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LEFT: Distribution</span></span>
<span id="cb26-794"><a href="#cb26-794" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb26-795"><a href="#cb26-795" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> product, color <span class="kw">in</span> [(<span class="st">'Mx'</span>, PROJECT_COLS[<span class="st">'Mx'</span>]), (<span class="st">'Qx'</span>, PROJECT_COLS[<span class="st">'Qx'</span>])]:</span>
<span id="cb26-796"><a href="#cb26-796" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>] <span class="op">==</span> product][<span class="st">'lead_age_days'</span>].dropna()</span>
<span id="cb26-797"><a href="#cb26-797" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(data) <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb26-798"><a href="#cb26-798" aria-hidden="true" tabindex="-1"></a>            ax1.hist(data, bins<span class="op">=</span><span class="dv">25</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> (n=</span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss">)'</span>,</span>
<span id="cb26-799"><a href="#cb26-799" aria-hidden="true" tabindex="-1"></a>                    color<span class="op">=</span>color, density<span class="op">=</span><span class="va">True</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb26-800"><a href="#cb26-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-801"><a href="#cb26-801" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Lead Age at Conversion (Days)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb26-802"><a href="#cb26-802" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Density'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb26-803"><a href="#cb26-803" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'Time-to-Convert Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-804"><a href="#cb26-804" aria-hidden="true" tabindex="-1"></a>    ax1.legend()</span>
<span id="cb26-805"><a href="#cb26-805" aria-hidden="true" tabindex="-1"></a>    ax1.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb26-806"><a href="#cb26-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-807"><a href="#cb26-807" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RIGHT: Box plot</span></span>
<span id="cb26-808"><a href="#cb26-808" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb26-809"><a href="#cb26-809" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="op">=</span> df_success[[<span class="st">'product_segment'</span>, <span class="st">'lead_age_days'</span>]].dropna()</span>
<span id="cb26-810"><a href="#cb26-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-811"><a href="#cb26-811" aria-hidden="true" tabindex="-1"></a>    bp <span class="op">=</span> df_plot.boxplot(column<span class="op">=</span><span class="st">'lead_age_days'</span>, by<span class="op">=</span><span class="st">'product_segment'</span>, ax<span class="op">=</span>ax2,</span>
<span id="cb26-812"><a href="#cb26-812" aria-hidden="true" tabindex="-1"></a>                         patch_artist<span class="op">=</span><span class="va">True</span>, return_type<span class="op">=</span><span class="st">'dict'</span>)</span>
<span id="cb26-813"><a href="#cb26-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-814"><a href="#cb26-814" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Mx'</span>], PROJECT_COLS[<span class="st">'Qx'</span>]]</span>
<span id="cb26-815"><a href="#cb26-815" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> patch, color <span class="kw">in</span> <span class="bu">zip</span>(bp[<span class="st">'lead_age_days'</span>][<span class="st">'boxes'</span>], colors):</span>
<span id="cb26-816"><a href="#cb26-816" aria-hidden="true" tabindex="-1"></a>        patch.set_facecolor(color)</span>
<span id="cb26-817"><a href="#cb26-817" aria-hidden="true" tabindex="-1"></a>        patch.set_alpha(<span class="fl">0.7</span>)</span>
<span id="cb26-818"><a href="#cb26-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-819"><a href="#cb26-819" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'Product'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb26-820"><a href="#cb26-820" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Lead Age (Days)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb26-821"><a href="#cb26-821" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'Time-to-Convert Comparison'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-822"><a href="#cb26-822" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="st">''</span>)</span>
<span id="cb26-823"><a href="#cb26-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-824"><a href="#cb26-824" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-825"><a href="#cb26-825" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb26-826"><a href="#cb26-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-827"><a href="#cb26-827" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Statistical test</span></span>
<span id="cb26-828"><a href="#cb26-828" aria-hidden="true" tabindex="-1"></a>    mx_ages <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>][<span class="st">'lead_age_days'</span>].dropna()</span>
<span id="cb26-829"><a href="#cb26-829" aria-hidden="true" tabindex="-1"></a>    qx_ages <span class="op">=</span> df_success[df_success[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Qx'</span>][<span class="st">'lead_age_days'</span>].dropna()</span>
<span id="cb26-830"><a href="#cb26-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-831"><a href="#cb26-831" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mx_ages) <span class="op">&gt;</span> <span class="dv">5</span> <span class="kw">and</span> <span class="bu">len</span>(qx_ages) <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb26-832"><a href="#cb26-832" aria-hidden="true" tabindex="-1"></a>        stat, p_val <span class="op">=</span> mannwhitneyu(mx_ages, qx_ages, alternative<span class="op">=</span><span class="st">'two-sided'</span>)</span>
<span id="cb26-833"><a href="#cb26-833" aria-hidden="true" tabindex="-1"></a>        mx_med <span class="op">=</span> mx_ages.median()</span>
<span id="cb26-834"><a href="#cb26-834" aria-hidden="true" tabindex="-1"></a>        qx_med <span class="op">=</span> qx_ages.median()</span>
<span id="cb26-835"><a href="#cb26-835" aria-hidden="true" tabindex="-1"></a>        diff <span class="op">=</span> mx_med <span class="op">-</span> qx_med</span>
<span id="cb26-836"><a href="#cb26-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-837"><a href="#cb26-837" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🚨 KEY FINDING: Mx deals take </span><span class="sc">{</span><span class="bu">abs</span>(diff)<span class="sc">:.0f}</span><span class="ss"> days </span><span class="sc">{</span><span class="st">'longer'</span> <span class="cf">if</span> diff <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'shorter'</span><span class="sc">}</span><span class="ss"> (median)"</span>)</span>
<span id="cb26-838"><a href="#cb26-838" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   Mann-Whitney p-value: </span><span class="sc">{</span>p_val<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb26-839"><a href="#cb26-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-840"><a href="#cb26-840" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb26-841"><a href="#cb26-841" aria-hidden="true" tabindex="-1"></a>    analyze_velocity(df)</span>
<span id="cb26-842"><a href="#cb26-842" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-843"><a href="#cb26-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-844"><a href="#cb26-844" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.6 Driver Analysis (Entropy Scoring)</span></span>
<span id="cb26-845"><a href="#cb26-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-846"><a href="#cb26-846" aria-hidden="true" tabindex="-1"></a>We use **Mutual Information (Information Theory)** to mathematically rank which features are the strongest predictors.</span>
<span id="cb26-847"><a href="#cb26-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-850"><a href="#cb26-850" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-851"><a href="#cb26-851" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: feature-importance</span></span>
<span id="cb26-852"><a href="#cb26-852" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Driver Rank: Mathematical importance of each feature based on Mutual Information."</span></span>
<span id="cb26-853"><a href="#cb26-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-854"><a href="#cb26-854" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rank_features(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb26-855"><a href="#cb26-855" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> product:</span>
<span id="cb26-856"><a href="#cb26-856" aria-hidden="true" tabindex="-1"></a>        subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb26-857"><a href="#cb26-857" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-858"><a href="#cb26-858" aria-hidden="true" tabindex="-1"></a>        subset <span class="op">=</span> df.copy()</span>
<span id="cb26-859"><a href="#cb26-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-860"><a href="#cb26-860" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select features</span></span>
<span id="cb26-861"><a href="#cb26-861" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [<span class="st">'acct_target_industry'</span>, <span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb26-862"><a href="#cb26-862" aria-hidden="true" tabindex="-1"></a>                <span class="st">'title_seniority'</span>, <span class="st">'title_function'</span>, <span class="st">'title_scope'</span>,</span>
<span id="cb26-863"><a href="#cb26-863" aria-hidden="true" tabindex="-1"></a>                <span class="st">'is_decision_maker'</span>, <span class="st">'completeness_tier'</span>,</span>
<span id="cb26-864"><a href="#cb26-864" aria-hidden="true" tabindex="-1"></a>                <span class="st">'priority'</span>, <span class="st">'last_tactic_campaign_channel'</span>]</span>
<span id="cb26-865"><a href="#cb26-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-866"><a href="#cb26-866" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> features <span class="cf">if</span> f <span class="kw">in</span> subset.columns]</span>
<span id="cb26-867"><a href="#cb26-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-868"><a href="#cb26-868" aria-hidden="true" tabindex="-1"></a>    clean_df <span class="op">=</span> subset.dropna(subset<span class="op">=</span>features)</span>
<span id="cb26-869"><a href="#cb26-869" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(clean_df) <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb26-870"><a href="#cb26-870" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb26-871"><a href="#cb26-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-872"><a href="#cb26-872" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> clean_df[features].astype(<span class="bu">str</span>).<span class="bu">apply</span>(LabelEncoder().fit_transform)</span>
<span id="cb26-873"><a href="#cb26-873" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> clean_df[<span class="st">'is_success'</span>]</span>
<span id="cb26-874"><a href="#cb26-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-875"><a href="#cb26-875" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate Mutual Information</span></span>
<span id="cb26-876"><a href="#cb26-876" aria-hidden="true" tabindex="-1"></a>    mi <span class="op">=</span> mutual_info_classif(X, y, discrete_features<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb26-877"><a href="#cb26-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-878"><a href="#cb26-878" aria-hidden="true" tabindex="-1"></a>    mi_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb26-879"><a href="#cb26-879" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Feature'</span>: features,</span>
<span id="cb26-880"><a href="#cb26-880" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Importance'</span>: mi</span>
<span id="cb26-881"><a href="#cb26-881" aria-hidden="true" tabindex="-1"></a>    }).sort_values(<span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-882"><a href="#cb26-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-883"><a href="#cb26-883" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb26-884"><a href="#cb26-884" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"FEATURE IMPORTANCE (</span><span class="sc">{</span>product <span class="cf">if</span> product <span class="cf">else</span> <span class="st">'All'</span><span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb26-885"><a href="#cb26-885" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb26-886"><a href="#cb26-886" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(mi_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb26-887"><a href="#cb26-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-888"><a href="#cb26-888" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualization</span></span>
<span id="cb26-889"><a href="#cb26-889" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb26-890"><a href="#cb26-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-891"><a href="#cb26-891" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> imp <span class="op">&gt;</span> mi_df[<span class="st">'Importance'</span>].median()</span>
<span id="cb26-892"><a href="#cb26-892" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span> PROJECT_COLS[<span class="st">'Neutral'</span>] <span class="cf">for</span> imp <span class="kw">in</span> mi_df[<span class="st">'Importance'</span>]]</span>
<span id="cb26-893"><a href="#cb26-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-894"><a href="#cb26-894" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(<span class="bu">range</span>(<span class="bu">len</span>(mi_df)), mi_df[<span class="st">'Importance'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb26-895"><a href="#cb26-895" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(mi_df)))</span>
<span id="cb26-896"><a href="#cb26-896" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(mi_df[<span class="st">'Feature'</span>], fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb26-897"><a href="#cb26-897" aria-hidden="true" tabindex="-1"></a>    ax.invert_yaxis()</span>
<span id="cb26-898"><a href="#cb26-898" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Mutual Information Score (bits)"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb26-899"><a href="#cb26-899" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"Driver Analysis: Which attributes drive </span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> conversion?"</span>,</span>
<span id="cb26-900"><a href="#cb26-900" aria-hidden="true" tabindex="-1"></a>                 fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-901"><a href="#cb26-901" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb26-902"><a href="#cb26-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-903"><a href="#cb26-903" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add value labels</span></span>
<span id="cb26-904"><a href="#cb26-904" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (imp, feat) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(mi_df[<span class="st">'Importance'</span>], mi_df[<span class="st">'Feature'</span>])):</span>
<span id="cb26-905"><a href="#cb26-905" aria-hidden="true" tabindex="-1"></a>        ax.text(imp <span class="op">+</span> <span class="fl">0.001</span>, i, <span class="ss">f'</span><span class="sc">{</span>imp<span class="sc">:.4f}</span><span class="ss">'</span>, va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb26-906"><a href="#cb26-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-907"><a href="#cb26-907" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-908"><a href="#cb26-908" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb26-909"><a href="#cb26-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-910"><a href="#cb26-910" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mi_df</span>
<span id="cb26-911"><a href="#cb26-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-912"><a href="#cb26-912" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb26-913"><a href="#cb26-913" aria-hidden="true" tabindex="-1"></a>    mi_results <span class="op">=</span> rank_features(df, <span class="st">'Mx'</span>)</span>
<span id="cb26-914"><a href="#cb26-914" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-915"><a href="#cb26-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-916"><a href="#cb26-916" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5.7 Decision Tree: Algorithmic Segment Discovery</span></span>
<span id="cb26-917"><a href="#cb26-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-918"><a href="#cb26-918" aria-hidden="true" tabindex="-1"></a>Let the algorithm find the optimal targeting rules automatically.</span>
<span id="cb26-919"><a href="#cb26-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-922"><a href="#cb26-922" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-923"><a href="#cb26-923" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: decision-tree</span></span>
<span id="cb26-924"><a href="#cb26-924" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Algorithmic targeting: The machine finds segments humans miss."</span></span>
<span id="cb26-925"><a href="#cb26-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-926"><a href="#cb26-926" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> discover_rules(df, product<span class="op">=</span><span class="st">'Mx'</span>):</span>
<span id="cb26-927"><a href="#cb26-927" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> product].copy()</span>
<span id="cb26-928"><a href="#cb26-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-929"><a href="#cb26-929" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [<span class="st">'title_seniority'</span>, <span class="st">'title_function'</span>, <span class="st">'acct_target_industry'</span>,</span>
<span id="cb26-930"><a href="#cb26-930" aria-hidden="true" tabindex="-1"></a>                <span class="st">'acct_manufacturing_model'</span>, <span class="st">'title_scope'</span>]</span>
<span id="cb26-931"><a href="#cb26-931" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> features <span class="cf">if</span> f <span class="kw">in</span> subset.columns]</span>
<span id="cb26-932"><a href="#cb26-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-933"><a href="#cb26-933" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Encode</span></span>
<span id="cb26-934"><a href="#cb26-934" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> subset[features].astype(<span class="bu">str</span>).copy()</span>
<span id="cb26-935"><a href="#cb26-935" aria-hidden="true" tabindex="-1"></a>    encoders <span class="op">=</span> {}</span>
<span id="cb26-936"><a href="#cb26-936" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> features:</span>
<span id="cb26-937"><a href="#cb26-937" aria-hidden="true" tabindex="-1"></a>        le <span class="op">=</span> LabelEncoder()</span>
<span id="cb26-938"><a href="#cb26-938" aria-hidden="true" tabindex="-1"></a>        X[col] <span class="op">=</span> le.fit_transform(X[col])</span>
<span id="cb26-939"><a href="#cb26-939" aria-hidden="true" tabindex="-1"></a>        encoders[col] <span class="op">=</span> le</span>
<span id="cb26-940"><a href="#cb26-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-941"><a href="#cb26-941" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> subset[<span class="st">'is_success'</span>]</span>
<span id="cb26-942"><a href="#cb26-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-943"><a href="#cb26-943" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit tree</span></span>
<span id="cb26-944"><a href="#cb26-944" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">3</span>, min_samples_leaf<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb26-945"><a href="#cb26-945" aria-hidden="true" tabindex="-1"></a>                                   min_samples_split<span class="op">=</span><span class="dv">60</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb26-946"><a href="#cb26-946" aria-hidden="true" tabindex="-1"></a>    tree.fit(X, y)</span>
<span id="cb26-947"><a href="#cb26-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-948"><a href="#cb26-948" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feature importance from tree</span></span>
<span id="cb26-949"><a href="#cb26-949" aria-hidden="true" tabindex="-1"></a>    importance <span class="op">=</span> pd.DataFrame({</span>
<span id="cb26-950"><a href="#cb26-950" aria-hidden="true" tabindex="-1"></a>        <span class="st">'feature'</span>: features,</span>
<span id="cb26-951"><a href="#cb26-951" aria-hidden="true" tabindex="-1"></a>        <span class="st">'importance'</span>: tree.feature_importances_</span>
<span id="cb26-952"><a href="#cb26-952" aria-hidden="true" tabindex="-1"></a>    }).sort_values(<span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-953"><a href="#cb26-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-954"><a href="#cb26-954" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb26-955"><a href="#cb26-955" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"DECISION TREE FEATURE IMPORTANCE (</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb26-956"><a href="#cb26-956" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb26-957"><a href="#cb26-957" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(importance.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb26-958"><a href="#cb26-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-959"><a href="#cb26-959" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualize tree</span></span>
<span id="cb26-960"><a href="#cb26-960" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb26-961"><a href="#cb26-961" aria-hidden="true" tabindex="-1"></a>    plot_tree(tree, feature_names<span class="op">=</span>features, class_names<span class="op">=</span>[<span class="st">'Fail'</span>, <span class="st">'Success'</span>],</span>
<span id="cb26-962"><a href="#cb26-962" aria-hidden="true" tabindex="-1"></a>              filled<span class="op">=</span><span class="va">True</span>, rounded<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax, fontsize<span class="op">=</span><span class="dv">10</span>, max_depth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb26-963"><a href="#cb26-963" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss"> Targeting Decision Rules</span><span class="ch">\n</span><span class="ss">(Read: IF condition THEN outcome)'</span>,</span>
<span id="cb26-964"><a href="#cb26-964" aria-hidden="true" tabindex="-1"></a>                 fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb26-965"><a href="#cb26-965" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-966"><a href="#cb26-966" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb26-967"><a href="#cb26-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-968"><a href="#cb26-968" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tree, importance</span>
<span id="cb26-969"><a href="#cb26-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-970"><a href="#cb26-970" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb26-971"><a href="#cb26-971" aria-hidden="true" tabindex="-1"></a>    tree_model, tree_importance <span class="op">=</span> discover_rules(df, <span class="st">'Mx'</span>)</span>
<span id="cb26-972"><a href="#cb26-972" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-973"><a href="#cb26-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-974"><a href="#cb26-974" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-975"><a href="#cb26-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-976"><a href="#cb26-976" aria-hidden="true" tabindex="-1"></a><span class="fu"># The "Zombie" Lead Opportunity</span></span>
<span id="cb26-977"><a href="#cb26-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-978"><a href="#cb26-978" aria-hidden="true" tabindex="-1"></a>"Recycled" leads are NOT failures - they're timing mismatches. This is a nurture campaign opportunity.</span>
<span id="cb26-979"><a href="#cb26-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-982"><a href="#cb26-982" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-983"><a href="#cb26-983" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: zombie-analysis</span></span>
<span id="cb26-984"><a href="#cb26-984" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Zombie Leads: Where are we recycling high-potential prospects?"</span></span>
<span id="cb26-985"><a href="#cb26-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-986"><a href="#cb26-986" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_zombies(df):</span>
<span id="cb26-987"><a href="#cb26-987" aria-hidden="true" tabindex="-1"></a>    df_products <span class="op">=</span> df[df[<span class="st">'product_segment'</span>].isin([<span class="st">'Mx'</span>, <span class="st">'Qx'</span>])].copy()</span>
<span id="cb26-988"><a href="#cb26-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-989"><a href="#cb26-989" aria-hidden="true" tabindex="-1"></a>    mx_zombies <span class="op">=</span> df_products[(df_products[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>) <span class="op">&amp;</span></span>
<span id="cb26-990"><a href="#cb26-990" aria-hidden="true" tabindex="-1"></a>                              (df_products[<span class="st">'outcome_tier'</span>] <span class="op">==</span> <span class="st">'Near-Miss'</span>)]</span>
<span id="cb26-991"><a href="#cb26-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-992"><a href="#cb26-992" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mx_zombies) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb26-993"><a href="#cb26-993" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb26-994"><a href="#cb26-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-995"><a href="#cb26-995" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))</span>
<span id="cb26-996"><a href="#cb26-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-997"><a href="#cb26-997" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top-left: Zombies by industry</span></span>
<span id="cb26-998"><a href="#cb26-998" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb26-999"><a href="#cb26-999" aria-hidden="true" tabindex="-1"></a>    zombie_industry <span class="op">=</span> mx_zombies[<span class="st">'acct_target_industry'</span>].value_counts().head(<span class="dv">8</span>)</span>
<span id="cb26-1000"><a href="#cb26-1000" aria-hidden="true" tabindex="-1"></a>    zombie_industry.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax1, color<span class="op">=</span>PROJECT_COLS[<span class="st">'Neutral'</span>])</span>
<span id="cb26-1001"><a href="#cb26-1001" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Count of Recycled Leads'</span>)</span>
<span id="cb26-1002"><a href="#cb26-1002" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'Mx "Zombie" Leads by Industry</span><span class="ch">\n</span><span class="st">(Nurture Campaign Targets)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-1003"><a href="#cb26-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1004"><a href="#cb26-1004" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top-right: Zombies by seniority</span></span>
<span id="cb26-1005"><a href="#cb26-1005" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb26-1006"><a href="#cb26-1006" aria-hidden="true" tabindex="-1"></a>    zombie_seniority <span class="op">=</span> mx_zombies[<span class="st">'title_seniority'</span>].value_counts()</span>
<span id="cb26-1007"><a href="#cb26-1007" aria-hidden="true" tabindex="-1"></a>    zombie_seniority.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax2, color<span class="op">=</span>PROJECT_COLS[<span class="st">'Highlight'</span>])</span>
<span id="cb26-1008"><a href="#cb26-1008" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'Count of Recycled Leads'</span>)</span>
<span id="cb26-1009"><a href="#cb26-1009" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'Mx "Zombie" Leads by Seniority'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-1010"><a href="#cb26-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1011"><a href="#cb26-1011" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bottom-left: Zombies by function</span></span>
<span id="cb26-1012"><a href="#cb26-1012" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>]</span>
<span id="cb26-1013"><a href="#cb26-1013" aria-hidden="true" tabindex="-1"></a>    zombie_function <span class="op">=</span> mx_zombies[<span class="st">'title_function'</span>].value_counts()</span>
<span id="cb26-1014"><a href="#cb26-1014" aria-hidden="true" tabindex="-1"></a>    zombie_function.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax3, color<span class="op">=</span>PROJECT_COLS[<span class="st">'Success'</span>])</span>
<span id="cb26-1015"><a href="#cb26-1015" aria-hidden="true" tabindex="-1"></a>    ax3.set_xlabel(<span class="st">'Count of Recycled Leads'</span>)</span>
<span id="cb26-1016"><a href="#cb26-1016" aria-hidden="true" tabindex="-1"></a>    ax3.set_title(<span class="st">'Mx "Zombie" Leads by Function'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-1017"><a href="#cb26-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1018"><a href="#cb26-1018" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bottom-right: Decision maker split</span></span>
<span id="cb26-1019"><a href="#cb26-1019" aria-hidden="true" tabindex="-1"></a>    ax4 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb26-1020"><a href="#cb26-1020" aria-hidden="true" tabindex="-1"></a>    dm_split <span class="op">=</span> mx_zombies[<span class="st">'is_decision_maker'</span>].value_counts()</span>
<span id="cb26-1021"><a href="#cb26-1021" aria-hidden="true" tabindex="-1"></a>    dm_split.index <span class="op">=</span> [<span class="st">'Non-Decision Maker'</span>, <span class="st">'Decision Maker'</span>]</span>
<span id="cb26-1022"><a href="#cb26-1022" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Failure'</span>], PROJECT_COLS[<span class="st">'Success'</span>]]</span>
<span id="cb26-1023"><a href="#cb26-1023" aria-hidden="true" tabindex="-1"></a>    dm_split.plot(kind<span class="op">=</span><span class="st">'pie'</span>, ax<span class="op">=</span>ax4, colors<span class="op">=</span>colors, autopct<span class="op">=</span><span class="st">'%1.0f</span><span class="sc">%%</span><span class="st">'</span>, startangle<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb26-1024"><a href="#cb26-1024" aria-hidden="true" tabindex="-1"></a>    ax4.set_ylabel(<span class="st">''</span>)</span>
<span id="cb26-1025"><a href="#cb26-1025" aria-hidden="true" tabindex="-1"></a>    ax4.set_title(<span class="st">'Zombie Lead Quality</span><span class="ch">\n</span><span class="st">(Decision Maker Status)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-1026"><a href="#cb26-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1027"><a href="#cb26-1027" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-1028"><a href="#cb26-1028" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb26-1029"><a href="#cb26-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1030"><a href="#cb26-1030" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🧟 ZOMBIE LEAD SUMMARY (Mx Recycled):"</span>)</span>
<span id="cb26-1031"><a href="#cb26-1031" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Total Mx Zombies: </span><span class="sc">{</span><span class="bu">len</span>(mx_zombies)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb26-1032"><a href="#cb26-1032" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Decision Maker Rate: </span><span class="sc">{</span>mx_zombies[<span class="st">'is_decision_maker'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb26-1033"><a href="#cb26-1033" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   → These are high-value re-engagement targets!"</span>)</span>
<span id="cb26-1034"><a href="#cb26-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1035"><a href="#cb26-1035" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb26-1036"><a href="#cb26-1036" aria-hidden="true" tabindex="-1"></a>    analyze_zombies(df)</span>
<span id="cb26-1037"><a href="#cb26-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-1038"><a href="#cb26-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1039"><a href="#cb26-1039" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-1040"><a href="#cb26-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1041"><a href="#cb26-1041" aria-hidden="true" tabindex="-1"></a><span class="fu"># Executive Summary Dashboard</span></span>
<span id="cb26-1042"><a href="#cb26-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1045"><a href="#cb26-1045" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-1046"><a href="#cb26-1046" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: executive-dashboard</span></span>
<span id="cb26-1047"><a href="#cb26-1047" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Executive Dashboard: The complete picture at a glance."</span></span>
<span id="cb26-1048"><a href="#cb26-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1049"><a href="#cb26-1049" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> executive_dashboard(df):</span>
<span id="cb26-1050"><a href="#cb26-1050" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df.empty:</span>
<span id="cb26-1051"><a href="#cb26-1051" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb26-1052"><a href="#cb26-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1053"><a href="#cb26-1053" aria-hidden="true" tabindex="-1"></a>    df_mx <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Mx'</span>]</span>
<span id="cb26-1054"><a href="#cb26-1054" aria-hidden="true" tabindex="-1"></a>    df_qx <span class="op">=</span> df[df[<span class="st">'product_segment'</span>] <span class="op">==</span> <span class="st">'Qx'</span>]</span>
<span id="cb26-1055"><a href="#cb26-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1056"><a href="#cb26-1056" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">12</span>))</span>
<span id="cb26-1057"><a href="#cb26-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1058"><a href="#cb26-1058" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create grid</span></span>
<span id="cb26-1059"><a href="#cb26-1059" aria-hidden="true" tabindex="-1"></a>    gs <span class="op">=</span> fig.add_gridspec(<span class="dv">3</span>, <span class="dv">3</span>, hspace<span class="op">=</span><span class="fl">0.3</span>, wspace<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb26-1060"><a href="#cb26-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1061"><a href="#cb26-1061" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. KPI Cards (top row)</span></span>
<span id="cb26-1062"><a href="#cb26-1062" aria-hidden="true" tabindex="-1"></a>    ax_kpi <span class="op">=</span> fig.add_subplot(gs[<span class="dv">0</span>, :])</span>
<span id="cb26-1063"><a href="#cb26-1063" aria-hidden="true" tabindex="-1"></a>    ax_kpi.axis(<span class="st">'off'</span>)</span>
<span id="cb26-1064"><a href="#cb26-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1065"><a href="#cb26-1065" aria-hidden="true" tabindex="-1"></a>    mx_rate <span class="op">=</span> df_mx[<span class="st">'is_success'</span>].mean()</span>
<span id="cb26-1066"><a href="#cb26-1066" aria-hidden="true" tabindex="-1"></a>    qx_rate <span class="op">=</span> df_qx[<span class="st">'is_success'</span>].mean()</span>
<span id="cb26-1067"><a href="#cb26-1067" aria-hidden="true" tabindex="-1"></a>    gap <span class="op">=</span> qx_rate <span class="op">-</span> mx_rate</span>
<span id="cb26-1068"><a href="#cb26-1068" aria-hidden="true" tabindex="-1"></a>    zombies <span class="op">=</span> <span class="bu">len</span>(df_mx[df_mx[<span class="st">'outcome_tier'</span>] <span class="op">==</span> <span class="st">'Near-Miss'</span>])</span>
<span id="cb26-1069"><a href="#cb26-1069" aria-hidden="true" tabindex="-1"></a>    dm_rate <span class="op">=</span> df_mx[<span class="st">'is_decision_maker'</span>].mean()</span>
<span id="cb26-1070"><a href="#cb26-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1071"><a href="#cb26-1071" aria-hidden="true" tabindex="-1"></a>    kpi_text <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb26-1072"><a href="#cb26-1072" aria-hidden="true" tabindex="-1"></a><span class="ss">    ╔═══════════════════╦═══════════════════╦═══════════════════╦═══════════════════╗</span></span>
<span id="cb26-1073"><a href="#cb26-1073" aria-hidden="true" tabindex="-1"></a><span class="ss">    ║   MX CONVERSION   ║   QX CONVERSION   ║   PERFORMANCE GAP ║   ZOMBIE LEADS    ║</span></span>
<span id="cb26-1074"><a href="#cb26-1074" aria-hidden="true" tabindex="-1"></a><span class="ss">    ║      </span><span class="sc">{</span>mx_rate<span class="sc">:.1%}</span><span class="ss">         ║      </span><span class="sc">{</span>qx_rate<span class="sc">:.1%}</span><span class="ss">         ║      </span><span class="sc">{</span>gap<span class="sc">:.1%}</span><span class="ss">         ║      </span><span class="sc">{</span>zombies<span class="sc">:,}</span><span class="ss">          ║</span></span>
<span id="cb26-1075"><a href="#cb26-1075" aria-hidden="true" tabindex="-1"></a><span class="ss">    ╚═══════════════════╩═══════════════════╩═══════════════════╩═══════════════════╝</span></span>
<span id="cb26-1076"><a href="#cb26-1076" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb26-1077"><a href="#cb26-1077" aria-hidden="true" tabindex="-1"></a>    ax_kpi.text(<span class="fl">0.5</span>, <span class="fl">0.5</span>, kpi_text, fontsize<span class="op">=</span><span class="dv">14</span>, fontfamily<span class="op">=</span><span class="st">'monospace'</span>,</span>
<span id="cb26-1078"><a href="#cb26-1078" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax_kpi.transAxes)</span>
<span id="cb26-1079"><a href="#cb26-1079" aria-hidden="true" tabindex="-1"></a>    ax_kpi.set_title(<span class="st">'KEY PERFORMANCE INDICATORS'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-1080"><a href="#cb26-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1081"><a href="#cb26-1081" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Conversion by Seniority</span></span>
<span id="cb26-1082"><a href="#cb26-1082" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb26-1083"><a href="#cb26-1083" aria-hidden="true" tabindex="-1"></a>    seniority_rates <span class="op">=</span> df_mx.groupby(<span class="st">'title_seniority'</span>)[<span class="st">'is_success'</span>].mean().sort_values()</span>
<span id="cb26-1084"><a href="#cb26-1084" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> r <span class="op">&gt;</span> mx_rate <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>] <span class="cf">for</span> r <span class="kw">in</span> seniority_rates]</span>
<span id="cb26-1085"><a href="#cb26-1085" aria-hidden="true" tabindex="-1"></a>    seniority_rates.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax2, color<span class="op">=</span>colors)</span>
<span id="cb26-1086"><a href="#cb26-1086" aria-hidden="true" tabindex="-1"></a>    ax2.axvline(mx_rate, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb26-1087"><a href="#cb26-1087" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'Mx by Seniority'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-1088"><a href="#cb26-1088" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'Conversion Rate'</span>)</span>
<span id="cb26-1089"><a href="#cb26-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1090"><a href="#cb26-1090" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Conversion by Function</span></span>
<span id="cb26-1091"><a href="#cb26-1091" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb26-1092"><a href="#cb26-1092" aria-hidden="true" tabindex="-1"></a>    function_rates <span class="op">=</span> df_mx.groupby(<span class="st">'title_function'</span>)[<span class="st">'is_success'</span>].mean().sort_values()</span>
<span id="cb26-1093"><a href="#cb26-1093" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> r <span class="op">&gt;</span> mx_rate <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>] <span class="cf">for</span> r <span class="kw">in</span> function_rates]</span>
<span id="cb26-1094"><a href="#cb26-1094" aria-hidden="true" tabindex="-1"></a>    function_rates.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax3, color<span class="op">=</span>colors)</span>
<span id="cb26-1095"><a href="#cb26-1095" aria-hidden="true" tabindex="-1"></a>    ax3.axvline(mx_rate, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb26-1096"><a href="#cb26-1096" aria-hidden="true" tabindex="-1"></a>    ax3.set_title(<span class="st">'Mx by Function'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-1097"><a href="#cb26-1097" aria-hidden="true" tabindex="-1"></a>    ax3.set_xlabel(<span class="st">'Conversion Rate'</span>)</span>
<span id="cb26-1098"><a href="#cb26-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1099"><a href="#cb26-1099" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Conversion by Scope</span></span>
<span id="cb26-1100"><a href="#cb26-1100" aria-hidden="true" tabindex="-1"></a>    ax4 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb26-1101"><a href="#cb26-1101" aria-hidden="true" tabindex="-1"></a>    scope_rates <span class="op">=</span> df_mx.groupby(<span class="st">'title_scope'</span>)[<span class="st">'is_success'</span>].mean().sort_values()</span>
<span id="cb26-1102"><a href="#cb26-1102" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Success'</span>] <span class="cf">if</span> r <span class="op">&gt;</span> mx_rate <span class="cf">else</span> PROJECT_COLS[<span class="st">'Failure'</span>] <span class="cf">for</span> r <span class="kw">in</span> scope_rates]</span>
<span id="cb26-1103"><a href="#cb26-1103" aria-hidden="true" tabindex="-1"></a>    scope_rates.plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax4, color<span class="op">=</span>colors)</span>
<span id="cb26-1104"><a href="#cb26-1104" aria-hidden="true" tabindex="-1"></a>    ax4.axvline(mx_rate, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb26-1105"><a href="#cb26-1105" aria-hidden="true" tabindex="-1"></a>    ax4.set_title(<span class="st">'Mx by Scope'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-1106"><a href="#cb26-1106" aria-hidden="true" tabindex="-1"></a>    ax4.set_xlabel(<span class="st">'Conversion Rate'</span>)</span>
<span id="cb26-1107"><a href="#cb26-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1108"><a href="#cb26-1108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. Outcome Distribution</span></span>
<span id="cb26-1109"><a href="#cb26-1109" aria-hidden="true" tabindex="-1"></a>    ax5 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">2</span>, <span class="dv">0</span>])</span>
<span id="cb26-1110"><a href="#cb26-1110" aria-hidden="true" tabindex="-1"></a>    outcome_counts <span class="op">=</span> df_mx[<span class="st">'outcome_tier'</span>].value_counts()</span>
<span id="cb26-1111"><a href="#cb26-1111" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [PROJECT_COLS[<span class="st">'Failure'</span>], PROJECT_COLS[<span class="st">'Neutral'</span>], PROJECT_COLS[<span class="st">'Success'</span>]]</span>
<span id="cb26-1112"><a href="#cb26-1112" aria-hidden="true" tabindex="-1"></a>    outcome_counts.plot(kind<span class="op">=</span><span class="st">'pie'</span>, ax<span class="op">=</span>ax5, colors<span class="op">=</span>colors, autopct<span class="op">=</span><span class="st">'%1.0f</span><span class="sc">%%</span><span class="st">'</span>)</span>
<span id="cb26-1113"><a href="#cb26-1113" aria-hidden="true" tabindex="-1"></a>    ax5.set_ylabel(<span class="st">''</span>)</span>
<span id="cb26-1114"><a href="#cb26-1114" aria-hidden="true" tabindex="-1"></a>    ax5.set_title(<span class="st">'Mx Outcome Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-1115"><a href="#cb26-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1116"><a href="#cb26-1116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 6. Top Industries</span></span>
<span id="cb26-1117"><a href="#cb26-1117" aria-hidden="true" tabindex="-1"></a>    ax6 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">2</span>, <span class="dv">1</span>])</span>
<span id="cb26-1118"><a href="#cb26-1118" aria-hidden="true" tabindex="-1"></a>    industry_rates <span class="op">=</span> df_mx.groupby(<span class="st">'acct_target_industry'</span>).agg(</span>
<span id="cb26-1119"><a href="#cb26-1119" aria-hidden="true" tabindex="-1"></a>        rate<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'mean'</span>),</span>
<span id="cb26-1120"><a href="#cb26-1120" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span>(<span class="st">'is_success'</span>, <span class="st">'size'</span>)</span>
<span id="cb26-1121"><a href="#cb26-1121" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-1122"><a href="#cb26-1122" aria-hidden="true" tabindex="-1"></a>    industry_rates <span class="op">=</span> industry_rates[industry_rates[<span class="st">'n'</span>] <span class="op">&gt;=</span> <span class="dv">30</span>].sort_values(<span class="st">'rate'</span>, ascending<span class="op">=</span><span class="va">True</span>).tail(<span class="dv">8</span>)</span>
<span id="cb26-1123"><a href="#cb26-1123" aria-hidden="true" tabindex="-1"></a>    industry_rates[<span class="st">'rate'</span>].plot(kind<span class="op">=</span><span class="st">'barh'</span>, ax<span class="op">=</span>ax6, color<span class="op">=</span>PROJECT_COLS[<span class="st">'Success'</span>])</span>
<span id="cb26-1124"><a href="#cb26-1124" aria-hidden="true" tabindex="-1"></a>    ax6.set_title(<span class="st">'Top Industries for Mx'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-1125"><a href="#cb26-1125" aria-hidden="true" tabindex="-1"></a>    ax6.set_xlabel(<span class="st">'Conversion Rate'</span>)</span>
<span id="cb26-1126"><a href="#cb26-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1127"><a href="#cb26-1127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 7. Recommendations</span></span>
<span id="cb26-1128"><a href="#cb26-1128" aria-hidden="true" tabindex="-1"></a>    ax7 <span class="op">=</span> fig.add_subplot(gs[<span class="dv">2</span>, <span class="dv">2</span>])</span>
<span id="cb26-1129"><a href="#cb26-1129" aria-hidden="true" tabindex="-1"></a>    ax7.axis(<span class="st">'off'</span>)</span>
<span id="cb26-1130"><a href="#cb26-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1131"><a href="#cb26-1131" aria-hidden="true" tabindex="-1"></a>    reco_text <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb26-1132"><a href="#cb26-1132" aria-hidden="true" tabindex="-1"></a><span class="st">    RECOMMENDED ACTIONS:</span></span>
<span id="cb26-1133"><a href="#cb26-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1134"><a href="#cb26-1134" aria-hidden="true" tabindex="-1"></a><span class="st">    ✓ Target: Directors/VPs with</span></span>
<span id="cb26-1135"><a href="#cb26-1135" aria-hidden="true" tabindex="-1"></a><span class="st">       Global scope in Pharma</span></span>
<span id="cb26-1136"><a href="#cb26-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1137"><a href="#cb26-1137" aria-hidden="true" tabindex="-1"></a><span class="st">    ✓ Avoid: ICs and Site-level</span></span>
<span id="cb26-1138"><a href="#cb26-1138" aria-hidden="true" tabindex="-1"></a><span class="st">       roles in Unknown industries</span></span>
<span id="cb26-1139"><a href="#cb26-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1140"><a href="#cb26-1140" aria-hidden="true" tabindex="-1"></a><span class="st">    ✓ Speed: Implement 24-hour</span></span>
<span id="cb26-1141"><a href="#cb26-1141" aria-hidden="true" tabindex="-1"></a><span class="st">       SLA for Mx leads</span></span>
<span id="cb26-1142"><a href="#cb26-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1143"><a href="#cb26-1143" aria-hidden="true" tabindex="-1"></a><span class="st">    ✓ Nurture: Re-engage the</span></span>
<span id="cb26-1144"><a href="#cb26-1144" aria-hidden="true" tabindex="-1"></a><span class="st">       </span><span class="sc">{zombies:,}</span><span class="st"> recycled leads</span></span>
<span id="cb26-1145"><a href="#cb26-1145" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>.<span class="bu">format</span>(zombies<span class="op">=</span>zombies)</span>
<span id="cb26-1146"><a href="#cb26-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1147"><a href="#cb26-1147" aria-hidden="true" tabindex="-1"></a>    ax7.text(<span class="fl">0.1</span>, <span class="fl">0.5</span>, reco_text, fontsize<span class="op">=</span><span class="dv">12</span>, fontfamily<span class="op">=</span><span class="st">'monospace'</span>,</span>
<span id="cb26-1148"><a href="#cb26-1148" aria-hidden="true" tabindex="-1"></a>             va<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax7.transAxes,</span>
<span id="cb26-1149"><a href="#cb26-1149" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'round'</span>, facecolor<span class="op">=</span><span class="st">'lightyellow'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>))</span>
<span id="cb26-1150"><a href="#cb26-1150" aria-hidden="true" tabindex="-1"></a>    ax7.set_title(<span class="st">'ACTION ITEMS'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb26-1151"><a href="#cb26-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1152"><a href="#cb26-1152" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="st">'MasterControl Mx Performance Dashboard'</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb26-1153"><a href="#cb26-1153" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb26-1154"><a href="#cb26-1154" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb26-1155"><a href="#cb26-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1156"><a href="#cb26-1156" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb26-1157"><a href="#cb26-1157" aria-hidden="true" tabindex="-1"></a>    executive_dashboard(df)</span>
<span id="cb26-1158"><a href="#cb26-1158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-1159"><a href="#cb26-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1160"><a href="#cb26-1160" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-1161"><a href="#cb26-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1162"><a href="#cb26-1162" aria-hidden="true" tabindex="-1"></a><span class="fu"># Deployment</span></span>
<span id="cb26-1163"><a href="#cb26-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1164"><a href="#cb26-1164" aria-hidden="true" tabindex="-1"></a>We export the "Enriched" dataset with our engineered features.</span>
<span id="cb26-1165"><a href="#cb26-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1168"><a href="#cb26-1168" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-1169"><a href="#cb26-1169" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: export</span></span>
<span id="cb26-1170"><a href="#cb26-1170" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-1171"><a href="#cb26-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1172"><a href="#cb26-1172" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> export_enriched_dataset(df):</span>
<span id="cb26-1173"><a href="#cb26-1173" aria-hidden="true" tabindex="-1"></a>    export_cols <span class="op">=</span> [</span>
<span id="cb26-1174"><a href="#cb26-1174" aria-hidden="true" tabindex="-1"></a>        <span class="co"># IDs</span></span>
<span id="cb26-1175"><a href="#cb26-1175" aria-hidden="true" tabindex="-1"></a>        <span class="st">'qal_id'</span>, <span class="st">'contact_lead_id'</span>,</span>
<span id="cb26-1176"><a href="#cb26-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1177"><a href="#cb26-1177" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Targets</span></span>
<span id="cb26-1178"><a href="#cb26-1178" aria-hidden="true" tabindex="-1"></a>        <span class="st">'is_success'</span>, <span class="st">'outcome_tier'</span>, <span class="st">'next_stage__c'</span>, <span class="st">'product_segment'</span>,</span>
<span id="cb26-1179"><a href="#cb26-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1180"><a href="#cb26-1180" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Account Features</span></span>
<span id="cb26-1181"><a href="#cb26-1181" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acct_target_industry'</span>, <span class="st">'acct_manufacturing_model'</span>,</span>
<span id="cb26-1182"><a href="#cb26-1182" aria-hidden="true" tabindex="-1"></a>        <span class="st">'acct_primary_site_function'</span>, <span class="st">'acct_territory_rollup'</span>,</span>
<span id="cb26-1183"><a href="#cb26-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1184"><a href="#cb26-1184" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Engineered Features</span></span>
<span id="cb26-1185"><a href="#cb26-1185" aria-hidden="true" tabindex="-1"></a>        <span class="st">'title_seniority'</span>, <span class="st">'title_function'</span>, <span class="st">'title_scope'</span>, <span class="st">'is_decision_maker'</span>,</span>
<span id="cb26-1186"><a href="#cb26-1186" aria-hidden="true" tabindex="-1"></a>        <span class="st">'record_completeness'</span>, <span class="st">'completeness_tier'</span>,</span>
<span id="cb26-1187"><a href="#cb26-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1188"><a href="#cb26-1188" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Lead attributes</span></span>
<span id="cb26-1189"><a href="#cb26-1189" aria-hidden="true" tabindex="-1"></a>        <span class="st">'priority'</span>, <span class="st">'last_tactic_campaign_channel'</span>,</span>
<span id="cb26-1190"><a href="#cb26-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1191"><a href="#cb26-1191" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Temporal</span></span>
<span id="cb26-1192"><a href="#cb26-1192" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cohort_date'</span>, <span class="st">'cohort_year'</span>, <span class="st">'cohort_quarter'</span>, <span class="st">'lead_age_days'</span></span>
<span id="cb26-1193"><a href="#cb26-1193" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb26-1194"><a href="#cb26-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1195"><a href="#cb26-1195" aria-hidden="true" tabindex="-1"></a>    export_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> export_cols <span class="cf">if</span> c <span class="kw">in</span> df.columns]</span>
<span id="cb26-1196"><a href="#cb26-1196" aria-hidden="true" tabindex="-1"></a>    df_export <span class="op">=</span> df[export_cols].copy()</span>
<span id="cb26-1197"><a href="#cb26-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1198"><a href="#cb26-1198" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path.cwd() <span class="op">/</span> <span class="st">"Cleaned_QAL_Competition_Grade.csv"</span></span>
<span id="cb26-1199"><a href="#cb26-1199" aria-hidden="true" tabindex="-1"></a>    df_export.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-1200"><a href="#cb26-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1201"><a href="#cb26-1201" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Exported: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-1202"><a href="#cb26-1202" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Rows: </span><span class="sc">{</span><span class="bu">len</span>(df_export)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb26-1203"><a href="#cb26-1203" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Columns: </span><span class="sc">{</span><span class="bu">len</span>(df_export.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-1204"><a href="#cb26-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1205"><a href="#cb26-1205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_export</span>
<span id="cb26-1206"><a href="#cb26-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1207"><a href="#cb26-1207" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb26-1208"><a href="#cb26-1208" aria-hidden="true" tabindex="-1"></a>    df_export <span class="op">=</span> export_enriched_dataset(df)</span>
<span id="cb26-1209"><a href="#cb26-1209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-1210"><a href="#cb26-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1211"><a href="#cb26-1211" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-1212"><a href="#cb26-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1213"><a href="#cb26-1213" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix: Statistical Methodology</span></span>
<span id="cb26-1214"><a href="#cb26-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1215"><a href="#cb26-1215" aria-hidden="true" tabindex="-1"></a>**Bayesian Credible Intervals:** We use Beta-Binomial conjugacy with uninformative priors (alpha=1, beta=1) to estimate conversion rates. This provides more robust uncertainty quantification for small samples compared to frequentist confidence intervals.</span>
<span id="cb26-1216"><a href="#cb26-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1217"><a href="#cb26-1217" aria-hidden="true" tabindex="-1"></a>**Mutual Information:** Feature importance is calculated using Shannon mutual information, which measures the reduction in uncertainty about the target variable given knowledge of each feature.</span>
<span id="cb26-1218"><a href="#cb26-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1219"><a href="#cb26-1219" aria-hidden="true" tabindex="-1"></a>**Decision Tree Interactions:** We use shallow decision trees (depth <span class="sc">\&lt;</span>= 3) as interaction detectors. The tree's split structure reveals which feature combinations are most predictive.</span>
<span id="cb26-1220"><a href="#cb26-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1221"><a href="#cb26-1221" aria-hidden="true" tabindex="-1"></a>**Log-Odds Ratio:** For semantic analysis, we calculate log-odds with Laplace smoothing to identify words that discriminate between successful and unsuccessful leads.</span>
<span id="cb26-1222"><a href="#cb26-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1223"><a href="#cb26-1223" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-1224"><a href="#cb26-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1225"><a href="#cb26-1225" aria-hidden="true" tabindex="-1"></a>*Document generated for MSBA Capstone Case Competition - Spring 2026*</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>